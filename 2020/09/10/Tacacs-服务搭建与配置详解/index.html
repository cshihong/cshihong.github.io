<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">



  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1.0.0/needsharebutton.min.css">



























  
  
  
  

  

  

  

  

  

  






  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=6.6.0">


  <link rel="mask-icon" href="/favicon.ico?v=6.6.0" color="#222">


  <link rel="manifest" href="/images/favicon.ico">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="其他文章：  Tacacs+协议原理 Tacacs+服务搭建与配置详解 Tacacs+各厂商交换机配置 Tacacs+协议交互报文抓包示例 Tacacs+双通道认证配置测试与总结 Tacacs+配置single-connection单连接模式证测试与总结    简介tac_plus是TACACS +守护程序。它为网络设备和访问服务器提供身份验证，授权和计费服务。（authentication,">
<meta name="keywords" content="Tacscs+,安全,AAA">
<meta property="og:type" content="article">
<meta property="og:title" content="Tacacs+服务搭建与配置详解">
<meta property="og:url" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/index.html">
<meta property="og:site_name" content="曹世宏的博客">
<meta property="og:description" content="其他文章：  Tacacs+协议原理 Tacacs+服务搭建与配置详解 Tacacs+各厂商交换机配置 Tacacs+协议交互报文抓包示例 Tacacs+双通道认证配置测试与总结 Tacacs+配置single-connection单连接模式证测试与总结    简介tac_plus是TACACS +守护程序。它为网络设备和访问服务器提供身份验证，授权和计费服务。（authentication,">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/TacplusConfig.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/GlobalDecl.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/RealmDecl.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/RealmAttr.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/RealmAttrAuthen.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/CIDR.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/HostDecl.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/HostAttr.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/EnableExpr.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/TimespecDecl-20200914092157696.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/ACLDecl.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/ACLExpr.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/TacAction-20200915080821958.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/TacCond.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/UserDecl.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/GroupDecl.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/PasswordExpr.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/PasswordExprHash.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/UserAttr.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/UserMessage.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/GroupAttr.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/GroupOnlyAttr.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/ServiceDecl.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/ServiceAttr.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/Acl.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/AttrDefault.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/AVPair.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/ShellDecl.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/ShellAttr.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/TacScript.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/ShellCommandDecl.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/CmdDefault.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/ProtoDefault.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/ProtoDecl.gif">
<meta property="og:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/Debug.gif">
<meta property="og:updated_time" content="2020-12-27T14:44:15.856Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tacacs+服务搭建与配置详解">
<meta name="twitter:description" content="其他文章：  Tacacs+协议原理 Tacacs+服务搭建与配置详解 Tacacs+各厂商交换机配置 Tacacs+协议交互报文抓包示例 Tacacs+双通道认证配置测试与总结 Tacacs+配置single-connection单连接模式证测试与总结    简介tac_plus是TACACS +守护程序。它为网络设备和访问服务器提供身份验证，授权和计费服务。（authentication,">
<meta name="twitter:image" content="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/TacplusConfig.gif">



  <link rel="alternate" href="/atom.xml" title="曹世宏的博客" type="application/atom+xml">




  <link rel="canonical" href="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Tacacs+服务搭建与配置详解 | 曹世宏的博客</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3d1d06c1df5d2fe94237f55bad4858bc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">曹世宏的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">记录一些学习资料</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="曹世宏">
      <meta itemprop="description" content="你的责任就是你的方向，你的经历就是你的资本，你的性格就是你的命运。">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="曹世宏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Tacacs+服务搭建与配置详解

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-09-10 08:56:55" itemprop="dateCreated datePublished" datetime="2020-09-10T08:56:55+08:00">2020-09-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-12-27 22:44:15" itemprop="dateModified" datetime="2020-12-27T22:44:15+08:00">2020-12-27</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/网络杂项/" itemprop="url" rel="index"><span itemprop="name">网络杂项</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
			<span class="post-meta-divider">|</span>
			<span title="post.wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span>字数： 26,013</span>
			<span class="post-meta-item-text">|</span>
			<span title="post.min2read"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span>阅读时长： 111</span>

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <hr>
<blockquote>
<p>其他文章：</p>
<ul>
<li><a href="https://cshihong.github.io/2020/08/30/Tacscs-%E5%8D%8F%E8%AE%AE%E5%8E%9F%E7%90%86/">Tacacs+协议原理</a></li>
<li><a href="https://cshihong.github.io/2020/09/10/Tacacs-%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E4%B8%8E%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/">Tacacs+服务搭建与配置详解</a></li>
<li><a href="https://cshihong.github.io/2020/09/28/Tacacs-%E5%90%84%E5%8E%82%E5%95%86%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%85%8D%E7%BD%AE/">Tacacs+各厂商交换机配置</a></li>
<li><a href="https://cshihong.github.io/2020/10/06/Tacacs-%E5%8D%8F%E8%AE%AE%E4%BA%A4%E4%BA%92%E6%8A%A5%E6%96%87%E6%8A%93%E5%8C%85%E7%A4%BA%E4%BE%8B/">Tacacs+协议交互报文抓包示例</a></li>
<li><a href="https://cshihong.github.io/2020/12/27/Tacacs-%E5%8F%8C%E9%80%9A%E9%81%93%E8%AE%A4%E8%AF%81%E9%85%8D%E7%BD%AE%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%80%BB%E7%BB%93/">Tacacs+双通道认证配置测试与总结</a></li>
<li><a href="https://cshihong.github.io/2020/12/27/Tacacs-%E9%85%8D%E7%BD%AEsingle-connection%E5%8D%95%E8%BF%9E%E6%8E%A5%E6%A8%A1%E5%BC%8F%E8%AF%81%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%80%BB%E7%BB%93/">Tacacs+配置single-connection单连接模式证测试与总结</a></li>
</ul>
</blockquote>
<hr>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><strong>tac_plus</strong>是TACACS +守护程序。它为网络设备和访问服务器提供身份验证，授权和计费服务。（authentication, authorisation and accounting）</p>
<p>此版本是原始Cisco源代码的主要重写。主要功能包括：</p>
<ul>
<li>NAS特定的主机密钥，提示，开启密码</li>
<li>与NAS和ACL相关的组成员身份</li>
<li>用于用户配置文件的灵活的外部后端（例如，通过PERL脚本或C；包括LDAP（包括ActiveDirectory），RADIUS和其他）</li>
<li>连接多路复用（每个进程有多个并发NAS客户端）</li>
<li>会话多路复用（每个连接多个并发会话，<em>单连接</em>）</li>
<li>可扩展，对用户，客户端或服务器无限制</li>
<li>CLI上下文感知。在撰写本文时，没有其他TACACS +守护程序。</li>
<li>完全支持IPv4和IPv6。</li>
<li>符合最新的TACACS +协议规范（draft 1.78）</li>
</ul>
<h1 id="下载和安装："><a href="#下载和安装：" class="headerlink" title="下载和安装："></a>下载和安装：</h1><h2 id="源码安装与配置示例："><a href="#源码安装与配置示例：" class="headerlink" title="源码安装与配置示例："></a>源码安装与配置示例：</h2><p>wget <a href="http://www.pro-bono-publico.de/projects/src/DEVEL.tar.bz2" target="_blank" rel="noopener">http://www.pro-bono-publico.de/projects/src/DEVEL.tar.bz2</a></p>
<p><a href="https://github.com/facebookarchive/tac_plus" target="_blank" rel="noopener">https://github.com/facebookarchive/tac_plus</a></p>
<p><a href="https://networkengineering.stackexchange.com/questions/45436/how-do-you-configure-a-tacacs-tac-plus-server-on-ubuntu-16-04-that-authenticate" target="_blank" rel="noopener">https://networkengineering.stackexchange.com/questions/45436/how-do-you-configure-a-tacacs-tac-plus-server-on-ubuntu-16-04-that-authenticate</a></p>
<h2 id="安装步骤："><a href="#安装步骤：" class="headerlink" title="安装步骤："></a>安装步骤：</h2><p>下面的安装是在CentOS7中进行了测试。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.pro-bono-publico.de/projects/src/DEVEL.tar.bz2</span><br><span class="line">bzip2 -dc DEVEL.tar.bz2 | tar xvfp -</span><br><span class="line">sudo yum install rpm-build redhat-rpm-config gcc bison flex m4 pam-devel tcp_wrappers tcp_wrappers-devel</span><br><span class="line">yum -y install perl-Digest-MD5</span><br><span class="line">yum install perl-LDAP</span><br><span class="line">cd PROJECTS</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">mkdir /var/log/tac_plus</span><br><span class="line">mkdir /var/log/tac_plus/access</span><br><span class="line">mkdir /var/log/tac_plus/accounting</span><br><span class="line">mkdir /var/log/tac_plus/authentication</span><br><span class="line">mkdir /var/log/tac_plus/authorization</span><br><span class="line">chmod 755 /var/log/tac_plus</span><br><span class="line">cp tac_plus/extra/tac_plus.service  /etc/systemd/system/</span><br></pre></td></tr></table></figure>
<p>下一步需要创建配置文件：</p>
<blockquote>
<p>在/usr/local/etc/mavis/sample/tac_plus.cfg为示例配置文件。可直接拷贝到/usr/local/etc/下,直接启动服务。</p>
</blockquote>
<p>在这里进行手动创建配置文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/etc</span><br><span class="line">sudo touch tac_plus.cfg</span><br><span class="line">sudo chmod 755 tac_plus.cfg</span><br><span class="line">sudo vim tac_plus.cfg</span><br></pre></td></tr></table></figure>
<p>如果是使用只使用tacacs+服务器配置文件中的用户密码进行认证，可使用如下配置文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost etc]# more tac_plus.cfg </span><br><span class="line"><span class="meta">#</span><span class="bash">!../../../sbin/tac_plus</span></span><br><span class="line"></span><br><span class="line">id = spawnd &#123;</span><br><span class="line">				# tacacs+默认端口为49，wireshark可将目的端口为49的tcp解析为tacacs+报文</span><br><span class="line">        listen = &#123; port = 49 &#125;</span><br><span class="line">        spawn = &#123;</span><br><span class="line">                instances min = 1</span><br><span class="line">                instances max = 100</span><br><span class="line">        &#125;</span><br><span class="line">        background = no</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">        #debug = PACKET AUTHEN AUTHOR</span><br><span class="line"></span><br><span class="line">        access log = /var/log/tac_plus/access/access.log</span><br><span class="line">        authorization log = /var/log/tac_plus/authorization/authorization.log</span><br><span class="line">        authentication log = /var/log/tac_plus/authentication/authentication.l</span><br><span class="line">og</span><br><span class="line">        accounting log = /var/log/tac_plus/accounting/accounting.log</span><br><span class="line"></span><br><span class="line">        host = world &#123;</span><br><span class="line">                address = ::/0</span><br><span class="line">                prompt = "Welcome\n"</span><br><span class="line">                key = "tacacs@123"</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        group = admin &#123;</span><br><span class="line">                default service = permit</span><br><span class="line">                service = shell &#123;</span><br><span class="line">                        default command = permit</span><br><span class="line">                        default attribute = permit</span><br><span class="line">                        set priv-lvl = 15</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        group = guest &#123;</span><br><span class="line">                default service = permit</span><br><span class="line">                enable = deny</span><br><span class="line">                service = shell &#123;</span><br><span class="line">                        default command = permit</span><br><span class="line">                        default attribute = permit</span><br><span class="line">                        set priv-lvl = 1</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        user = tacacsuser &#123;</span><br><span class="line">        				#使用明文密码</span><br><span class="line">                password = clear tacacs123</span><br><span class="line">                member = admin</span><br><span class="line">                service = shell &#123;</span><br><span class="line">                        default command = permit</span><br><span class="line">                        default attribute = permit</span><br><span class="line">                        set priv-lvl = 15</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        user = user1 &#123;</span><br><span class="line">        				#使用密文密码，密文可通过如下命令生成</span><br><span class="line">                #openssl passwd -crypt user123</span><br><span class="line">                password = crypt Ljk4p8tGXkuVw </span><br><span class="line">                member = admin</span><br><span class="line">                service = shell &#123;</span><br><span class="line">                        default command = permit</span><br><span class="line">                        default attribute = permit</span><br><span class="line">                        set priv-lvl = 15</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        user = readonly &#123;</span><br><span class="line">                password = clear readonly</span><br><span class="line">                member = guest</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建完配置文件后，进行启动tacacs+服务器。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost etc]# systemctl restart tac_plus</span><br><span class="line">[root@localhost etc]# systemctl enable tac_plus</span><br><span class="line">[root@localhost etc]# systemctl status tac_plus</span><br><span class="line">● tac_plus.service - TACACS+ Service</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/tac_plus.service; enabled; vendor pres)</span><br><span class="line">   Active: active (running) since Tue 2020-10-06 18:03:29 CST; 20s ago</span><br><span class="line"> Main PID: 13090 (tac_plus)</span><br><span class="line">   CGroup: /system.slice/tac_plus.service</span><br><span class="line">           ├─13061 tac_plus: 3 connections left, dying when idle</span><br><span class="line">           ├─13090 tac_plus: 0 connections, accepting up to 600 more</span><br><span class="line">           └─13091 tac_plus: 0 connections</span><br><span class="line"></span><br><span class="line">Oct 06 18:03:29 localhost.localdomain systemd[1]: Started TACACS+ Service.</span><br><span class="line">Oct 06 18:03:29 localhost.localdomain systemd[1]: Starting TACACS+ Service...</span><br><span class="line">Oct 06 18:03:29 localhost.localdomain tac_plus[13090]: startup (version 202...</span><br><span class="line">Oct 06 18:03:29 localhost.localdomain tac_plus[13090]: epoll event notifica...</span><br><span class="line">Oct 06 18:03:29 localhost.localdomain tac_plus[13090]: bind to [::]:49 succ...</span><br><span class="line">Oct 06 18:03:29 localhost.localdomain tac_plus[13091]: - Version 2020062010...</span><br><span class="line">Oct 06 18:03:29 localhost.localdomain tac_plus[13091]: epoll event notifica...</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br><span class="line">[root@localhost etc]# netstat -lntp  | grep 49</span><br><span class="line">tcp6       0      0 :::49                   :::*                    LISTEN</span><br></pre></td></tr></table></figure>
<p>当系统开始监听49端口，则证明tacacs+服务正常安装并启动。</p>
<p><strong>若需要使用LDAP等后端进行认证，可使用如下配置：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost etc]# more tac_plus.cfg </span><br><span class="line"><span class="meta">#</span><span class="bash">!/usr/<span class="built_in">local</span>/sbin/tac_plus</span></span><br><span class="line">id = spawnd &#123;</span><br><span class="line">    listen = &#123;  port = 49 &#125;</span><br><span class="line">    spawn = &#123;</span><br><span class="line">        instances min = 1</span><br><span class="line">        instances max = 100</span><br><span class="line">    &#125;</span><br><span class="line">    background = yes #开启后端认证</span><br><span class="line">&#125;</span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">    #debug = PACKET AUTHEN AUTHOR</span><br><span class="line">    anonymous-enable   = deny</span><br><span class="line">    augmented-enable   = deny</span><br><span class="line">    date format      = "%Y-%m-%d %H:%M:%S"</span><br><span class="line">    log separator     = ","</span><br><span class="line">    access log = /var/log/tac_plus/access/access.log</span><br><span class="line">    authorization log = /var/log/tac_plus/authorization/authorization.log</span><br><span class="line">    authentication log = /var/log/tac_plus/authentication/authentication.log</span><br><span class="line">    accounting log = /var/log/tac_plus/accounting/accounting.log</span><br><span class="line">    mavis module = external &#123;</span><br><span class="line">        setenv LDAP_SERVER_TYPE = "tacacs_schema"</span><br><span class="line">        setenv LDAP_HOSTS = "ldaps://xxxx"</span><br><span class="line">        setenv LDAP_BASE = "ou=xx,dc=xxx,dc=xx"</span><br><span class="line">        setenv LDAP_SCOPE = sub</span><br><span class="line">        setenv LDAP_FILTER = "(uid=%s)"</span><br><span class="line">        setenv LDAP_USER = "cn=xx,dc=xx,dc=xx"</span><br><span class="line">        setenv LDAP_PASSWD = ""</span><br><span class="line">        #Clear default setting of tacplus for AD_GROUP_PREFIX</span><br><span class="line">        setenv AD_GROUP_PREFIX = ""</span><br><span class="line">        #Setting REQUIRE_TACACS_GROUP_PREFIX to 1 will cause a NACK response if the AD account is not a member of a security group with the required prefix</span><br><span class="line">        setenv REQUIRE_TACACS_GROUP_PREFIX = 0</span><br><span class="line">        exec = /usr/local/lib/mavis/mavis_tacplus_ldap.pl</span><br><span class="line">    &#125;</span><br><span class="line">    login backend = mavis</span><br><span class="line">    user backend = mavis</span><br><span class="line">    pap backend = mavis</span><br><span class="line">   </span><br><span class="line">    host = world &#123;</span><br><span class="line">                address = ::/0</span><br><span class="line">                prompt = "Welcome\n"</span><br><span class="line">                key = "tacacs@123"</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    # test group</span><br><span class="line">    group = test &#123;</span><br><span class="line">        #Permit all services by default</span><br><span class="line">        default service = permit</span><br><span class="line">        service = shell &#123;</span><br><span class="line">            default command = permit</span><br><span class="line">            default attribute = permit</span><br><span class="line">            set priv-lvl = 15</span><br><span class="line">            set Huawei-Exec-Privilege = 15</span><br><span class="line">            set Huawei-Exec-Privilege = 3</span><br><span class="line">            # h3c and huawei command</span><br><span class="line">            cmd = display &#123;</span><br><span class="line">                deny version</span><br><span class="line">                permit .*</span><br><span class="line">            &#125;</span><br><span class="line">            # ruijie command</span><br><span class="line">            cmd = show &#123;</span><br><span class="line">                deny arp</span><br><span class="line">                permit .*</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    user = tacacsuser &#123;</span><br><span class="line">    			member = test</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>每次修改完配置文件，需要进行重启服务。</p>
<p>可以使用/usr/local/sbin/tac_plus -P /usr/local/etc/tac_plus.cfg 来检查cfg文件是否有语法错误，</p>
<p>可以使用如下方法来检测tac_plus到LDAP连接是否成功,</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/mavistest -d -1 /usr/local/etc/tac_plus.cfg tac_plus TACPLUS SomeUserName SomeUserPassword</span><br><span class="line">&#123;mavistest debug output omitted&#125;</span><br><span class="line">Input attribute-value-pairs:</span><br><span class="line">TYPE         TACPLUS</span><br><span class="line">TIMESTAMP      mavistest-2501-1509172787-0</span><br><span class="line">USER         SomeUserName</span><br><span class="line">PASSWORD       SomeUserPassword</span><br><span class="line">TACTYPE       AUTH</span><br><span class="line">Output attribute-value-pairs:</span><br><span class="line">TYPE         TACPLUS</span><br><span class="line">TIMESTAMP      mavistest-2501-1509172787-0</span><br><span class="line">USER         SomeUserName</span><br><span class="line">RESULT        ACK</span><br><span class="line">PASSWORD       SomeUserPassword</span><br><span class="line">SERIAL        QrWVmlId0OZADDRU/hy/pw=</span><br><span class="line">DBPASSWORD      SomeUserPassword</span><br><span class="line">TACMEMBER      [List of Active Directory security groups]</span><br><span class="line">TACTYPE       AUTH</span><br></pre></td></tr></table></figure>
<p>注意查看RESULT，若为ACK则表示成功，如遇见其他状态，请进行LDAP的故障排查.</p>
<h1 id="定义和术语"><a href="#定义和术语" class="headerlink" title="定义和术语"></a>定义和术语</h1><p>以下各章使用了一些术语，可能需要进一步说明：</p>
<ul>
<li><p>NAC: (Netwrok Access Client)</p>
<p>网络访问客户端，例如telnet连接的源主机。</p>
</li>
<li><p>NAS,(Network Access Server)</p>
<p>网络访问服务器，例如Cisco设备或发出TACACS +身份验证和授权请求或生成TACACS +计费数据包的任何其他客户端。</p>
</li>
<li><p>Daemon: 一个程序，为网络提供服务以请求身份验证和授权，验证身份，授予或拒绝授权以及记录计费记录。</p>
</li>
<li><p>AV pairs： 作为TACACS +协议的一部分，在NAS和TACACS +守护程序之间发送的格式为attribute = value的文本字符串。</p>
</li>
</ul>
<p>由于NAS有时被称为服务器，而守护程序也通常被称为服务器，因此在这里避免使用服务器一词，而是使用不易模糊的术语NAS和Daemon。</p>
<h2 id="TACACS，XTACACS-and-TACACS-："><a href="#TACACS，XTACACS-and-TACACS-：" class="headerlink" title="TACACS，XTACACS and TACACS+："></a>TACACS，XTACACS and TACACS+：</h2><p>作为一个有历史价值的信息，大约有三个版本的认证协议，人们可以称为TACACS:</p>
<p>第一个是普通的TACACS，在思科设备中第一次提供，并已使用多年。</p>
<p>第二个是对第一个的扩展，通常称为扩展（Extended）的TACACS或XTACACS，是在1990年引入的。<strong>两者都是基于UDP的服务。</strong></p>
<p>第三个版本是TACACS+或tac_plus，这是现在所有人都在用的版本。<strong>TACACS+基于TCP</strong>，因此不兼容任何以前版本的TACACS。</p>
<p>显然，至少有一个供应商实现了TACACS+，但将其称为HWTACACS。这背后可能没有技术(但可能是营销或法律)原因。文档是缺失的。</p>
<h1 id="操作方式（Operation）"><a href="#操作方式（Operation）" class="headerlink" title="操作方式（Operation）"></a>操作方式（Operation）</h1><p>本节简要概述了如何运行<strong>tac_plus</strong>。</p>
<p>在早期版本中，<strong>tac_plus</strong>不是一个独立程序，而必须由衍生(<strong>spawnd</strong>)程序调用。这已经改变，因为生成(<strong>spawnd</strong>)的功能现在是tac_plus二进制文件的一部分。但是，仍然可以使用专用的生成(<strong>spawnd</strong>)过程，更重要的是，生成(<strong>spawnd</strong>)的配置选项和文档仍然有效。</p>
<p>tac_plus可以使用辅助的<strong>MAVIS</strong>后端模块进行认证和授权。</p>
<h2 id="命令行语法（Command-line-syntax）："><a href="#命令行语法（Command-line-syntax）：" class="headerlink" title="命令行语法（Command line syntax）："></a>命令行语法（Command line syntax）：</h2><p>唯一必需的参数是配置文件的路径。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tac_plus [ -P ] [ -d level ] [ -i child_id ] configuration-file [ id ]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>如果程序是在CURL支持下编译的，则配置文件可能是URL。</p>
</li>
<li><p>-P：请记住-P选项-所提供的配置文件在语法上必须正确，因为如果启动时出现任何解析错误，则守护程序将不会启动。</p>
</li>
<li><p>-d：开关启用调试。很可能不想使用它。如果需要，请阅读源码。</p>
</li>
<li>-i：仅在使用内置衍生（<strong>spawnd</strong>）功能时才使用-i选项。在这种情况下，它将为tac_plus选择配置ID，而可选的最后一个参数id则设置生成（<strong>spawnd</strong>）的配置节的ID。</li>
</ul>
<h2 id="信号（Signals）："><a href="#信号（Signals）：" class="headerlink" title="信号（Signals）："></a>信号（Signals）：</h2><p>主进程（即运行派生（<strong>spawnd</strong>）代码的进程）和子进程（即运行<strong>tac_plus</strong>代码）都拦截SIGHUP信号：</p>
<ul>
<li>主进程将在接收到SIGHUP后重新启动，重新读取配置文件。子进程将识别出主进程不再可用。它将继续为现有连接提供服务，并在空闲时终止。</li>
<li>如果SIGHUP被发送到子进程，它将停止接受来自其主进程的新连接。它将继续为现有连接提供服务，并在空闲时终止。</li>
</ul>
<p>将SIGUSR1发送到主进程将导致它放弃现有的子进程（这些子进程将仅继续为现有的连接提供服务）并启动新的子进程。</p>
<h2 id="事件机制选择-Evenet-mechainsm-selection"><a href="#事件机制选择-Evenet-mechainsm-selection" class="headerlink" title="事件机制选择(Evenet mechainsm selection):"></a>事件机制选择(Evenet mechainsm selection):</h2><p>支持几种级别触发的事件机制。默认情况下，将使用最适合的你操作系统的一种。但是，可以将环境变量IO_POLL_MECHANISM设置为选择特定变量。</p>
<p>支持以下事件机制（按优先顺序）：</p>
<ul>
<li>port (Sun Solaris 10 and higher only, <code>IO_POLL_MECHANISM=32</code>)</li>
<li>kqueue (*BSD and Darwin only, <code>IO_POLL_MECHANISM=1</code>)</li>
<li>/dev/poll (Sun Solaris only, <code>IO_POLL_MECHANISM=2</code>)</li>
<li>epoll (Linux only, <code>IO_POLL_MECHANISM=4</code>)</li>
<li>poll (<code>IO_POLL_MECHANISM=8</code>)</li>
<li>select (<code>IO_POLL_MECHANISM=16</code>)</li>
</ul>
<p>可以在顶级(top-level)配置文件中设置环境变量：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenv IO_POLL_MECHANISM = 4</span><br></pre></td></tr></table></figure>
<h2 id="示例配置（Sample-Configuration）："><a href="#示例配置（Sample-Configuration）：" class="headerlink" title="示例配置（Sample Configuration）："></a>示例配置（Sample Configuration）：</h2><p>单配置文件足以配置派生（<strong>spawnd</strong>），<strong>tac_plus</strong>以及<strong>MAVIS</strong>认证和授权后端。</p>
<p>下面的<strong>spawnd</strong>配置接受<strong>TCP端口49和4949</strong>的连接，并将它们转发给一个tac_plus进程。<strong>tac_plus</strong>配置配置了几个用户组，定义了一个用户，并依赖MAVIS后端来获取其他用户。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/usr/<span class="built_in">local</span>/sbin/tac_plus</span></span><br><span class="line">id = spawnd &#123;</span><br><span class="line">    listen = &#123; port = 49 &#125;</span><br><span class="line">    listen = &#123; port = 4949 &#125;</span><br><span class="line">    # see the spawnd configuration guide for further configuration options</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">    accounting log = /var/log/tac_plus/%Y/%m/%d.log</span><br><span class="line">    retire limit = 1000</span><br><span class="line">    mavis module = external &#123;</span><br><span class="line">        exec = /usr/local/lib/mavis_tacplus_passwd.pl</span><br><span class="line">        # see the MAVIS configuration manual for more options and other modules</span><br><span class="line">    &#125;</span><br><span class="line">    login backend = mavis</span><br><span class="line"></span><br><span class="line">    host = world &#123;</span><br><span class="line">        welcome banner = "\nHitherto shalt thou come, but no further. (Job 38.11)\n\n"</span><br><span class="line">        key = QaWsEdRfTgY</span><br><span class="line">        enable 15 = clear test</span><br><span class="line">        address = 0.0.0.0/0</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    group = readwrite &#123;</span><br><span class="line">        default service = permit</span><br><span class="line">        service = shell &#123;</span><br><span class="line">            default command = permit</span><br><span class="line">            set priv-lvl = 15</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    group = getconfig &#123;</span><br><span class="line">        default service = permit</span><br><span class="line">        service = shell &#123;</span><br><span class="line">            set autocmd = "show run"</span><br><span class="line">            set priv-lvl = 15</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    user = marc &#123;</span><br><span class="line">       login = crypt $1$xxxxxxxx$hDZPHghXe8XvoHeFdqUwm/</span><br><span class="line">       member = readwrite@world</span><br><span class="line">       member = getconfig@192.168.0.0/16</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="域的示例配置-Sample-Configuration-with-Realms"><a href="#域的示例配置-Sample-Configuration-with-Realms" class="headerlink" title="域的示例配置( Sample Configuration with Realms):"></a>域的示例配置( Sample Configuration with Realms):</h2><p>这是一个更复杂的示例，承认大多数人更喜欢查看示例配置，而不是实际阅读文档。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">syslog default = deny</span><br><span class="line"></span><br><span class="line">id = spawnd &#123;</span><br><span class="line"><span class="meta">  #</span><span class="bash"> Really, have a look at the spawnd configuration. There are</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> lots of useful options.</span></span><br><span class="line"></span><br><span class="line">  listen = &#123;</span><br><span class="line">    port = 4949</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  listen = &#123;</span><br><span class="line">    port = 4950 realm = core</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">  client realm = adminRealm     # Could specify these</span><br><span class="line">  aaa realm = local             # at host level, too.</span><br><span class="line">  dns reverse-lookup = no</span><br><span class="line"></span><br><span class="line">  realm = adminRealm &#123;</span><br><span class="line">    host = myPCs &#123;</span><br><span class="line">      address = 192.0.2.8,192.0.2.24/29</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  realm = customerRealm &#123;</span><br><span class="line">    dns reverse-lookup = yes</span><br><span class="line">    host = customer &#123;</span><br><span class="line">      address = 172.16.0.0/12</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> This will be placed <span class="keyword">in</span> the <span class="string">"default"</span> realm</span></span><br><span class="line">  host = cpeRouters &#123;</span><br><span class="line">    address = 0.0.0.0/0</span><br><span class="line">    key = myKey</span><br><span class="line">    welcome banner = "Welcome C=%%C Time=%c\n"</span><br><span class="line">    client realm = customerRealm</span><br><span class="line">    aaa realm = ldapRealm</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> And this one <span class="keyword">in</span> the <span class="string">"core"</span> realm. Could write this as</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> realm = ... &#123; host = ... &#125;, too.</span></span><br><span class="line">  host realm core = coreRouters &#123;</span><br><span class="line">    address = 0.0.0.0/0</span><br><span class="line">    key = CoreKey</span><br><span class="line">    client realm = adminRealm</span><br><span class="line">    aaa realm = unixRealm</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  realm = unixRealm &#123;</span><br><span class="line">    mavis module = groups &#123;</span><br><span class="line">      resolve gids = yes</span><br><span class="line">      groups filter = /^(guest|staff)$/</span><br><span class="line">      script out = &#123;</span><br><span class="line">        # copy the already filtered UNIX group access list to TACMEMBER</span><br><span class="line">        eval $GIDS =~ /^(.*)$/</span><br><span class="line">        set $TACMEMBER = $1</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mavis module = external &#123;</span><br><span class="line">      exec = /usr/local/sbin/pammavis pammavis -s mavis</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    user backend = mavis</span><br><span class="line">    login backend = mavis chpass</span><br><span class="line"></span><br><span class="line">    group = staff &#123;</span><br><span class="line">      service = shell &#123;</span><br><span class="line">        set priv-lvl = 15</span><br><span class="line">        script = &#123;</span><br><span class="line">          if (cmd == "") permit # shell startup</span><br><span class="line">          if (cmd =~ /^configure/) permit</span><br><span class="line">        &#125;</span><br><span class="line">        message debug = "author '%c %a'"</span><br><span class="line">        cmd = show &#123; permit .* &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    group = guest &#123;</span><br><span class="line">      member = staff</span><br><span class="line">      service = shell &#123;</span><br><span class="line">        cmd = show &#123; permit .* &#125;</span><br><span class="line">        message deny = "denied by t+"</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  realm = ldapRealm &#123;</span><br><span class="line">    mavis module = external &#123;</span><br><span class="line">      exec = /usr/local/lib/mavis/mavis_tacplus_ads.pl</span><br><span class="line">      setenv USE_TLS = 0</span><br><span class="line">      setenv LDAP_HOSTS = "192.0.2.193"</span><br><span class="line">      setenv LDAP_SCOPE = sub</span><br><span class="line">      setenv LDAP_BASE = "dc=example,dc=com"</span><br><span class="line">    &#125;</span><br><span class="line">    user backend = mavis</span><br><span class="line">    login backend = mavis</span><br><span class="line">    pap backend = mavis</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  realm = localRealm &#123;</span><br><span class="line">    user = marc &#123;</span><br><span class="line">      password = clear marc</span><br><span class="line">      service = shell &#123;</span><br><span class="line">        default command = permit</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="配置语法-Configuration-Syntax"><a href="#配置语法-Configuration-Syntax" class="headerlink" title="配置语法(Configuration Syntax)"></a>配置语法(Configuration Syntax)</h1><p>以下各节所涵盖的配置节将放置在如下花括号之间。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id = tac_plus = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><p><strong>配置文件中的注释:</strong></p>
<p>注释可以出现在配置文件中的任何地方，从<strong>#</strong>字符开始，一直延伸到当前行的末尾。如果您需要禁用#字符的特殊含义，例如，如果您有一个密码包含一个#字符，只需将包含它的字符串括在双引号内。</p>
</li>
<li><p>Including Files (包含文件)：</p>
<p>配置文件可能引用其他配置文件，<code>include =</code> <em>file</em> </p>
<p>将读取并解析file。 Shell通配符模式由glob（3）扩展。 include语句几乎可以在任何地方接受（但不能在注释或文本字符串中）。</p>
</li>
</ul>
</blockquote>
<p>建议的配置文件写入顺序为：</p>
<ol>
<li>global definitions</li>
<li>hosts</li>
<li>timespecs</li>
<li>acls</li>
<li>groups</li>
<li>users</li>
</ol>
<p>该非随机顺序背后的原因是，配置的某些部分可能会使用其他部分，并且这些部分需要在使用之前存在。</p>
<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/TacplusConfig.gif" alt="img"></p>
<center> 图：TacPlusConfig配置文件加载顺序示意图</center>

<h2 id="全局配置选项（Global-options）："><a href="#全局配置选项（Global-options）：" class="headerlink" title="全局配置选项（Global options）："></a>全局配置选项（Global options）：</h2><p>全局配置部分可能包含以下配置指令，以及下一节详细介绍的（<strong>realm</strong>）选项。在全局级别定义的<strong>realm</strong>选项将隐含地分配给（<strong>defalut realm</strong>），并将继承给随后定义的（<strong>realm</strong>）。</p>
<h3 id="Limits-and-timeouts"><a href="#Limits-and-timeouts" class="headerlink" title="Limits and timeouts:"></a>Limits and timeouts:</h3><p>可以专门在全局级别上指定许多全局<strong>限制(Limits)和超时(timeouts)</strong>：</p>
<ul>
<li><p><code>retire limit =</code> <em>n</em></p>
<p>特定的守护程序实例将在处理n个请求后终止。如果需要，<strong>spawnd</strong>的实例将生成一个新实例。</p>
<p><strong>Default: unset</strong></p>
</li>
<li><p><code>retire timeout =</code> <em>s</em> </p>
<p>特定的守护程序实例将在s秒后终止。如有必要，spawned将产生一个新实例。</p>
<p><strong>Default: unset</strong></p>
</li>
</ul>
<blockquote>
<p>Time units(时间单位)：</p>
<ul>
<li>将s，m，h或d附加到任何超时值将按预期缩放该值。</li>
</ul>
</blockquote>
<h3 id="DNS："><a href="#DNS：" class="headerlink" title="DNS："></a>DNS：</h3><p>tac_plus可以使用静态DNS条目，如果使用<code>lwres</code>支持进行编译，则可以使用动态DNS条目。全局级别的相关全局配置选项是：</p>
<ul>
<li><p><code>dns cleanup period =</code> <em>s</em></p>
<p>经过多少时间，从缓存中删除未使用的动态DNS数据。 （默认：8小时。）</p>
</li>
<li><p><code>dns preload address</code> <em>address</em> <code>=</code> <em>hostname</em></p>
<p>使用地址到主机名（<em>address</em>-to-<em>hostname</em> ）的映射预加载DNS缓存。</p>
</li>
<li><p><code>dns preload file =</code> <em>filename</em></p>
<p>使用文件名中的地址到主机名（<em>address</em>-to-<em>hostname</em> ）的映射预加载DNS缓存。</p>
</li>
</ul>
<p>dns配置示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dns preload address 1.2.3.4 = router.example.com</span><br><span class="line">dns preload file = /etc/hosts</span><br><span class="line"></span><br><span class="line">host = router.example.com &#123;</span><br><span class="line">    # "address = 1.2.3.4" is actually implied</span><br><span class="line">    key = mykey</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Process-specific-options-特定的进程选项-："><a href="#Process-specific-options-特定的进程选项-：" class="headerlink" title="Process-specific options(特定的进程选项)："></a>Process-specific options(特定的进程选项)：</h4><p>有几个特定于进程的选项可用：</p>
<ul>
<li><p><code>userid =</code> <em>uid</em></p>
<p>在用户标识uid下运行守护进程。不建议使用此选项。</p>
</li>
<li><p><code>groupid =</code> <em>gid</em></p>
<p>在组ID gid下运行守护进程。不建议使用此选项。</p>
</li>
<li><p><code>working directory =</code> <em>directory</em></p>
<p>将当前工作目录更改为directory。</p>
</li>
<li><p><code>coredump directory =</code> <em>directory</em></p>
<p>（Dump cores to <em>directory</em>）将核心转储到directory。你真的不需要这个。</p>
</li>
</ul>
<h3 id="Railroad-Diagrams（铁路图）："><a href="#Railroad-Diagrams（铁路图）：" class="headerlink" title="Railroad Diagrams（铁路图）："></a>Railroad Diagrams（铁路图）：</h3><p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/GlobalDecl.gif" alt="img"></p>
<center> 图：Railroad diagram: GlobalDecl </center>

<blockquote>
<p>铁路图（railroad diagram)，又叫<strong>语法图(syntax diagrams)</strong>，是一种表示形式语法的方式，是巴科斯范式和扩展巴科斯范式的图形化表示。</p>
<p>巴科斯范式（英语：Backus Normal Form，缩写为 BNF），又称为巴科斯-诺尔范式（英语：Backus-Naur Form，缩写同样为 BNF，也译为巴科斯-瑙尔范式、巴克斯-诺尔范式），是一种用于表示上下文无关文法的语言，上下文无关文法描述了一类形式语言。它是由约翰·巴科斯（John Backus）和彼得·诺尔（Peter Naur）首先引入的用来描述计算机语言语法的符号集。</p>
<p>尽管巴科斯范式也能表示一部分自然语言的语法，它还是更广泛地使用于程序设计语言、指令集、通信协议的语法表示中。大多数程序设计语言或者形式语义方面的教科书都采用巴科斯范式。在各种文献中还存在巴科斯范式的一些变体，如扩展巴科斯范式 EBNF 或扩充巴科斯范式 ABNF。<br><a href="https://zh.wikipedia.org/wiki/%E5%B7%B4%E7%A7%91%E6%96%AF%E8%8C%83%E5%BC%8F" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E5%B7%B4%E7%A7%91%E6%96%AF%E8%8C%83%E5%BC%8F</a></p>
<h2 id="基本规则"><a href="#基本规则" class="headerlink" title="基本规则"></a><strong>基本规则</strong></h2><ol>
<li>从左边界开始，沿着轨道到右边界。</li>
<li>沿途，你在圆框中遇到的是字面量，在方块中遇到的是规则或描述。</li>
<li>任何沿着轨道能走通的序列都是合法的。</li>
<li>任何不能沿着轨道走通的序列都是非法的。</li>
<li>末端只有一个竖条的铁路图，表示允许在任意一对符号中插入空白。而在末端有两个竖条的铁路图则不允许。</li>
</ol>
<p>参考资料：<a href="http://jokerliang.com/read-railroad-diagram.html" target="_blank" rel="noopener">http://jokerliang.com/read-railroad-diagram.html</a></p>
</blockquote>
<h2 id="Realms："><a href="#Realms：" class="headerlink" title="Realms："></a>Realms：</h2><p>历史上，Realms是在<strong>spawnd</strong>配置部分的listen指令中引入的：</p>
<blockquote>
<ul>
<li>Realm : n. 领域，范围；王国, 在这里可表示<strong>域</strong> ，类似domain。</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spawnd = &#123;</span><br><span class="line">  listen = &#123; port = 49 &#125;</span><br><span class="line">  listen = &#123; port = 3939 &#125;</span><br><span class="line">  listen = &#123; port = 4949 realm = oneRealm&#125;</span><br><span class="line">  listen = &#123; port = 5959 realm = otherRealm&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Default Realm</strong></p>
<ul>
<li><p>如果spawned没有提供realm名称，则tac_plus将退回到使用名为default的realm，其中包含所有在realm上下文中未定义的特定于realm的指令。</p>
<p>可以在在全局配置级别选择实际的默认Realm。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;   default realm = RealmName</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p><strong>Spawnd</strong>组件的主要任务是接受连接并将其（包括相关realm）转发到tac_plus进程。然后，tac_plus使用该realm将正确的主机对象层次结构分配给连接。</p>
<p>使用（和定义）realm的首选语法是:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">realm = realmName &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>在全局配置级别,realm可能包括主机，用户，组，MAVIS配置和各种其他配置选项。realm和主机可以参考其他realm进行认证。</p>
<p>更准确地说，realm的三种用途是：</p>
<ol>
<li><p>Authentication, Authorization and Accounting Realms</p>
<p>与用户和用户组有关的所有内容（包括日志记录）都在AAA realm中进行配置。可以使用以下命令在全局，realm和主机级别选择要使用的AAA realm指令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa realm = realmName</span><br></pre></td></tr></table></figure>
</li>
<li><p>Network Access Server Realms</p>
<p>这是定义NAS主机对象的域。在此域(realms)上下文中定义了主机和NAS特定的参数.</p>
</li>
<li><p>Network Acccess Client Realms</p>
<p>可以从NAC域检索NAC特定参数，该参数可以在全局，realms和主机级别指定：<code>nac realm = realmName</code></p>
<p>例如，这可以用于在每个域的基础上为远程客户端启用DNS反向查找。</p>
</li>
</ol>
<p>定义域(realms)是可选的。如前所述，在顶级(top-level)定义的域(realm)选项将分配给默认域(default realm)，这实际上是aaa和nac域的默认域。</p>
<p><strong>Railroad Disgrams(铁路图)：</strong></p>
<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/RealmDecl.gif" alt="img"></p>
<center>图：Railroad diagram: RealmDecl </center>

<h2 id="Realm-options-域选项-："><a href="#Realm-options-域选项-：" class="headerlink" title="Realm options(域选项)："></a>Realm options(域选项)：</h2><p>可以在域和全局级别指定以下选项：</p>
<h3 id="Logging（日志）："><a href="#Logging（日志）：" class="headerlink" title="Logging（日志）："></a>Logging（日志）：</h3><p>该软件提供以下日志：</p>
<ul>
<li><p>Authentication</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authentication log = log_destination</span><br></pre></td></tr></table></figure>
</li>
<li><p>Authorization</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authorization log = log_destination</span><br></pre></td></tr></table></figure>
</li>
<li><p>Accounting</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accounting log = log_destination</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>日志也可以写入多个目标（destinations）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  authentication log = log_1</span><br><span class="line">  authentication log = log_2</span><br><span class="line">...</span><br><span class="line">  authentication log = log_n</span><br></pre></td></tr></table></figure>
<p>有效的日志目标(destinations)是：</p>
<ul>
<li><p>Files</p>
<p>为了记录到普通磁盘文件，使用fcntl(2)文件锁定，因此建议文件驻留在本地文件系统上。尽管某些Unix实现支持NFS上的fcntl锁定，但它是出了名的不可靠，而且即使您的实现是可靠的，锁定在NFS上的效率也可能非常低。</p>
<p>如果基础文件系统支持原子追加，则可能不需要fcntl（2）文件锁定。在日志destinations之前添加”&gt;”字符将关闭文件锁定，并将日志文件处理切换为同步(synchronous)模式。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> async</span></span><br><span class="line">  authentication log = /var/log/tac_plus/access1.log</span><br><span class="line"><span class="meta">#</span><span class="bash"> sync:</span></span><br><span class="line">  authentication log = "&gt;/var/log/tac_plus/access2.log"</span><br></pre></td></tr></table></figure>
</li>
<li><p>Commands</p>
<p>如果日志destination以”|”开头字符将运行运行目标参数其余部分的shell，并且将在标准输入上将日志消息馈送到该shell。例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authentication log = "|exec /usr/bin/logger"</span><br></pre></td></tr></table></figure>
<p>（这里的exec并不是严格必需的，但是避免保留原本空闲的shell进程。）</p>
</li>
<li><p>Syslog</p>
<p>可以使用syslog关键字启用登录到syslogd（8）的功能</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accounting log = syslog</span><br></pre></td></tr></table></figure>
<p>（它将使用您的系统syslog（3）函数进行记录，或通过以下语法。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accounting log = Address[:UDPPort]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>此外，可以使用命名的日志目标（ destinations ），例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">log = mylog &#123;</span><br><span class="line">    destination = 169.254.0.23 # UDP syslog</span><br><span class="line">    # or one of the following:</span><br><span class="line">    # destination = [fe80::123:4567:89ab:cdef]:514 # IPv6 UDP, with non-standard UDP port</span><br><span class="line">    # destination = "/tmp/x.log" # plain file</span><br><span class="line">    # destination = "&gt;/tmp/x.log" # plain file</span><br><span class="line">    # destination = "|my_script.sh" # script</span><br><span class="line">    # destination = syslog # syslog(3)</span><br><span class="line">    #</span><br><span class="line">    syslog compliance = RFC3164 # this is the default for UDP syslog</span><br><span class="line">    # syslog compliance = RFC5424 # this loosely matches the new syslog standard</span><br><span class="line">    syslog facility = MAIL # sets log facility</span><br><span class="line">    syslog level = DEBUG # sets log level</span><br><span class="line">    log separator = "|" # The actual default for syslog, for others it's "\t"</span><br><span class="line">  &#125;</span><br><span class="line">  authentication log = mylog</span><br><span class="line">  accounting log = mylog</span><br><span class="line">  authorization log = mylog</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Syslog:</p>
<p>可以使用以下命令禁用登录syslogd（8）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> syslog default = deny</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>日志目标可能包含strftime（3）样式的字符序列，例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">authorization log = /var/log/tac_plus/%Y/%m/%d.auth</span><br></pre></td></tr></table></figure>
<p>自动执行基于时间的日志文件切换。默认情况下，守护程序将使用您的本地时区进行时间转换。您可以使用时区(time zone)选项（请参见下文）切换到另一种。</p>
<p>还有一些其他配置选项可能会有用：</p>
<ul>
<li><p><code>date format =</code> <em>string</em></p>
<p>这在随后定义的日志文件中定义了日期（和时间）表示形式的格式字符串。默认：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date format = "%Y-%m-%d %H:%M:%S %z"</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>log separator =</code> <em>string</em></p>
<p>这将为随后定义的日志文件中的日志条目定义CSV分隔符字符串。默认：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log separator = "\t"</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>time zone =</code> <em>time-zone</em></p>
<p>默认情况下，守护程序使用您的本地系统时区将内部系统时间转换为日历时间。此选项将<code>TZ</code>环境变量设置为时区参数。</p>
</li>
<li><p><code>umask =</code> <em>mode</em></p>
<p>这将设置文件创建模式掩码。例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umask = 0640</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>authorization log group =</code> ( <code>yes</code> | <code>no</code> )</p>
<p>进行设置，以将最后一个匹配组的名称附加到授权日志中的用户名（由单个“ /”字符分隔）。</p>
</li>
</ul>
<h4 id="Accounting："><a href="#Accounting：" class="headerlink" title="Accounting："></a>Accounting：</h4><p>所有accounting记录均以文本形式写入到用计费日志指令指定的文件（或command）中。 计费记录是包含制表符分隔字段的文本行。前6个字段始终相同。这些是：</p>
<ul>
<li>timestamp</li>
<li>NAS address</li>
<li>username</li>
<li>port</li>
<li>NAC address</li>
<li>record type</li>
</ul>
<p>在这些之后，根据计费记录类型，将写入可变数量的字段。所有形式均为attribute = value。总会有一个task_id字段。</p>
<p>当前属性是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unknown service start_time port elapsed_time status priv_level cmd protocol cmd-arg bytes_in bytes_out paks_in paks_out address task_id callback-dialstring nocallback-verify callback-line callback-rotary</span><br></pre></td></tr></table></figure>
<p>随着时间的推移，可能会添加更多内容。</p>
<p>如下，是示例记录（为便于阅读而换行）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1995-07-13 13:35:28 -0500  172.16.1.4  chein  tty5   198.51.100.141</span><br><span class="line">        stop   task_id=12028  service=exec  port=5   elapsed_time=875</span><br><span class="line">1995-07-13 13:37:04 -0500  172.16.1.4  lol    tty18  198.51.100.129</span><br><span class="line">        stop   task_id=11613  service=exec  port=18  elapsed_time=909</span><br><span class="line">1995-07-13 14:09:02 -0500  172.16.1.4  billw  tty18  198.51.100.152</span><br><span class="line">        start  task_id=17150  service=exec  port=18</span><br><span class="line">1995-07-13 14:09:02 -0500  172.16.1.4  billw  tty18  198.51.100.152</span><br><span class="line">        start  task_id=17150  service=exec  port=18</span><br></pre></td></tr></table></figure>
<p>运行的时间以秒为单位，这是大多数人通常感兴趣的领域。</p>
<p>在NAS上，要获得与tacacs先前版本等效的计费记录，以下内容就足够了。 “Stop”记录包含连接和执行会话的运行时间。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">aaa accounting system default start-stop group tacacs+</span><br><span class="line">aaa accounting exec default start-stop group tacacs+</span><br><span class="line">aaa accounting exec acctlist stop-only group tacacs+</span><br><span class="line">aaa accounting commands 15 acctlist start-stop group tacacs+</span><br><span class="line">aaa accounting network acctlist stop-only group tacacs+</span><br><span class="line"></span><br><span class="line">line XX</span><br><span class="line">  accounting commands 15 acctlist</span><br></pre></td></tr></table></figure>
<h4 id="Spoofing-Syslog-Packets-欺骗Syslog数据包"><a href="#Spoofing-Syslog-Packets-欺骗Syslog数据包" class="headerlink" title="Spoofing Syslog Packets(欺骗Syslog数据包):"></a>Spoofing Syslog Packets(欺骗Syslog数据包):</h4><p>脚本tacspooflog.pl（与发行版捆绑在一起）可用于使syslogd认为日志直接来自路由器，而不是来自tac_plus。 例如，如果您的syslogd正在监听127.0.0.1，则可以尝试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access log = "|exec sudo /path/to/tacspooflog.pl 127.0.0.1"</span><br></pre></td></tr></table></figure>
<p>如果要将日志保存在一个公共位置，这可能很有用。请注意，这仅适用于IPv4。</p>
<h3 id="Limits-and-timeouts-1"><a href="#Limits-and-timeouts-1" class="headerlink" title="Limits and timeouts:"></a>Limits and timeouts:</h3><p>在域和全局级别可以指定许多全局限制和超时：</p>
<ul>
<li><p><code>connection timeout =</code> <em>s</em></p>
<p>闲置至少s秒后，终止与NAS的连接。Default: 600</p>
</li>
<li><p><code>context timeout =</code> <em>s</em></p>
<p>s秒钟不活动后清除上下文缓存条目。默认值：3600秒。</p>
<p>Default: 3600</p>
</li>
<li><p><code>warning period =</code> <em>d</em></p>
<p>将密码过期的警告期限设置为d天。Default: 14</p>
</li>
</ul>
<h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS:"></a>DNS:</h4><p>tac_plus可以使用静态DNS条目，如果使用lwres支持进行编译，则可以使用动态DNS条目。相关域配置选项为：</p>
<ul>
<li><p><code>dns reverse-lookup =</code> ( <code>yes</code> | <code>no</code> )</p>
<p>这将设置DNS反向查询的全局默认值（默认值：no）。</p>
</li>
<li><p><code>dns timeout =</code> <em>Seconds</em></p>
<p>该指令指定进行DNS反向查找时要等待的最长时间。 （默认值：0）。</p>
</li>
</ul>
<h4 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication:"></a>Authentication:</h4><ul>
<li><p><code>password</code> ( <code>max-attempts =</code> <em>integer</em> | <code>backoff =</code> <em>seconds</em> )</p>
<p><strong>backoff</strong>为失败的认证设置退避时间。守护进程将等待几秒钟，然后返回最终的认证失败（密码错误）消息。</p>
<p><strong>max-attempts</strong>参数限制登录时每个TACACS +会话的密码：提示的数量。当前默认为1，这意味着带有错误密码的典型登录序列如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> telnet 10.0.0.2</span></span><br><span class="line">Trying 10.0.0.2...</span><br><span class="line">Connected to 10.0.0.2.</span><br><span class="line">Escape character is '^]'.</span><br><span class="line"></span><br><span class="line">Welcome. Authorized Use Only.</span><br><span class="line"></span><br><span class="line">Username: admin</span><br><span class="line">Password: ***</span><br><span class="line">Password incorrect.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Welcome. Authorized Use Only.</span><br><span class="line"></span><br><span class="line">Username: admin</span><br><span class="line">Password: ****</span><br><span class="line">Password incorrect.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Welcome. Authorized Use Only.</span><br><span class="line"></span><br><span class="line">Username: admin</span><br><span class="line">Password: *</span><br><span class="line">Password incorrect.</span><br><span class="line"></span><br><span class="line">Connection closed by foreign host.</span><br></pre></td></tr></table></figure>
<p>使用示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password max-attempts = 3</span><br></pre></td></tr></table></figure>
<p>（早期版本中的实际默认值为4）会将此对话框更改为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> telnet 10.0.0.2</span></span><br><span class="line">Trying 10.0.0.2...</span><br><span class="line">Connected to 10.0.0.2.</span><br><span class="line">Escape character is '^]'.</span><br><span class="line"></span><br><span class="line">Welcome. Authorized Use Only.</span><br><span class="line"></span><br><span class="line">Username: admin</span><br><span class="line">Password: ***</span><br><span class="line"></span><br><span class="line">Password incorrect.</span><br><span class="line">Password: ****</span><br><span class="line"></span><br><span class="line">Password incorrect.</span><br><span class="line">Password: *****</span><br><span class="line"></span><br><span class="line">Password incorrect. Go away.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Welcome. Authorized Use Only.</span><br><span class="line"></span><br><span class="line">Username:</span><br></pre></td></tr></table></figure>
<p>如果新的TACACS +认证失败，则由NAS决定重新启动带有新TACACS +会话的认证对话框，或关闭与用户的（Telnet / SSH / …）会话。</p>
</li>
<li><p><code>anonymous-enable =</code> ( <code>permit</code> | <code>deny</code> )</p>
<p>一些失效的TACACS+实现在启用包中发送no或无效的用户名。若设置此选项为deny，则试图在enable之前强制执行认证。此选项默认为permit。</p>
<p>这可能会或可能不会。从理论上讲，启用对话框应类似于：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Router&gt;</span><span class="bash"> <span class="built_in">enable</span></span></span><br><span class="line">Username: me</span><br><span class="line">Password: *******</span><br><span class="line">Enable Password: **********</span><br><span class="line"><span class="meta">Router#</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p>但是，某些实现可能会在“Enable Password：”提示下重新发送用户密码。在这种情况下，您只有两种选择：无论使用<code>enable = login</code> 在用户组级别，将省略辅助密码查询并让用户使用其登录密码启用，或允许匿名enable（默认情况下处于disabled状态） <code>anonymous-enable = permit</code> （全局或主机级别），并使用在主机级别定义的enable passwords。</p>
</li>
<li><p><code>augmented-enable =</code> ( <code>permit</code> | <code>deny</code> )</p>
<p>对于在enable请求中发送<code>$enable$</code>而不是实际用户名的TACACS +客户端实现，这将允许使用用户名和登录密码的连接（以一个空格字符分隔）进行用户特定的认证：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">enable</span></span></span><br><span class="line">Password: myusername mypassword</span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<p>enable [level] =需要在用户个人资料中设置登录名，此选项才能生效。</p>
<p>默认: <code>augmented-enable = deny</code></p>
<p>augmented-enable 仅在NAS尝试验证与正则表达式匹配的用户名时才会生效<code>^\$enab..\$$</code> . 例如：<code>$enable$</code>，<code>$enab15$</code>）。可以使用ACL更改匹配条件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">acl script = custom_enable_acl &#123; if (user =~ ^demo$) permit deny &#125;</span><br><span class="line">enable user acl = custom_enable_acl</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Miscellaneous-杂项"><a href="#Miscellaneous-杂项" class="headerlink" title="Miscellaneous(杂项):"></a>Miscellaneous(杂项):</h4><ul>
<li><p><code>ingle-connection</code> [ <code>may-close</code> ] <code>=</code> ( <code>yes</code> | <code>no</code> )</p>
<p>此指令可用于允许(permit)或拒绝(deny)单连接功能。 may-close关键字告诉守护进程如果未使用关闭连接（默认值：disabled）。在主机对象级别可以覆盖此指令。</p>
</li>
<li><p><code>skip conflicting groups =</code> ( <code>yes</code> | <code>no</code> )</p>
<p>如果设置了该选项，则在组成员指令中将忽略组冲突。为给定的NAS定义的第一组获胜。</p>
</li>
<li><p><code>skip missing groups =</code> ( <code>yes</code> | <code>no</code> )</p>
<p>如果设置了该选项，则在成员指令中将忽略不存在的组。</p>
</li>
<li><p><code>client realm =</code> <em>realm</em></p>
<p>在域中查找NAC参数，而不使用默认值。</p>
</li>
</ul>
<h5 id="User-backend-options-用户后端选项-："><a href="#User-backend-options-用户后端选项-：" class="headerlink" title="User backend options(用户后端选项)："></a>User backend options(用户后端选项)：</h5><p>这些选项与配置MAVIS用户后端有关：</p>
<ul>
<li><p><code>aaa realm =</code> <em>realmName</em></p>
<p>使用域(realm)中的aaa配置（用户，组，mavis等），而不使用默认(default)配置。</p>
</li>
<li><p><code>group realm =</code> <em>realmName</em></p>
<p>使用域(realm)中的aaa的组配置（用户，组，mavis等），而不使用默认(default)配置。</p>
</li>
<li><p><code>pap password</code> [ <code>default</code> ] <code>=</code> ( <code>login</code> | <code>pap</code> )</p>
<p>设置为登录时，新用户的默认PAP密码将设置为使用登录密码。</p>
</li>
<li><p><code>pap password mapping =</code> ( <code>login</code> | <code>pap</code> )</p>
<p>设置为<code>login</code>时，PAP认证请求将映射到ASCII登录请求。您可能希望将其用于NEXUS设备。 在主机级别可以被覆盖。</p>
</li>
<li><p><code>user backend = mavis</code></p>
<p>从MAVIS后端获取用户数据。如果没有该指令，则只能使用本地定义的用户，并且MAVIS后端只能用于验证已知用户（password= mavis或类似）</p>
</li>
<li><p><code>pap backend = mavis</code> [ <code>prefetch</code> ]</p>
<p>使用MAVIS后端验证PAP密码。为了使用MAVIS后端对PAP请求进行认证，需要将其设置为mavis或prefetch。如果未设置，则将使用用户个人资料中的PAP密码。</p>
<p>如果指定了prefetch，则守护进程将首先从后端检索用户的配置文件，然后根据最终在那里找到的信息对用户进行身份验证。</p>
<p>该指令表示用户 <code>user backend = mavis</code>.</p>
</li>
<li><p><code>login backend = mavis</code> [ <code>prefetch</code> ] [ <code>chalresp</code> [ <code>noecho</code> ] ] [ <code>chpass</code> ]</p>
<p>使用MAVIS后端验证登录密码。需要将其设置为mavis或prefetch，以便使用MAVIS后端对登录请求进行身份验证。如果未设置，将使用用户个人资料中的登录密码。</p>
<p>如果指定了prefetch，则守护进程将首先从后端检索用户的配置文件，然后根据最终在那里找到的信息对用户进行认证。</p>
<p>该指令表示用户 <code>user backend = mavis</code>.</p>
<p>要与启用OPIE的MAVIS模块一起使用，请添加chalresp关键字（以及（可选）添加noecho，除非您希望键入的响应显示在屏幕上）。例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login backend = mavis chalresp noecho</span><br></pre></td></tr></table></figure>
<p>对于非本地用户，如果设置了chpass属性，并且用户在登录时提供了空密码，则可以为用户提供更改其密码的选项。这需要在MAVIS后端模块中提供适当的支持。</p>
</li>
<li><p><code>mavis module =</code> <em>module</em> <code>{</code> … <code>}</code></p>
<p>加载MAVIS模块 module。请参阅MAVIS文档以获取配置指南。</p>
</li>
<li><p><code>mavis path =</code> <em>path</em></p>
<p>将路径添加到MAVIS模块的搜索路径。</p>
</li>
<li><p><code>mavis cache timeout =</code> <em>s</em></p>
<p>将MAVIS认证数据缓存s秒。如果s设置为小于11的值，则动态用户对象仅对当前TACACS +会话有效。默认值为120秒。</p>
</li>
<li><p><code>mavis noauthcache</code></p>
<p>禁用MAVIS模块的密码缓存。</p>
</li>
<li><p><code>mavis user filter =</code> [ <code>not</code> ] <em>acl</em></p>
<p>仅当acl匹配时查询MAVIS用户后端。默认为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">acl script = __internal__username_acl__ &#123; if (user =~ "[]&lt;&gt;/()|=[]+") deny permit &#125;</span><br><span class="line">mavis user filter = __internal__username_acl__</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Railroad-Diagrams（铁路图）：-1"><a href="#Railroad-Diagrams（铁路图）：-1" class="headerlink" title="Railroad Diagrams（铁路图）："></a>Railroad Diagrams（铁路图）：</h4><p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/RealmAttr.gif" alt="img"></p>
<center>图： Railroad diagram: RealmAttr </center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/RealmAttrAuthen.gif" alt="img"></p>
<center>图：Railroad diagram: RealmAttrAuthen </center>

<h2 id="Hosts-主机-："><a href="#Hosts-主机-：" class="headerlink" title="Hosts(主机)："></a>Hosts(主机)：</h2><p>守护进程将仅与已知的NAS地址对话。来自未知地址的连接将被拒绝。</p>
<p>如果您想要<strong>tac_plus</strong>加密它的数据包(您几乎肯定想要这样做，因为其中可能包含用户名和密码)，那么您必须指定一个(非空的)加密密钥。在与tac_plus通信的任何NAS上也必须配置相同的密钥。</p>
<p>要指定全局密钥，请使用类似于以下内容的语句：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">host = 0.0.0.0/0 &#123;</span><br><span class="line">    key = "your key here"</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>或者：（其中world不是关键字，而只是一些任意字符串）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">host = world &#123;</span><br><span class="line">   key = "your key here"</span><br><span class="line">   address = 0.0.0.0/0</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Double Quotes(双引号)</strong> </p>
<p>如果您的密钥包含空格，则只需要在守护进程上使用双引号即可。令人困惑的是，即使您的密钥确实包含空格，在NAS上配置匹配密钥时也绝不能使用双引号。</p>
<p>守护进程将拒绝来自未定义加密密钥的主机的连接。</p>
<p>双引号字符串中的双引号可以使用<strong>反斜杠（backslash）</strong>字符\（可以自身转义）进行转义，例如： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> key = <span class="string">"quo\\te me\"."</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>转换为ASCII序列,<code>quo\te me&quot;.</code></p>
</blockquote>
<p>主机定义中的任何CIDR范围都需要是唯一的，并且最具体的定义将匹配。对无歧义性的要求非常简单，因为某些主机对象属性(密钥、提示符、enable passwords)可能只存在一次。</p>
<p>在NAS上，还需要配置相同的密钥。通过发出以下命令来做到这一点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaa new-model</span><br><span class="line">tacacs-server host 192.168.0.1 single-connection key your key here</span><br></pre></td></tr></table></figure>
<p>可选的(single-connection)单连接参数指定多个会话可以使用到服务器的相同TCP / IP连接。</p>
<p>通常，主机声明的语法符合 :</p>
<p>​    <code>host =</code> [ <code>realm</code> <em>realm</em> ] <em>name_or_ip-range</em> { <em>key-value pairs</em> }` </p>
<p>可选realm域告诉守护程序仅将主机定义用于与相应的spawnd或client (realm)域关联的连接。例如，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">id = spawnd &#123;</span><br><span class="line">  listen = &#123; port = 49 &#125;</span><br><span class="line">  listen = &#123; port = 4949 realm = space &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">  host = earth &#123; address = ::/0 ... &#125;</span><br><span class="line">  host realm space = mars &#123; address = ::/0 ... &#125;</span><br><span class="line">  group = admin &#123; ... &#125;</span><br><span class="line">  group = alien &#123; ... &#125;</span><br><span class="line">  user = marc &#123; member = admin@earth member = alien@mars &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>组成员身份取决于NAS用于联系TACACS +服务器的地址和/或端口。 marc用户将是通过端口49连接的网络访问服务器的admin组的成员，对于使用端口4949的用户将是alien的成员。</p>
<p>在大多数情况下，可以通过IP地址或名称来引用主机。</p>
<p>下面说明配置文件的(Hosts)主机部分中允许的键值对。</p>
<ul>
<li><p><code>key</code> [ <code>warn</code> [ ( <em>YYYY</em><code>-</code><em>MM</em><code>-</code><em>DD</em> | <em>s</em> ) ] <code>=</code> <em>string</em></p>
<p>这将设置用于加密服务器和NAS之间通信的密钥。可以设置多个key，使key从一个key迁移到另一个key非常容易。如果指定了warn关键字，则在NAS实际使用该密钥时将记录一条警告消息。warn关键字可选接受一个日期参数，该参数指定警告应该在何时开始出现在日志中。</p>
<p>在调试期间，使用空密钥暂时关闭加密可能会很方便：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key = &quot;&quot;</span><br></pre></td></tr></table></figure>
<p>完成调试后，请记住记住再次打开加密。</p>
</li>
<li><p><code>usage =</code> ( <code>all</code> | <code>any</code> | <code>client</code> | <code>server</code> | <code>group-membership</code>| <code>none</code> )</p>
<p>如果设置为client或none，那么来自与主机对象匹配的地址的TACACS+会话请求将被拒绝。同样，如果设置为server或none，则从与主机对象匹配的地址发起的登录将被拒绝。如果设置了group-membership关系，则主机定义只能用于组成员关系分配。</p>
<p>此设置从超级网络(supernet)继承到其子网，并且默认为<code>any</code>.</p>
<blockquote>
<p>Realms:</p>
<p>可以将usage与realms结合起来，以严格区分客户端和服务器主机定义：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment"># A "clients"-realm that summarizes valid client addresses for authentication:</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> realm = clients &#123;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">         host = ::0/0 &#123; usage = none &#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">         host = 172.17.2.0/24 &#123; usage = clients &#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment"># Use the "clients" realm for looking up NACs:</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> client realm = clients <span class="comment"># This is the global definition, but ...</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment"># ... the "client realm" setting can be used on a per-host basis, too:</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> host = router &#123; ... client realm = clients ... &#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><code>inherit =</code> ( <code>yes</code> | <code>no</code> )</p>
<p>如果设置为no，则当前主机声明不会从其超级网络(supernet)继承配置摘要（例如：key, enable passwords）。默认为yes。</p>
</li>
<li><p><code>name =</code> <em>string</em></p>
<p>将名称字符串分配给主机对象。这与地址关键字，可以用来形成主机组。如果您已经在初始的host = 语句中分配了名称，则不要使用此属性，并且要注意在用户和组之前定义主机，否则组成员资格分配可能会失败，可能会以静默方式失败。</p>
</li>
<li><p><code>address =</code> <em>cidr</em></p>
<p>将cidr指定的地址范围添加到当前主机定义中。</p>
<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/CIDR.gif" alt="img"></p>
<p>​                                        Railroad diagram: CIDR</p>
</li>
<li><p><code>address file =</code> <em>file</em></p>
<p>将文件中的地址添加到当前主机定义。 Shell通配符模式由glob（3）扩展。</p>
</li>
<li><p><code>client realm =</code> <em>realm</em></p>
<p>在域中查找NAC参数，而不使用默认值。</p>
</li>
<li><p><code>dns reverse-lookup =</code> ( <code>yes</code> | <code>no</code> )</p>
<p>此指令为相应的主机启用或禁用DNS反向查找。</p>
</li>
<li><p><code>dns timeout =</code> <em>Seconds</em></p>
<p>该指令指定进行DNS反向查找时要等待的最长时间。 （默认值：0）。</p>
</li>
<li><p><code>single-connection</code> ( <code>may-close</code> ) <code>=</code> ( <code>yes</code> | <code>no</code> )</p>
<p>该指令可用于允许或拒绝特定主机对象的单连接功能。 may-close关键字告诉守护程序如果未使用则关闭连接。</p>
<blockquote>
<p>Caveat Emptor（需留心）：</p>
<p>单连接不按预期工作的可能性很小。路由器中的单连接实现，甚至在这个守护进程中实现的连接(或者可能两者都有)可能有问题。如果你注意到奇怪的AAA行为无法解释，那么尝试禁用路由器上的单连接。</p>
</blockquote>
</li>
<li><p><code>template =</code> ( <em>address</em> | <em>name</em> )</p>
<p>这使用地址或name的现有主机定义的一部分作为当前主机声明的模板。仅复制banners，key<code>,</code>enable<code>passwords and</code>content，并且不进行递归查找。</p>
</li>
</ul>
<h4 id="Timeouts"><a href="#Timeouts" class="headerlink" title="Timeouts:"></a>Timeouts:</h4><p>可以指定连接超时：<code>connection timeout =</code> <em>s</em></p>
<p>闲置至少s秒后，终止与该NAS的连接。默认为全局选项。</p>
<h4 id="Authentication-1"><a href="#Authentication-1" class="headerlink" title="Authentication:"></a>Authentication:</h4><p>在主机对象级别可以使用以下与认证相关的指令：</p>
<ul>
<li><p><code>aaa realm =</code> <em>realmName</em></p>
</li>
<li><p><code>access acl =</code> ( [ <code>permit</code> ] | <code>deny</code> ) [ <code>not</code> ] <em>acl</em></p>
<p>与该指令不匹配的认证请求将被拒绝。</p>
</li>
<li><p><code>password</code> ( <code>max-attempts =</code> <em>integer</em> | <code>backoff =</code> <em>seconds</em> )</p>
</li>
<li><p><code>pap password mapping =</code> ( <code>login</code> | <code>pap</code> )</p>
<p>设置为login时，PAP认证请求将映射到ASCII登录请求。您可能希望将其用于NEXUS设备。</p>
</li>
<li><p><code>default user =</code> <code>name</code></p>
<p>该指令为来自与该主机对象匹配的主机的连接设置默认用户名。例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host = nms &#123; address = 1.2.3.4 user = nmsuser &#125;</span><br></pre></td></tr></table></figure>
<p>将告诉守护程序不要查询来自1.2.3.4的连接的用户名，而是使用nmsuser。</p>
<p>小心使用此选项。在转换到TACACS+环境时，它可能很方便，但有几个严重的问题，第一个问题是路由器不知道用户名，这意味着通过TACACS+的授权无法工作。</p>
</li>
<li><p><code>default group =</code> <code>name</code></p>
<p>对于没有任何组成员身份的用户，此指令可用于分配一个。它用于源自此主机对象的连接。例如，您可以使用以下方法拒绝没有组成员身份的用户访问：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">host = ... &#123; default group = no_login &#125;</span><br><span class="line">acl script = no_login &#123; deny &#125;</span><br><span class="line">group = no_login &#123; acl = no_login &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>enable</code> [ <em>level</em> ] <code>=</code> ( <code>permit</code> | <code>deny</code> | <code>login</code> | ( <code>clear</code> | <code>crypt</code>) <em>password</em> )</p>
<p>该指令可用于设置主机特定的enable passwords，使用登录密码或允许（无密码）或拒绝任何启用尝试。级别默认为15。</p>
<p>在主机级别指定的enable passwords的优先级比在用户或组级别定义的启用密码的优先级低。</p>
<blockquote>
<p>Password Hashes(密码哈希):</p>
<p>您可以使用openssl passwd实用工具来计算密码哈希。例如，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> openssl passwd -1 clear_text_password</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>返回MD5哈希，而:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> openssl passwd -crypt clear_text_password</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>返回DES哈希值。</p>
<p>DES密码被设计为截断为八个字符。</p>
</blockquote>
<p>您可以通过在NAS上进行配置来通过TACACS + enable：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa authentication enable default group tacacs+ enable</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>anonymous-enable =</code> ( <code>permit</code> | <code>deny</code> )</p>
<p>一些失效的TACACS+实现在启用包中发送no或无效的用户名。设置此选项可在启用前强制执行用户认证。此处设置此选项优先于全局选项。</p>
</li>
<li><p><code>augmented-enable =</code> ( <code>permit</code> | <code>deny</code> )</p>
<p>对于在enable请求中发送$enable$而不是真正的用户名的TACACS+客户端实现，这将允许使用用户名和登录密码的连接(用单个空格字符分隔)进行特定于用户的认证。此处设置此选项优先于全局选项。</p>
<p>enable [level] =需要在用户个人资料中设置登录名，此选项才能生效。</p>
</li>
</ul>
<h4 id="Banners-and-Messages："><a href="#Banners-and-Messages：" class="headerlink" title="Banners and Messages："></a>Banners and Messages：</h4><p>守护程序允许将各种（banners）显示给用户：</p>
<ul>
<li><p><code>welcome banner =</code> <em>string</em></p>
</li>
<li><p><code>motd banner =</code> <em>string</em></p>
</li>
<li><p><code>failed authentication banner =</code> <em>string</em></p>
<p>失败的认证标语将在认证尝试最终失败时显示。</p>
</li>
<li><p><code>reject banner =</code> <em>string</em></p>
<p>如果连接被主机，用户或组级别上定义的访问ACL拒绝，则显示拒绝banners代替欢迎消息。</p>
</li>
<li><p><code>message =</code> <em>string</em></p>
</li>
</ul>
<p>这些文本显示的时间很大程度上取决于实际的登录方法：</p>
<table>
<thead>
<tr>
<th>Context</th>
<th>Directive</th>
<th>Login via Telnet</th>
<th>Login via SSHv1</th>
<th>Login via SSHv2</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host</code></td>
<td><code>welcome banner</code></td>
<td>displayed before<code>Username:</code></td>
<td>not displayed</td>
<td>displayed before<code>Password:</code></td>
</tr>
<tr>
<td><code>host</code></td>
<td><code>reject banner</code></td>
<td>displayed before closing connection</td>
<td>not displayed</td>
<td>not displayed</td>
</tr>
<tr>
<td><code>host</code></td>
<td><code>motd banner</code></td>
<td>displayed after successful login</td>
<td>not displayed</td>
<td>displayed after successful login</td>
</tr>
<tr>
<td><code>host</code></td>
<td><code>failed authentication banner</code></td>
<td>displayed after unsuccessful login</td>
<td>not displayed</td>
<td>displayed after unsuccessful login</td>
</tr>
<tr>
<td><code>user</code> or <code>group</code></td>
<td><code>message</code></td>
<td>displayed after<code>motd banner</code></td>
<td>not displayed</td>
<td>displayed after<code>motd banner</code></td>
</tr>
</tbody>
</table>
<p>果为用户设置hushlogin，则不会显示motd banner或在用户个人资料中定义的消息</p>
<p>所有横幅和消息均支持strftime（3）样式的转换规范，以及以下转换序列：</p>
<table>
<thead>
<tr>
<th><code>%%r</code></th>
<th>router address</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>%%R</code></td>
<td>router DNS name (fallback: IP address)</td>
</tr>
<tr>
<td><code>%%c</code></td>
<td>client address</td>
</tr>
<tr>
<td><code>%%C</code></td>
<td>client DNS name (fallback: IP address)</td>
</tr>
<tr>
<td><code>%%p</code></td>
<td>router port</td>
</tr>
<tr>
<td><code>%%u</code></td>
<td>username</td>
</tr>
<tr>
<td><code>%%%</code></td>
<td>literal <code>%</code></td>
</tr>
</tbody>
</table>
<p>示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">host = ... &#123;</span><br><span class="line">   ...</span><br><span class="line">   welcome banner = "Welcome. Today is %A.\n"</span><br><span class="line">   ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="Inheritacnce-and-Hosts"><a href="#Inheritacnce-and-Hosts" class="headerlink" title="Inheritacnce and Hosts:"></a>Inheritacnce and Hosts:</h4><p>对于主机查找，守护进程首先查找最特定的主机定义。如果该定义(或请求的值)不存在，它将查找下一个不那么特定的定义。这个过程在整个(IPv6) CIDR层次结构中继续进行，直到找到匹配项为止。</p>
<p>换句话说：对于主机参数，与此定义的参数最匹配的主机定义匹配。</p>
<p>例如，如果主机192.168.1.15连接到服务器，则服务器需要知道要使用哪个加密密钥。</p>
<p>在IPv6映射的CIDR表示法（守护程序在内部使用）中，IPv4 CIDR范围</p>
<p><code>192.168.1.15/32</code>等于：<code>0000:0000:0000:0000:0000:FFFF:C0A8:010F/128</code></p>
<p>守护程序将在主机定义中搜索192.168.1.15和（定义的）超网的密钥：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">0000:0000:0000:0000:0000:FFFF:C0A8:010F/128</span><br><span class="line">0000:0000:0000:0000:0000:FFFF:C0A8:010F/127</span><br><span class="line">0000:0000:0000:0000:0000:FFFF:C0A8:010E/126</span><br><span class="line">0000:0000:0000:0000:0000:FFFF:C0A8:010C/125</span><br><span class="line">...</span><br><span class="line">0000:0000:0000:0000:0000:FFFF:C000:0000/98</span><br><span class="line">0000:0000:0000:0000:0000:FFFF:8000:0000/97</span><br><span class="line">0000:0000:0000:0000:0000:FFFF:0000:0000/96</span><br><span class="line">0000:0000:0000:0000:0000:FFFE:0000:0000/95</span><br><span class="line">0000:0000:0000:0000:0000:FFFC:0000:0000/94</span><br><span class="line">...</span><br><span class="line">0000:0000:0000:0000:0000:0000:0000:0000/3</span><br><span class="line">0000:0000:0000:0000:0000:0000:0000:0000/2</span><br><span class="line">0000:0000:0000:0000:0000:0000:0000:0000/1</span><br><span class="line">0000:0000:0000:0000:0000:0000:0000:0000/0</span><br></pre></td></tr></table></figure>
<p>找到的第一个密钥将被使用，因为它是最具体的一个。</p>
<p>默认情况下，将继承welcome banner<code>,</code>motd banner<code>,</code>key<code>,</code>enable<code>,</code>anonymous-enable<code>and</code>content。可以为主机对象关闭继承：  <code>inherit = no</code> </p>
<h4 id="Railroad-Diagrams"><a href="#Railroad-Diagrams" class="headerlink" title="Railroad Diagrams:"></a>Railroad Diagrams:</h4><p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/HostDecl.gif" alt="img"></p>
<center><br>  Railroad diagram: HostDecl<br></center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/HostAttr.gif" alt="img"></p>
<center>Railroad diagram: HostAttr</center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/EnableExpr.gif" alt="img"></p>
<center>Railroad diagram: EnableExpr </center>

<h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">host = 10.0.0.0/8 &#123;</span><br><span class="line">    name = customer1</span><br><span class="line">    key = "your key here"</span><br><span class="line">    welcome banner = "\nHitherto shalt thou come, but no further. (Job 38.11)\n\n"</span><br><span class="line">    enable 15 = clear whatever</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">host = test123 &#123;</span><br><span class="line">    address = 10.1.2.0/28</span><br><span class="line">    address = 10.12.1.30/28</span><br><span class="line">    address = 10.1.1.2</span><br><span class="line">    # key/banners/enable will be inherited from 10.0.0.0/8 by default,</span><br><span class="line">    # unless you specify "inherit = no"</span><br><span class="line">    address file = /some/path/test123.cidr</span><br><span class="line">    prompt = "\nGo away.\n\n"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Time-Ranges-时间范围"><a href="#Time-Ranges-时间范围" class="headerlink" title="Time Ranges(时间范围):"></a>Time Ranges(时间范围):</h3><p>timespec对象可用于基于时间的配置文件分配。支持cron和Taylor-UUCP语法；有关详细信息，请参见本地crontab（5）和/或UUCP手册页。句法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timespec =` *timespec_name* `&#123; "`*entry*`"` [ ... ] `&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Working hours are from Mo-Fr from 9 to 16:59, and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on Saturdays from 9 to 12:59:</span></span><br><span class="line">timespec = workinghours &#123;</span><br><span class="line">    "* 9-16 * * 1-5"   # or: "* 9-16 * * Mon-Fri"</span><br><span class="line">    "* 9-12 * * 6"     # or: "* 9-12 * * Sat"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timespec = sunday &#123; "* * * * 0" &#125;</span><br><span class="line"></span><br><span class="line">timespec = example &#123;</span><br><span class="line">    Wk2305-0855,Sa,Su2305-1655</span><br><span class="line">    Wk0905-2255,Su1705-2255</span><br><span class="line">    Any</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Railroad-Diagrams-1"><a href="#Railroad-Diagrams-1" class="headerlink" title="Railroad Diagrams:"></a>Railroad Diagrams:</h4><p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/TimespecDecl-20200914092157696.gif" alt="img"></p>
<center>Railroad diagram: TimespecDecl </center>

<h3 id="Access-Control-Lists-访问控制列表-："><a href="#Access-Control-Lists-访问控制列表-：" class="headerlink" title="Access Control Lists(访问控制列表)："></a>Access Control Lists(访问控制列表)：</h3><p>访问控制列表(acl)由一系列访问控制表达式(Access Control Expressions ACEs)组成。只要其中一个ACEs匹配，ACL就会匹配。构成ACL的ACEs是按顺序处理的。如果每个定义的子类型表达式至少有一个类型匹配，则ACE匹配。以身份命名的ACs成为具有相同名称的ACL的一部分。</p>
<p>标准ACL语法为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acl` `=` *name* `&#123;` ( (`nac` ( `=` [ `not` ] (*HostName*|*cidr*) ) | ( [ `dns` ] `regex =` [ `not` ] *NacRegex* )) | (`nas` ( `=` [ `not` ] (*HostName*|*cidr*) ) | (`regex =` [ `not` ] *NasRegex* )) | (`port regex =` [ `not` ] *PortRegex* ) | (`acl =` [ `not` ] *ACLName* )* `&#125;` (`time =` [ `not` ] *TimeSpecName* )* `&#125;</span><br></pre></td></tr></table></figure>
<p>或者，可以使用脚本:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acl script = name&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>下一章将详细介绍后者。</p>
<p>对于标准的ACL语法，请查看下面的“铁路图”，希望会变得更加清楚。</p>
<p>ACE将按照您定义它们的顺序进行评估。例如:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">acl = myacl &#123;</span><br><span class="line">    nac = 10.0.0.0/8</span><br><span class="line">    nac = 11.0.0.0/8</span><br><span class="line">    nas = somehostobjectname</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">acl = myacl &#123;</span><br><span class="line">    time = workinghours</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由两个ACEs组成，这些ACE组成一个名为“ myacl”的ACL。此ACL匹配</p>
<ul>
<li>适用于10.0.0.0/8或11.0.0.0/8中的客户端以及服务器某些hostobjectname的一部分</li>
<li>仅在工作时间内，无论涉及什么客户端或服务器（或端口）</li>
</ul>
<p>当使用dns关键字时，根据NACs dns反向映射执行NAC正则表达式匹配。这只有在a)软件是在lwres支持下编译的，b) lwresd实际运行的情况下才能工作。但是，请记住，DNS不一定是可信的，查找可能会失败。请记住，最好在您的NAS上启用单连接。这允许守护进程利用缓存反向映射结果的优势。</p>
<h4 id="Railroad-Diagrams-2"><a href="#Railroad-Diagrams-2" class="headerlink" title="Railroad Diagrams:"></a>Railroad Diagrams:</h4><p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/ACLDecl.gif" alt="img"></p>
<center> Railroad diagram: ACLDecl</center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/ACLExpr.gif" alt="img"></p>
<center> Railroad diagram: ACLExpr</center>

<h3 id="Rewriting-User-Names-改写用户名"><a href="#Rewriting-User-Names-改写用户名" class="headerlink" title="Rewriting User Names(改写用户名):"></a>Rewriting User Names(改写用户名):</h3><p>这是实验性的。它需要使用PCRE v2支持构建二进制文件（使用–with-pcre2配置选项）。</p>
<p>主机可以引用在域级别定义的重写配置文件来替代用户名。以下示例代码将admin和root都映射到marc，并将所有其他用户名都转换为小写：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rewrite = rewriteRule &#123;</span><br><span class="line">    rewrite /^admin$/ marc</span><br><span class="line">    rewrite /^root$/ marc</span><br><span class="line">    rewrite /^.*$/ \L$0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">host = ... &#123;</span><br><span class="line">    ...</span><br><span class="line">    rewrite user = rewriteRule</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>请记住，这是实验性的…</p>
</blockquote>
<h3 id="Scripts："><a href="#Scripts：" class="headerlink" title="Scripts："></a>Scripts：</h3><p>脚本当前可用于ACL并用于服务声明范围：</p>
<ul>
<li><p><code>acl script =</code> acl_name <code>{</code> tac_action … <code>}</code></p>
<p>Example:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acl script = myacl123 &#123;</span><br><span class="line">    if (nas == 1.2.3.4 || nac = SomeHostName || nac-dns =~ /\\.example\\.com$/) deny</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>script = {</code> tac_action … <code>}</code></p>
<p>Example:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">user = joe &#123;</span><br><span class="line">    service = shell &#123;</span><br><span class="line">        script = &#123;</span><br><span class="line">            if (cmd == "") permit # required for shell startup</span><br><span class="line">            if (cmd =~ /^(no\s)?shutdown\s/) permit &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax:"></a>Syntax:</h4><p>(Script)脚本包含一系列动作：</p>
<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/TacAction-20200915080821958.gif" alt="img"></p>
<center> Railroad diagram: TacAction</center>

<p>最终返回的动作是：permit和deny。在脚本结束时，会暗示返回，此时守护进程将继续处理shell上下文中配置的cmd语句或标准ACL (ACL上下文中)。赋值操作(context =， message =)只在shell上下文中有意义。</p>
<p>设置上下文变量仅在shell上下文中才有意义。请参阅相应部分中的示例</p>
<p>条件语法为：</p>
<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/TacCond.gif" alt="img"></p>
<center> Railroad diagram: TacCond </center>

<h3 id="Users-and-Groups-用户和组-："><a href="#Users-and-Groups-用户和组-：" class="headerlink" title="Users and Groups(用户和组)："></a>Users and Groups(用户和组)：</h3><p>用户和组声明非常相似。主要区别在于组是静态的，而用户声明可以在运行时通过MAVIS后端添加。</p>
<p>用户可以是组的成员（也称为role或profile）。实际的组成员身份可能取决于各种因素，例如用户所在的NAS，NAC或时间范围。每个组又可以是另一个组的成员，依此类推。</p>
<p>用户和组声明的基本形式是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user = username &#123; ...  &#125;</span><br></pre></td></tr></table></figure>
<p>或分别:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group = groupname &#123;  ...  &#125;</span><br></pre></td></tr></table></figure>
<p>用户或组声明可以包含键值对和服务声明。</p>
<h4 id="User-only-options"><a href="#User-only-options" class="headerlink" title="User-only options:"></a>User-only options:</h4><p>以下声明仅在用户上下文中有效:</p>
<ul>
<li><p><code>login =</code> ( ( <code>clear</code> | <code>crypt</code> ) <strong>password</strong>| <code>mavis</code> | <code>permit</code> | <code>deny</code> )</p>
<p>登录password认证Shell登录到服务器。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">login = crypt aFtFBT4e5muQE</span><br><span class="line">login = clear Ci5c0</span><br></pre></td></tr></table></figure>
<p>对于<code>crypt</code>, 可以使用DES或MD5哈希码。</p>
<p>如果改用mavis关键字，则将通过MAVIS后端查找密码，它不会被缓存。</p>
<p>尽管配置文件中有静态用户声明，但如果您想在外部系统进行认证，此功能可能很有用。</p>
</li>
<li><p><code>pap =</code> ( ( <code>clear</code> | <code>crypt</code> ) <em>password</em> | <code>mavis</code> | <code>permit</code> | <code>deny</code> )</p>
<p>pap认证PAP登录到服务器。就像login时一样，密码不需要使用明文形式，而是可以使用DES（或MD5）进行散列，也可以通过MAVIS后端进行查找。</p>
</li>
<li><p><code>arap =</code> ( <code>clear</code><em>password</em> | <code>permit</code> | <code>deny</code> )</p>
<p>对于ARAP认证，需要输入明文密码。</p>
</li>
<li><p><code>chap =</code> ( <code>clear</code><em>password</em> | <code>permit</code> | <code>deny</code> )</p>
<p>对于CHAP认证，需要使用明文密码。</p>
</li>
<li><p><code>ms-chap =</code> ( <code>clear</code><em>password</em> | <code>permit</code> | <code>deny</code> )</p>
<p>对于 MS-CHAP认证，需要使用明文密码。.</p>
</li>
<li><p><code>opap =</code> ( <code>clear</code><em>password</em> | <code>permit</code> | <code>deny</code> )</p>
<p>对于outgoing PAP n认证， 需要使用明文密码。</p>
</li>
<li><p><code>password =</code> ( <code>clear</code><em>password</em> | <code>permit</code> | <code>deny</code> )</p>
<p>该指令将所有先前未定义的密码（OPAP除外）设置为给定的明文密码。保留该指令仅是为了向后兼容，不建议使用。</p>
</li>
<li><p><code>password</code> [ <code>acl</code> [ <code>not</code> ] <em>acl</em> ] <code>{</code> … <code>}</code></p>
<p>该指令允许指定与ACL相关的密码。例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">acl jumpstation = &#123; nac == 10.255.0.85 &#125;</span><br><span class="line"></span><br><span class="line">user = marc &#123;</span><br><span class="line">    password acl jumpstation &#123;</span><br><span class="line">        login = permit</span><br><span class="line">        pap = permit</span><br><span class="line">    &#125;</span><br><span class="line">    password &#123;</span><br><span class="line">        login = clear myLoginPassword</span><br><span class="line">        pap = clear myPapPassword</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Group-only-options："><a href="#Group-only-options：" class="headerlink" title="Group-only options："></a>Group-only options：</h4><p>以下声明仅在组上下文中有效：</p>
<ul>
<li><p><code>template =</code> <em>groupname</em></p>
<p>该指令将组定义从groupname合并到当前组。已经存在的定义优先。</p>
</li>
</ul>
<h4 id="USer-and-Group-options"><a href="#USer-and-Group-options" class="headerlink" title="USer and Group options:"></a>USer and Group options:</h4><p>以下键值对在用户和组上下文中均有效：</p>
<h5 id="Limits"><a href="#Limits" class="headerlink" title="Limits:"></a>Limits:</h5><p>用户或组的有效性可能受到各种属性的限制：</p>
<ul>
<li><p><code>acl =</code> ( [ <code>permit</code> ] | <code>deny</code> ) [ <code>not</code> ] <em>acl</em></p>
<p>用户或组配置文件的有效性可能会受到ACL的限制。可以指定多个ACL并按顺序进行评估。</p>
</li>
<li><p><code>valid from =</code> ( <em>YYYY</em><code>-</code><em>MM</em><code>-</code><em>DD</em> | <em>s</em> )</p>
<p>该配置文件将从给定的日期开始有效，该日期可以以ISO8601日期格式指定，也可以以UTC自1970年1月1日起的秒数指定。</p>
</li>
<li><p><code>valid until =</code> ( <em>YYYY</em><code>-</code><em>MM</em><code>-</code><em>DD</em> | <em>s</em> )</p>
<p>给定日期之后，该个人资料将无效。</p>
</li>
<li><p><code>client</code> [ <code>regex</code> ] <code>=</code> ( <code>deny</code> | [ <code>permit</code> ] ) <em>string</em> [ <code>,</code> … ]</p>
<p>作为ACL的替代（或补充）（请参见上文），某些基于NAC的有效性限制可以直接放置在用户（或组）对象中。例如，要将登录限制为某个IP范围或主机组：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client = 10.99.0.0/16</span><br><span class="line">client = deny customer3</span><br></pre></td></tr></table></figure>
<p>如果使用regex关键字，则string应该是有效的正则表达式。正则表达式搜索代价较大，仅在NAS发送的NAC地址不是IP地址时使用。正则表达式客户端匹配的示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> compiled with PCRE:</span></span><br><span class="line">client = deny /^async$/</span><br><span class="line">client regex = /^console$/</span><br><span class="line">  </span><br><span class="line"><span class="meta">#</span><span class="bash"> without PCRE:</span></span><br><span class="line">client = deny "^async$"</span><br><span class="line">client regex = "^console$"</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>判断顺序：</p>
<p>请注意在client声明之前会检查ACL。</p>
<p>对于client定义，将在正则表达式之前检查IP地址，然后按定义它们的顺序判断后者。</p>
</blockquote>
<ul>
<li><p><code>server =</code> ( <code>deny</code> | [ <code>permit</code> ] ) <em>string</em> [ <code>,</code> … ]</p>
<p>这将用户帐户的有效性限制为某些NAS地址或组，例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server = 1.2.3.4/32</span><br><span class="line">server = nas01</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="Messages"><a href="#Messages" class="headerlink" title="Messages:"></a>Messages:</h5><p>这些选项处理向用户显示消息。</p>
<ul>
<li><p><code>message =</code> <em>string</em></p>
<p>登录时显示给用户的消息。</p>
</li>
<li><p><code>hushlogin =</code> ( <code>yes</code> | <code>no</code> )</p>
<p>将hushlogin设置为yes可防止守护程序在登录时显示motd和user消息。</p>
<blockquote>
<p>Hush :  安静， 寂静</p>
</blockquote>
</li>
</ul>
<h5 id="Enable-passwords："><a href="#Enable-passwords：" class="headerlink" title="Enable passwords："></a>Enable passwords：</h5><p>启用密码可以按优先级，主机，用户或组级别指定：</p>
<ul>
<li><p><code>enable</code> [ <em>level</em> ] <code>=</code> ( <code>permit</code> | <code>deny</code> | <code>login</code> | ( <code>clear</code> | <code>crypt</code> ) <em>password</em> )</p>
<p>此指令可用于设置用户或组特定的启用密码，使用登录密码，或允许(没有密码)或拒绝任何启用尝试。启用加密在组或用户级别定义的密码优先于在主机级别定义的密码。level默认值为15。</p>
<p>NAS上普通用户的默认命令级别通常为1。当用户enables时，可以使用NAS enable命令将这个级别重置为0到15之间的值。如果她没有指定级别，那么enable的默认级别是15。</p>
</li>
</ul>
<h5 id="MAVIS-options"><a href="#MAVIS-options" class="headerlink" title="MAVIS options:"></a>MAVIS options:</h5><p>以下MAVIS相关选项适用于组和本地定义的用户：</p>
<ul>
<li><p><code>mavis realm =</code> <em>realmName</em></p>
<p>对于password = mavis的本地定义用户（或密码为mavis的用户），此指令选择用于MAVIS认证的域。</p>
</li>
</ul>
<h5 id="Group-membership"><a href="#Group-membership" class="headerlink" title="Group membership:"></a>Group membership:</h5><p>组成员资格是使用member指令指定的：</p>
<ul>
<li><p><code>member</code> [ <code>acl</code> [ <code>not</code> ] <em>acl</em> ] <code>=</code> <em>string</em> [ <code>,</code> … ]</p>
<p>该指令定义组成员身份，视情况取决于NAS服务器的地址或某些访问列表。例如，可以配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">host = campus &#123; ... &#125;</span><br><span class="line">host = remote &#123; ... &#125;</span><br><span class="line">host = router &#123; ... &#125;</span><br><span class="line">timespec = workinghours &#123; ... &#125;</span><br><span class="line">group = admins &#123; ... &#125;</span><br><span class="line">group = staff &#123; ... &#125;</span><br><span class="line">group = guest &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>加上一些ACL：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acl oncampus = &#123; nac = campus &#125;</span><br><span class="line">acl viavpn = &#123; nac = remote &#125;</span><br><span class="line">acl atwork = &#123; nac = campus time = workinghours &#125;</span><br></pre></td></tr></table></figure>
<p>然后基于后者成为组成员:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">user = adminuser &#123; member = admins &#125;</span><br><span class="line">user = employee &#123;</span><br><span class="line">    ...</span><br><span class="line">    member acl atwork = staff@router</span><br><span class="line">    member acl viavpn = staff</span><br><span class="line">    member acl remote = guest</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">user = guest &#123;</span><br><span class="line">    ...</span><br><span class="line">    member acl atwork = guest</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">user = myself &#123;</span><br><span class="line">    ...</span><br><span class="line">    member = admins@router</span><br><span class="line">    member = staff</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>member</code> 指令要按ACL名称排序，最后没有ACL的定义。这是在解析时强制执行的。</p>
<p>可以指定备用组，组名之间用 <code>/</code>分隔：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">member = dialin/callback@10.11.12.13</span><br></pre></td></tr></table></figure>
<p>在这里，组成员将默认为拨号组。但是，附加分隔字符(使用 <code>separation tag =</code>  <em>character</em> 指令可更改)，然后在登录时回调到用户名，将选择相应的回调组配置文件。</p>
<p>再重复一次:任何用户都可以是一个主组的成员。这个例子中的拨号/回调语法实际上意味着:用户可以自由选择在登录时，他是否想成为拨号XOR回调的成员。用户fred可以认证为fred(或fred<em>dialin)来获得dialin成员资格，fred</em>callback将把他分配到回调组。</p>
<p>可以使用tag指令（请参见下文）覆盖用户的选择。</p>
<p>组成员身份可能取决于NAS IP，例如fred可能会喜欢：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">member = test1@nas1</span><br><span class="line">member = test2@nas2</span><br></pre></td></tr></table></figure>
<p>在他的profile中。 就像用户一样，组可以是（其他）组的成员：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">group = test1 &#123; ... &#125;</span><br><span class="line">group = test2 &#123; ... &#125;</span><br><span class="line">                                                                                       </span><br><span class="line">group = test2 &#123;</span><br><span class="line">   ...</span><br><span class="line">   member = test1</span><br><span class="line">   member = test2@nas1</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不支持同时（非分层）组中的成员身份。</p>
<p>由于在解析配置文件时解析了组成员身份，因此在用作成员定义中的参数之前，必须先定义组和主机。</p>
</li>
<li><p><code>nas default restriction =</code> ( <em>cidr</em> | <em>host</em> )</p>
<p>除非另有说明，否则将组的使用限制为指定的主机。例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">group = group1 &#123; nas default restriction = host1 &#125;</span><br><span class="line">group = group2 &#123; &#125;</span><br><span class="line">group = group3 &#123; nas default restriction = host1 &#125;</span><br><span class="line">user = user1 &#123; member = group1,group2,group3@host3 &#125;</span><br></pre></td></tr></table></figure>
<p>等同于</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">group = group1 &#123; &#125;</span><br><span class="line">group = group2 &#123; &#125;</span><br><span class="line">group = group3 &#123; &#125;</span><br><span class="line">user = user1 &#123; member = group1@host1,group2,group3@host3 &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：对于备用组规范（例如member = group1 / group2），将忽略nas默认限制</p>
</blockquote>
</li>
<li><p><code>tag</code> ( <code>acl</code> [ <code>not</code> ] <em>acl</em> ) <code>=</code> <em>string</em></p>
<p>如上所述，用户可以在登录时使用user*group语法手动选择(允许的)组配置文件。您可以使用用户或组配置文件中的tag指令覆盖用户的选择。此外，您还可以进行基于acl的标记选择。例如:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">timespec = workinghours &#123; "* 9-16 * * 1-5" "* 9-12 * * 6" &#125;</span><br><span class="line">timespec = weekend &#123; "* * * * 6-1" &#125;</span><br><span class="line">timespec = changewindow &#123; "* 22-23 * * Sat" "* 0-3 * * Sun" &#125;</span><br><span class="line"></span><br><span class="line">acl helpdesk = &#123;</span><br><span class="line">    time = workinghours</span><br><span class="line">    nac = internal_lan</span><br><span class="line">    nas = somecustomer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">acl remoteadmin = &#123;</span><br><span class="line">    time = changewindow</span><br><span class="line">    nac = dialin</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user = fred &#123;</span><br><span class="line">    login = clear test</span><br><span class="line">    member = admin/ro/emergency</span><br><span class="line">    tag acl helpdesk = admin</span><br><span class="line">    tag acl remoteadmin = emergency</span><br><span class="line">    tag = ro</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在工作时间，fred将是admin组的成员，但前提是他的客户端IP地址是内部LAN的一部分，并且他在某个NAS上。在更改窗口时间，他将是emergency小组的成员，但需要来自拨入池。在这些时间之外，他是ro时间的一员。</p>
<p>Tag定义是按顺序计算的。如果没有匹配的定义，则使用用户的会话tag(使用user*group语法登录时选择的组)。如果没有给出组标记，则选择成员定义中的第一个组。</p>
<p>在大多数情况下，使用成员acl语法而不是tag acl可能是更好的主意。</p>
</li>
</ul>
<h5 id="Railroad-Diagrams-3"><a href="#Railroad-Diagrams-3" class="headerlink" title="Railroad Diagrams:"></a>Railroad Diagrams:</h5><p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/UserDecl.gif" alt="img"></p>
<center> Railroad diagram: UserDecl </center>



<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/GroupDecl.gif" alt="img"></p>
<center> Railroad diagram : GroupDecl</center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/PasswordExpr.gif" alt="img"></p>
<center> Railroad diagram: PasswordExpr</center>



<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/PasswordExprHash.gif" alt="img"></p>
<center> Railroad diagram: PasswordExprHash</center>



<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/UserAttr.gif" alt="img"></p>
<center> Railroad diagram: UserAttr</center>



<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/UserMessage.gif" alt="img"></p>
<center> Railroad diagram: UserMessage</center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/GroupAttr.gif" alt="img"></p>
<center>Railroad diagram: GruopAttr</center>



<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/GroupOnlyAttr.gif" alt="img"></p>
<center> Railroad diagram: GroupOnlyAttr</center>

<h4 id="Service-Restrictions-服务限制"><a href="#Service-Restrictions-服务限制" class="headerlink" title="Service Restrictions(服务限制):"></a>Service Restrictions(服务限制):</h4><ul>
<li><p><code>default service =</code> ( <code>permit</code> | <code>deny</code> )</p>
<p>这定义了应允许还是拒绝在用户配置文件中未明确定义的服务。</p>
</li>
<li><p><code>prohibit service =</code> <em>service …</em></p>
<p>使用它来覆盖默认服务规范。例如，明确拒绝X.25服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prohibit service = x25</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Service-Definitions-服务定义-："><a href="#Service-Definitions-服务定义-：" class="headerlink" title="Service Definitions(服务定义)："></a>Service Definitions(服务定义)：</h4><p>服务定义可能会出现在用户和组部分中。可以很容易地使服务依赖于ACL：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service` ( `acl` [ `not` ] ACLName `=` *service* `&#123;` *...* `&#125;</span><br></pre></td></tr></table></figure>
<p>在任意服务定义中可能会出现几个通用配置属性。特别是：</p>
<ul>
<li><p><code>default attribute =</code> ( <code>permit</code> | <code>deny</code> )</p>
<p>该指令指定守护程序是接受还是拒绝NAS发送的未知属性（默认值：deny）。</p>
</li>
<li><p><code>acl =</code> ( [ <code>permit</code> ] | <code>deny</code> ) [ <code>not</code> ] <em>acl</em></p>
<p>就像用户和组配置文件一样，可以使用ACL限制服务。</p>
</li>
<li><p>( <code>set</code> | <code>optional</code> ) <em>attribute</em> <code>=</code> <em>value</em></p>
<p>定义强制和可选属性-值对。例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set priv-lvl = 15</span><br></pre></td></tr></table></figure>
<p>有关强制和可选AV-pairs的详细说明，请参见下面的“The Authorization Algorithm””部分</p>
</li>
<li><p><code>return</code></p>
<p>照原样使用当前服务定义。这使守护程序停止检查当前用户（或组）所属的组中的同一服务。</p>
</li>
</ul>
<p>其他配置属性是特定于服务的，并且仅在某些情况下有效：</p>
<h6 id="SHELL-EXEC-Service"><a href="#SHELL-EXEC-Service" class="headerlink" title="SHELL (EXEC) Service"></a><strong>SHELL (EXEC) Service</strong></h6><p>Shell启动应提供适当的服务定义。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service = shell &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>大括号内的有效配置指令为:</p>
<ul>
<li><p><code>default cmd =</code> ( <code>permit</code> | <code>deny</code> )</p>
<p>该指令指定守护程序是接受还是拒绝未明确允许的命令（默认值：deny）。</p>
</li>
<li><p><code>message</code> ( <code>permit</code> | <code>deny</code> ) <code>=</code> <em>string</em></p>
<p>这指定在接受或拒绝命令时要呈现给用户的消息。字符串中可识别的字符串替换是：命令(command )名称为％c，命令参数( arguments)为％a，当前设置的上下文( context)为％C。例:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">message permit "Permitted '%c %a'"</span><br><span class="line">message deny "Denied '%c %a'"</span><br></pre></td></tr></table></figure>
<p>此指令也可能出现在cmd部分中，在该地方它会覆盖service部分的定义。</p>
</li>
<li><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd =command&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>cmd部分允许或拒绝命令和命令参数。例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cmd = show &#123;</span><br><span class="line">    deny /^(running|startup)-config/</span><br><span class="line">    deny tech-support</span><br><span class="line">    permit //</span><br><span class="line">    message deny = "Try this again and your account will be revoked."</span><br><span class="line">    message permit = "This data is to be considered confidentional."</span><br><span class="line">&#125;</span><br><span class="line">cmd = reload &#123;</span><br><span class="line">    permit //</span><br><span class="line">    message permit = "You hopefully know what you're doing ..."</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正则表达式语法为POSIX，如果在编译时启用，则为PCRE。</p>
</li>
</ul>
<p>如果不确定给路由器实际发送了哪些命令和参数，则可以简单地修改用户（或组）配置文件以显示登录会话中的命令和参数。例如:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">user = ... &#123;</span><br><span class="line">    ...</span><br><span class="line">    debug = CMD</span><br><span class="line">    ...</span><br><span class="line">    service = shell &#123;</span><br><span class="line">        ...</span><br><span class="line">        message debug  = "author: 'cmd = %c &#123; permit /^%a$/ &#125;"</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将显示配置摘要以允许使用PCRE语法的命令,例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Router#</span><span class="bash">conf t</span></span><br><span class="line">author: 'cmd = configure &#123; permit /^terminal &lt;cr&gt;$/ &#125;'</span><br><span class="line"></span><br><span class="line">Enter configuration commands, one per line.  End with CNTL/Z.</span><br><span class="line"><span class="meta">Router(config)#</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h6 id="Non-Shell-Service"><a href="#Non-Shell-Service" class="headerlink" title="Non-Shell Service:"></a>Non-Shell Service:</h6><p>例如。对于PPP，可以使用协议定义：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service = ppp &#123;</span><br><span class="line">    protocol = ip &#123; set addr = 1.2.3.4 &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>default protocol = permit</code> 或者 <code>default protocol = deny</code> ,为服务声明中未明确定义的协议指定默认值。 （默认：deny）。</p>
<p>对于Juniper网络特定的授权服务，请使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service = junos-exec &#123;</span><br><span class="line">   set local-user-name = NOC</span><br><span class="line"><span class="meta">   #</span><span class="bash"> see the Junos documentation <span class="keyword">for</span> more attributes</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样，对于Raritan Dominion SX IP控制台服务器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service = dominionsx &#123;</span><br><span class="line">    set port-list = "1 3 4 15"</span><br><span class="line">    set user-type = administator # or operator, or observer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Quotes:</p>
<p>如果您的路由器需要双引号(double-quoted)（例如Cisco Nexus设备），则可以建议解析器自动添加这些值：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> service = shell &#123;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">     <span class="built_in">set</span> shell:roles=<span class="string">"\"network-admin\""</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>和：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> service = shell &#123;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">     double-quote-values = yes</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">     <span class="built_in">set</span> shell:roles=<span class="string">"network-admin"</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>是等效的，但后者更具可读性。</p>
</blockquote>
<h4 id="Host-group-specific-services-主机组特定服务"><a href="#Host-group-specific-services-主机组特定服务" class="headerlink" title="Host-group specific services(主机组特定服务):"></a>Host-group specific services(主机组特定服务):</h4><p>通过将@host附加到service name，可以配置特定于NAS的服务。在此，host是主机对象的名称，而不是IP地址或CIDR范围。例如，用户的PPP地址在一个特定的NAS上可能是静态的，但在其他所有位置上都是动态的:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">host = dialin &#123; address = ... &#125;</span><br><span class="line">user = ... &#123;</span><br><span class="line">    service = ppp &#123; protocol = ip &#123; &#125; &#125;</span><br><span class="line">    service = ppp@dialin &#123; protocol = ip &#123; set addr = 1.2.3.4 &#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>尽管可以使用主机特定的组成员身份来实现相同目的，但这为动态身份验证后端增加了一些灵活性。</p>
<h4 id="CLI-Contexts"><a href="#CLI-Contexts" class="headerlink" title="CLI Contexts:"></a>CLI Contexts:</h4><p>当与单连接(single-connection)一起使用并被告知时，守护程序将尝试记住命令上下文。这允许仅对一个接口使用shutdown系列命令，但对其他所有接口均拒绝使用它：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">user = john &#123;</span><br><span class="line">    password = clear doe</span><br><span class="line">    service = shell &#123;</span><br><span class="line">        default cmd = permit</span><br><span class="line">        set priv-lvl = 15</span><br><span class="line">        script = &#123;</span><br><span class="line">            if (cmd == "") permit # shell startup</span><br><span class="line"></span><br><span class="line">            if (cmd =~ /^interface FastEthernet 0\/1 /) &#123;</span><br><span class="line">                message = "Context has been set. \"[no] shut\" should work for you."</span><br><span class="line">                context = FE</span><br><span class="line">                permit</span><br><span class="line">            &#125; else if (cmd =~ /^interface/)&#123;</span><br><span class="line">                message = "Context has been reset."</span><br><span class="line">                context = ""</span><br><span class="line">                permit</span><br><span class="line">            &#125;</span><br><span class="line">            if (context == FE) &#123;</span><br><span class="line">                if (cmd =~ /^shutdown/) permit</span><br><span class="line">                if (cmd =~ /^no shutdown/) permit</span><br><span class="line">                deny</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cmd = shutdown &#123; deny . &#125;</span><br><span class="line">        cmd = no &#123; deny /^shutdown/ &#125;</span><br><span class="line">    &#125;       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="用户和组配置示例"><a href="#用户和组配置示例" class="headerlink" title="用户和组配置示例:"></a>用户和组配置示例:</h4><p>在这里，我们声明两个用户fred和lily，以及两个组admin和staff。 fred是组管理员的成员，而组admin又是组staff的成员。 lily不是任何组的成员。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">group = admin &#123;</span><br><span class="line">    # group admin is a member of group staff</span><br><span class="line">    member = staff</span><br><span class="line">    service = shell &#123;</span><br><span class="line">        set priv-lvl = 15</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">group = staff &#123;</span><br><span class="line">    # group staff is not a member of any group</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user = lily &#123;</span><br><span class="line">    # user lily is not a member of any group</span><br><span class="line">    # and has nothing else configured as yet</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user = fred &#123;</span><br><span class="line">    # fred is a member of group admin on 0.0.0.0/0</span><br><span class="line">    member = admin</span><br><span class="line">    # fred is a member of group staff when logging in on 10.0.0.0/8</span><br><span class="line">    member = staff@10.0.0.0/8</span><br><span class="line">    # fred is a member of group admin when logging in on hosts</span><br><span class="line">    # defined in hostgroup test123</span><br><span class="line">    member = admin@test123</span><br><span class="line">    # fred may only log in from a client in 172.16.0.0/24 ...</span><br><span class="line">    client = 172.16.0.0/24</span><br><span class="line">    # ... or from whatever address is defined in some host object test123</span><br><span class="line">    client = test123</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Railroad-Diagrams-4"><a href="#Railroad-Diagrams-4" class="headerlink" title="Railroad Diagrams:"></a>Railroad Diagrams:</h4><p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/ServiceDecl.gif" alt="img"></p>
<center> Railroad diagram: ServiceDecl</center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/ServiceAttr.gif" alt="img"></p>
<center> Railroad diagram: ServiceAttr</center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/Acl.gif" alt="img"></p>
<center> Railroad diagram: Acl </center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/AttrDefault.gif" alt="img"></p>
<center> Railroad diagram: AttrDefault </center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/AVPair.gif" alt="img"></p>
<center> Railroad diagram: AVPair</center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/ShellDecl.gif" alt="img"></p>
<center> Railroad diagram: ShellDecl </center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/ShellAttr.gif" alt="img"></p>
<center> Railroad diagram: ShellAttr </center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/TacScript.gif" alt="img"></p>
<center> Railroad diagram: TacScript </center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/ShellCommandDecl.gif" alt="img"></p>
<center> Railroad diagram: ShellCommandDecl</center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/CmdDefault.gif" alt="img"></p>
<center> Railroad diagram: CmdDefault</center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/ProtoDefault.gif" alt="img"></p>
<center>Railroad diagram: ProtoDeafult</center>

<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/ProtoDecl.gif" alt="img"></p>
<center> Railroad diagram: ProtoDecl</center>



<h4 id="通过MAVIS配置非本地用户"><a href="#通过MAVIS配置非本地用户" class="headerlink" title="通过MAVIS配置非本地用户:"></a>通过MAVIS配置非本地用户:</h4><p>MAVIS配置是可选的。如果您对主配置文件中的用户配置感到满意，则不需要它。</p>
<p>MAVIS后端可以基于例如LDAP信息动态地创建用户条目。</p>
<p>对于 PAP 和 LOGIN:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pap backend = mavis</span><br><span class="line">login backend = mavis</span><br></pre></td></tr></table></figure>
<p>在全局部分中，将认证授权给MAVIS子系统。静态定义的用户仍然有效，并且具有更高的优先级。</p>
<p>默认情况下，MAVIS用户数据将被缓存120秒。您可以使用<code>cache timeout = seconds</code> 在全局配置部分。</p>
<h4 id="配置本地用户进行MAVIS身份验证"><a href="#配置本地用户进行MAVIS身份验证" class="headerlink" title="配置本地用户进行MAVIS身份验证"></a>配置本地用户进行MAVIS身份验证</h4><p>在某些情况下，您可能希望将用户定义保留在纯文本配置文件中，但是仍然要针对某些外部系统进行身份验证，例如LDAP或RADIUS。为此，只需指定以下一项在相应的用户定义中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">login = mavis</span><br><span class="line">pap = mavis</span><br><span class="line">password = mavis</span><br></pre></td></tr></table></figure>
<h4 id="递归和组："><a href="#递归和组：" class="headerlink" title="递归和组："></a>递归和组：</h4><p>通常，当守护进程查找值时，它将首先查看用户是否对该值具有自己的定义。如果不是，则查看她是否属于某个组，如果属于，则查看该组是否已定义值。如果没有，则此过程将在组的层次结构（一个组可以是另一个组的成员）中继续进行，直到找到一个值，或者不再有gmaryroups。</p>
<p>此递归过程是针对到期日期的查找以及授权参数（请参阅下文），而不是用户密码。</p>
<p>因此，一种典型的配置技术是将用户放入组中，并在组声明中指定尽可能多的组范围特征。然后，可以根据需要使用单个用户声明覆盖所选用户的组设置。</p>
<h4 id="配置用户认证："><a href="#配置用户认证：" class="headerlink" title="配置用户认证："></a>配置用户认证：</h4><p>用户认证可以分别为PAP，ARAP，CHAP和常规登录。全局用户认证必须使用明文(clear text)认证。</p>
<p>以下为用户Mary分别为ARAP，inbound和outboud CHAP, inbound PAP，outbound PAP和普通登录分配了五个不同的密码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">user = mary &#123;</span><br><span class="line">    arap = clear "arap password"</span><br><span class="line">    chap = clear "chap password"</span><br><span class="line">    pap  = clear "inbound pap password"</span><br><span class="line">    opap = clear "outbound pap password"</span><br><span class="line">    login = crypt XQj4892fjk</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果<code>user backend = mavis</code> 如果在“全局”部分中配置，则MAVIS后端将查找在配置文件中找不到的用户。您应该考虑将此选项与更复杂的后端（特别是LDAP和ActiveDirectory）结合使用，或者在您不愿意将现有数据库用户数据复制到配置文件时使用。对于通过MAVIS后端查询的用户，</p>
<p><code>pap backend = mavis</code> 或者 <code>login backend = mavis</code> (同样，在配置文件的全局部分）将导致MAVIS后端执行PAP和/或登录认证（例如，通过执行LDAP绑定），而忽略用户个人资料中的任何相应密码定义。</p>
<p>如果只希望使用MAVIS后端对配置文件中定义的用户进行身份验证，只需将相应的PAP或登录密码字段设置为mavis（在这种情况下，无需添加user backend = mavis指令）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user = mary &#123; login = mavis &#125;</span><br></pre></td></tr></table></figure>
<h4 id="配置到期时间："><a href="#配置到期时间：" class="headerlink" title="配置到期时间："></a>配置到期时间：</h4><p>从有效截止日期开始，将导致配置文件无效。有效日期格式为ISO8601，也是自1970-01-01开始的绝对秒数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user = lol &#123;</span><br><span class="line">    valid until = YYYY-MM-DD</span><br><span class="line">    login = clear "bite me"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用户登录时会向用户发送过期警告消息，默认情况下从过期日期前14天开始，但是可以通过警告期限指令进行配置。</p>
<p>补充个人资料有效期，在给定日期激活配置文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">valid from = YYYY-MM-DD</span><br></pre></td></tr></table></figure>
<h4 id="在NAS上配置认证："><a href="#在NAS上配置认证：" class="headerlink" title="在NAS上配置认证："></a>在NAS上配置认证：</h4><p>在NAS上，配置登录认证，请尝试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaa new-model</span><br><span class="line">aaa authentication login default group tacacs+ local</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>不要把自己关在外面。（</strong>Don’t lock yourself out.<strong>）</strong> </p>
<p>发出此命令后，如果没有正确配置了用户名和密码的有效TACACS +守护程序，您将无法再创建新的NAS登录信息。</p>
<p>作为设置时的安全措施，您应该配置一个启用密钥，并将其作为最后的认知方法，因此，如果您的TACACS +守护程序无法响应，您将可以使用NAS启用密码进行登录。为此，请配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> aaa authentication login default group tacacs+ <span class="built_in">enable</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>或者，如果您有本地帐户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> aaa authentication login default group tacacs+ <span class="built_in">local</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>如果所有其他方法都失败了，并且由于配置问题您发现自己已被锁定在NAS之外，那么Cisco CCO网页上有关从丢失的密码中恢复的部分将帮助您寻找出路。</p>
</blockquote>
<h4 id="配置授权（Authorization）"><a href="#配置授权（Authorization）" class="headerlink" title="配置授权（Authorization）:"></a>配置授权（Authorization）:</h4><p>必须在NAS和守护进程上都配置授权才能正常运行。默认情况下，NAS将允许所有操作，直到您将其配置为向守护程序发出授权请求为止。</p>
<p>在守护程序上，情况恰好相反：默认情况下，守护程序将拒绝未明确允许的任何内容的授权。授权允许守护程序完全拒绝命令和服务，或者基于每个用户修改命令和服务。守护程序上的授权分为两个独立的部分：命令和服务。</p>
<h4 id="授权命令："><a href="#授权命令：" class="headerlink" title="授权命令："></a>授权命令：</h4><p>Exec命令是在Cisco exec提示符下键入的那些命令。当NAS请求授权时，整个命令将发送到tac_plus守护程序进行授权。</p>
<p>通过指定PCRE（Perl Compatible Regular Expressions）或<code>egrep</code>-style参数的正则表达式来匹配命令授权，以匹配命令参数以及拒绝或允许的操作。</p>
<blockquote>
<p>不区分大小写的模式匹配：</p>
<p>默认情况下，正则表达式匹配不区分大小写。可以通过指定更改：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> regex-match-case = yes</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果POSIX参数包含空格或特殊字符，则必须将参数括在双引号（”）中。对于双引号内的文本，将应用C解析规则。特别地，反斜杠\必须转义为\\。 PCRE模式需要用斜杠（/ pattern /）括起来，POSIX和PCRE语法都可以在同一配置文件中使用。</p>
<p>以下配置示例允许用户Fred运行以下命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">telnet 131.108.13.any_number</span><br><span class="line">telnet 128.any_number.12.3</span><br><span class="line">show running-config interface anything</span><br></pre></td></tr></table></figure>
<p>所有其他命令均被拒绝（默认情况下）。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user</span>=fred &#123;</span><br><span class="line">    <span class="comment"># default service = deny</span></span><br><span class="line">    service = shell &#123; </span><br><span class="line">        <span class="comment"># default cmd = deny</span></span><br><span class="line">        cmd = telnet &#123;</span><br><span class="line">            <span class="comment"># permit specified telnets</span></span><br><span class="line">            <span class="comment"># POSIX:</span></span><br><span class="line">            permit ^131\.108\.13\.[0-9]+$</span><br><span class="line">            <span class="comment"># PCRE:</span></span><br><span class="line">            permit /^128\.\d+\.12\.3$/</span><br><span class="line">        &#125;</span><br><span class="line">        cmd = show &#123;</span><br><span class="line">            <span class="comment"># permit show commands</span></span><br><span class="line">            <span class="comment"># PCRE:</span></span><br><span class="line">            permit /^running-config interface/</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>空格，whitespace：</p>
<p>如果指定的任何非PCRE参数列表包含空格或制表符，则必须将其用双引号引起来。无论如何，PCRE表达式都应包含在斜杠中。</p>
</blockquote>
<p>用户键入的命令和参数将与您在配置文件中指定的正则表达式匹配（按出现顺序）。第一次成功匹配将执行关联的操作（允许或拒绝）。如果没有匹配项，则默认情况下将拒绝该命令。</p>
<p>相反，以下配置示例可用于拒绝命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet 131.108.13.any_number</span><br></pre></td></tr></table></figure>
<p>并允许所有其他参数，因为最后一行将匹配任何参数列表。由于“default service = permit”子句，因此允许所有其他命令和服务。</p>
<p>注意：默认语句必须是user子句中的第一条:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">user=fred &#123;</span><br><span class="line">    default service = permit</span><br><span class="line">    service = shell &#123;</span><br><span class="line">        cmd = telnet &#123;</span><br><span class="line">            # allow all telnet commands except to 131.108.13.*</span><br><span class="line">            deny ^131\.108\.13\.[0-9]+</span><br><span class="line">            permit .*</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>仅当指定匹配项时，才会锚定匹配项，因此请拒绝131.108.13.[0-9] +命令中任何位置的匹配项。要锚定匹配项，请在正则表达式的开头使用^。</p>
<p>当命令具有多个参数时，用户可以以许多不同的排列输入它们。创建在这些条件下可靠地授权命令的正则表达式可能很麻烦，因此管理员可能希望考虑其他执行授权的方法，例如通过在NAS本身上配置NAS本地特权启用级别。</p>
<h4 id="命令扩展"><a href="#命令扩展" class="headerlink" title="命令扩展:"></a>命令扩展:</h4><p>对于命令授权，Cisco NAS会将所有命令扩展为全名，例如，当您在NAS上键入config t时，它将被扩展到配置终端，然后再发送到守护程序，因此您无需列出所有可能的收缩命令。</p>
<p>在用户级别，即在用户声明的大括号内，没有明确授权的服务或命令的用户的默认设置是拒绝该服务或命令。以下指令将默认允许服务或命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user = lol &#123;</span><br><span class="line">    default service = permit</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：此指令必须首先出现在用户声明中</p>
</blockquote>
<p>在服务授权级别，即在服务声明的括号内，将根据稍后描述的算法来处理授权请求中的参数。授权服务时（例如，当找不到匹配属性时）的某些操作取决于默认配置的方式。以下声明将默认值从deny更改为允许该用户和服务。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user = lol &#123; service = shell &#123; default attribute = permit &#125; &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：此指令必须出现在服务声明中的其他任何指令之前。</p>
<p>注意：对于命令授权（与此处讨论的服务授权相反），需要指定deny .*或permit .*。因为正则表达式的最后一行匹配以创建默认行为。</p>
</blockquote>
<h4 id="Authorizing-EXEC-SHELL-Startup"><a href="#Authorizing-EXEC-SHELL-Startup" class="headerlink" title="Authorizing EXEC (SHELL) Startup:"></a>Authorizing EXEC (SHELL) Startup:</h4><p>每当Shell启动时，您都可以提供一些参数，例如自动命令，回拨字符串或连接访问列表（acl）。在以下示例中，在NAS上启动exec时，acl为4的将返回到NAS：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">user=fred &#123;</span><br><span class="line"></span><br><span class="line">    # this following line permits an exec to start and permits</span><br><span class="line">    # all commands and services by default</span><br><span class="line"></span><br><span class="line">    default service = permit</span><br><span class="line"></span><br><span class="line">    service = shell &#123;</span><br><span class="line">        # When an exec is started, its connection access list will be 4.</span><br><span class="line">        # It also has an autocmd.</span><br><span class="line">        set acl = 4</span><br><span class="line">        set autocmd = "telnet foobar"</span><br><span class="line"></span><br><span class="line">        cmd = telnet &#123;</span><br><span class="line">            # allow all fred's telnet commands except telnet to 131.108.13.*</span><br><span class="line">            deny 131\.108\.13\.[0-9]+</span><br><span class="line">            permit .*</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：指定自动命令或任何其他exec服务是EXEC AUTHORIZATION的一部分。为了使其正常工作，您还必须在NAS上配置exec授权，例如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> aaa authorization <span class="built_in">exec</span> authorlist group tacacs+ <span class="built_in">local</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> aaa authorization commands 15 cmdlist group tacacs+ <span class="built_in">local</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>并最终在线上：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; authorization commands 15 cmdlist</span><br><span class="line">&gt; authorization exec authorlist</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>与认证一样，您可以使用命名的授权列表，也可以仅使用默认列表。</p>
</blockquote>
<h4 id="Authorizing-EXEC-SLIP-PPP-and-ARAP-services："><a href="#Authorizing-EXEC-SLIP-PPP-and-ARAP-services：" class="headerlink" title="Authorizing EXEC, SLIP, PPP and ARAP services："></a>Authorizing EXEC, SLIP, PPP and ARAP services：</h4><p>对EXEC，SLIP，PPP和ARAP服务的授权与命令授权完全不同。</p>
<p>授权这些服务时，NAS发送包含多个属性值（AV）对的请求，每个对具有以下形式：<code>attribute=value</code> .</p>
<p>（注意：在调试期间，您可能会看到分隔符为*而不是=符号的AV对，这意味着一对中的值是可选的。=符号表示必填值。*表示可选值）。</p>
<p>例如，使用131.108.12.44地址启动PPP / IP的用户将使用以下AV对生成请求：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service=ppp</span><br><span class="line">protocol=ip</span><br><span class="line">addr*131.108.12.44</span><br></pre></td></tr></table></figure>
<p>您可以使用NAS调试命令:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debug aaa authorization</span><br></pre></td></tr></table></figure>
<p>查看NAS正在使用哪些授权AV对。注意：如果您不在路由器控制台上，则还需要发出terminal monitor命令以查看调试输出。</p>
<h4 id="授权过程"><a href="#授权过程" class="headerlink" title="授权过程:"></a>授权过程:</h4><p>授权单个会话可能导致将多个请求发送到守护程序。例如，为了授权拨入PPP用户使用IP，将从NAS发出以下授权请求：</p>
<ol>
<li><p>将使用AV对service = ppp，protocol = ip发出从执行程序启动PPP的初始授权请求（注意：如果您是自动选择PPP，则此初始请求将被省略，因为您尚不知道用户名）</p>
<p>确认完成了此请求，以查找无法进行地址协商的哑PPP（或SLIP）客户端的地址。相反，他们希望您通过文本消息（例如“输入PPP。您的地址为1.2.3.4”）告诉他们在PPP启动之前使用哪个地址。他们依靠从消息中解析此地址来知道其地址。</p>
</li>
<li><p>接下来，从PPP子系统发出授权请求，以查看PPP的LCP层是否得到授权。可以在此时设置LCP参数（例如回调）。该请求包含AV对service = ppp，protocol = lcp。</p>
</li>
<li><p>接下来，使用AV对service = ppp，protocol = ipcp发出启动PPP的IPCP层的授权请求。守护程序返回的所有参数都将被缓存。</p>
</li>
<li><p>接下来，在PPP的地址协商阶段，每次远程对等方请求一个特定的地址时，如果该地址不在步骤3中获得的缓存中，则会进行新的授权请求，以查看对等方请求的地址是否允许。该步骤可以重复多次，直到双方在远程对等方的地址上达成一致，或者直到NAS（或客户端）决定他们永远都不会达成一致，然后关闭PPP。</p>
</li>
</ol>
<h4 id="授权取决于认证："><a href="#授权取决于认证：" class="headerlink" title="授权取决于认证："></a>授权取决于认证：</h4><p>由于我们非常依赖授权请求中的用户名来确定要分发的地址等，因此了解PPP用户的用户名来自何处非常重要。通常有两种可能的来源：</p>
<ol>
<li><p>您通过使用户登录到exec来强制用户进行认证，并在授权请求中使用该登录名。默认情况下，此用户名不会传播到PPP。为此，通常需要配置if-need方法，例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaa authentication login default tacacs+</span><br><span class="line">aaa authentication ppp default if-needed</span><br></pre></td></tr></table></figure>
</li>
<li><p>或者，您可以运行认证协议PAP或CHAP（首选CHAP）来标识用户。如果执行此操作，则不需要显式的登录步骤（因此，如果使用自动选择，则这是唯一的可能性）。当然，在您看到第一个LCP授权请求之前，已完成此认证。通常，您可以通过以下方式进行配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aaa authentication ppp default tacacs+ </span><br><span class="line">int async 1</span><br><span class="line">  ppp authentication chap</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>如果您省略这两种认证方案中的任何一个，您将开始看到缺少用户名的授权请求。</p>
<h4 id="配置service授权："><a href="#配置service授权：" class="headerlink" title="配置service授权："></a>配置service授权：</h4><p>AV对列表放置在守护程序的配置文件中，以授权服务。守护程序会将每个NAS AV对与其已配置的AV对进行比较，并允许或拒绝该服务。如果允许该服务，则守护程序可以在将AV对返回到NAS之前添加，更改或删除AV对，从而限制了允许用户执行的操作。</p>
<h5 id="授权算法："><a href="#授权算法：" class="headerlink" title="授权算法："></a>授权算法：</h5><p>下面给出了守护程序根据NAS发送的列表处理其配置的AV对的完整算法。 查找此服务（和协议）的用户（或组）条目，然后查找从NAS发送的每个AV对：</p>
<ol>
<li>如果来自NAS的AV对是必选的：<ol>
<li>在用户的强制列表中查找确切的属性，值匹配。如果找到，则将AV对添加到输出中。</li>
<li>如果不存在完全匹配项，请在用户的可选列表中查找第一个属性匹配项。如果找到，则将NAS AV对添加到输出中</li>
<li>如果不存在任何属性匹配项，那么如果默认设置为拒绝，则拒绝该命令，或者，</li>
<li>如果默认值为允许，则将NAS AV对添加到输出中。</li>
</ol>
</li>
<li>如果来自NAS的AV对是可选的：<ol>
<li>在用户的强制性列表中查找确切的属性，值匹配。如果找到，则将DAEMON的AV对添加到输出。</li>
<li>如果找不到，请在用户的强制性列表中查找第一个属性匹配。如果找到，则将DAEMON的AV对添加到输出。</li>
<li>如果不存在强制匹配项，则在守护程序的可选AV对中查找确切的属性，值对匹配。如果找到，则将DAEMON的匹配AV对添加到输出中。</li>
<li>如果不存在完全匹配，请在守护程序的可选AV对中找到第一个属性匹配。如果找到，则将DAEMON的匹配AV对添加到输出中。</li>
<li>如果没有找到匹配项，请删除AV对，如果默认设置为deny，或者</li>
<li>如果默认设置为允许，则将NAS AV对添加到输出中。</li>
</ol>
</li>
<li>处理完所有AV对之后，对于每个必需的DAEMON AV对，如果输出列表中没有属性匹配，则添加AV对（但为每个必需属性仅添加一个AV对）。</li>
</ol>
<h5 id="递归授权："><a href="#递归授权：" class="headerlink" title="递归授权："></a>递归授权：</h5><p>请记住，授权对于组也是递归的。因此，如果将用户放置在组中，则守护程序将在用户声明中找不到授权参数的情况下在组中查找授权参数。</p>
<h4 id="授权配置示例："><a href="#授权配置示例：" class="headerlink" title="授权配置示例："></a>授权配置示例：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">host = 0.0.0.0/0 &#123;</span><br><span class="line">    key = "your key here"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">group = admin &#123;</span><br><span class="line">    # group members who have no expiry date set will use this one</span><br><span class="line">    valid until = 1997-01-01</span><br><span class="line">    service = shell &#123;</span><br><span class="line">        default cmd = permit</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user=fred &#123;</span><br><span class="line">    login = crypt mEX027bHtzTlQ</span><br><span class="line">    member = admin</span><br><span class="line">    valid until = 2005-05-23</span><br><span class="line"></span><br><span class="line">    service = shell &#123;</span><br><span class="line">        # When Fred starts an exec, his connection access list is 5</span><br><span class="line">        set acl = 5</span><br><span class="line"></span><br><span class="line">        # We require this autocmd to be done at startup</span><br><span class="line">        set autocmd = "telnet foo"</span><br><span class="line"></span><br><span class="line">        # All commands except show system are denied for Fred</span><br><span class="line">        cmd = show &#123;</span><br><span class="line">            # Fred can run the following show command</span><br><span class="line">            permit system</span><br><span class="line">            deny .</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    service = ppp &#123;</span><br><span class="line">        protocol = lcp</span><br><span class="line">        protocol = ip &#123;</span><br><span class="line">            # Fred can run IP over PPP only if he uses one</span><br><span class="line">            # of the following mandatory addresses. If he</span><br><span class="line">            # supplies no address, the first one here will</span><br><span class="line">            # be mandated</span><br><span class="line">            set addr=131.108.12.11</span><br><span class="line">            set addr=131.108.12.12</span><br><span class="line">            set addr=131.108.12.13</span><br><span class="line">            set addr=131.108.12.14</span><br><span class="line"></span><br><span class="line">            # Fred's mandatory input access list number is 101</span><br><span class="line">            set inacl=101</span><br><span class="line"></span><br><span class="line">            # We will suggest an output access list of 102,</span><br><span class="line">            # but the NAS may choose to ignore or override it</span><br><span class="line">            optional outacl=102</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    service = slip &#123;</span><br><span class="line">        default protocol = permit</span><br><span class="line">        # Fred can run SLIP. When he does, he will have to use</span><br><span class="line">        # these mandatory access lists</span><br><span class="line">        set inacl=101</span><br><span class="line">        set outacl=102</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user = wilma &#123;</span><br><span class="line">    login = crypt mEX027bHtzTlQ</span><br><span class="line">    member = admin</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="在NAS上配置授权"><a href="#在NAS上配置授权" class="headerlink" title="在NAS上配置授权:"></a>在NAS上配置授权:</h4><p>如果未在NAS上显式配置授权，则不会发生授权，即有效地，一切都被允许。请注意，这与守护程序发生的情况相反，在守护程序中，默认情况下拒绝任何未明确允许的内容。</p>
<p>要在NAS上配置命令授权，请发出以下NAS配置命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aaa authorization commands 15 cmdlist group tacacs+ local</span><br><span class="line">aaa authorization commands 1 cmdlist</span><br><span class="line">aaa authorization commands 15 cmdlist</span><br></pre></td></tr></table></figure>
<p>这将使NAS为所有1级（普通用户）和15级（特权级）命令发送TACACS +请求。</p>
<p>或者，或者此外，您可能还需要配置以下内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa authorization commands 1 group tacacs+ if-authenticated</span><br></pre></td></tr></table></figure>
<p>这将对级别1（用户级别的命令）使用TACACS +授权，但是如果出现问题，您可以关闭TACACS +服务器，然后将授权给任何已认证的人。</p>
<p>以下守护程序配置应足以确保您始终可以以用户名admin（使用适当的密码）登录并以该用户身份运行任何命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user = admin &#123;</span><br><span class="line">    default service = permit</span><br><span class="line">    service = shell &#123; default cmd = permit &#125;</span><br><span class="line">    login = crypt kppPfHq/j6gXs</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="MAVIS-Backends-MAVIS后端"><a href="#MAVIS-Backends-MAVIS后端" class="headerlink" title="MAVIS Backends(MAVIS后端)"></a>MAVIS Backends(MAVIS后端)</h1><p>该发行版附带各种MAVIS模块，其中外部模块可能是最有趣的，因为它与简单的Perl脚本进行交互以对请求进行认证和授权。您可以在mavis / perl目录中找到示例脚本。请仔细查看它们，因为您可能（或将需要）执行一些琐碎的自定义操作，以使其与您的本地环境相匹配。</p>
<p>您应该真正看看MAVIS文档。它还提供了RADIUS和PAM认证的示例。</p>
<h2 id="LDAP-Backends"><a href="#LDAP-Backends" class="headerlink" title="LDAP Backends:"></a>LDAP Backends:</h2><p>mavis_tacplus_ldap.pl是外部模块的认证/授权后端。它连接到各种LDAP服务器，例如OpenLDAP，Fedora DS和Active Directory。它的行为由一系列环境变量控制：</p>
<p>下表为LDAP后端环境变量：</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>LDAP_SERVER_TYPE</code></td>
<td>One of: <code>generic</code>, <code>tacacs_schema</code>, <code>microsoft</code>.Default: <code>tacacs_schema</code></td>
</tr>
<tr>
<td><code>LDAP_HOSTS</code></td>
<td>LDAP_HOSTS LDAP URL或IP地址或主机名的以空格分隔的列表，例如:<code>&quot;ldap01 ldap02&quot;</code>, <code>&quot;ldaps://ads01:636 ldaps://ads02:636&quot;</code></td>
</tr>
<tr>
<td><code>LDAP_SCOPE</code></td>
<td>LDAP搜索范围 (<code>base</code>, <code>one</code>, <code>sub</code>)Default: <code>sub</code></td>
</tr>
<tr>
<td><code>LDAP_BASE</code></td>
<td>LDAP服务的基本DN，例如: <code>dc=example,dc=com</code></td>
</tr>
<tr>
<td><code>LDAP_FILTER</code></td>
<td>LDAP搜索过滤器. Defaults:for <code>LDAP_SERVER_TYPE=generic</code>:<code>&quot;(uid=%s)&quot;</code>for <code>LDAP_SERVER_TYPE=tacacs_schema</code>:<code>&quot;(&amp;(uid=%s)(objectClass=tacacsAccount))&quot;</code>for <code>LDAP_SERVER_TYPE=microsoft</code>:<code>&quot;(&amp;(objectclass=user)(sAMAccountName=%s))&quot;</code></td>
</tr>
<tr>
<td><code>LDAP_FILTER_CHPW</code></td>
<td>LDAP search filter for password changes. Defaults:for <code>LDAP_SERVER_TYPE=generic</code>:<code>&quot;(uid=%s)&quot;</code>for <code>LDAP_SERVER_TYPE=tacacs_schema</code>:<code>&quot;(&amp;(uid=%s)(objectClass=tacacsAccount)(!(tacacsFlag=staticpasswd)))&quot;</code>for <code>LDAP_SERVER_TYPE=microsoft</code>:<code>&quot;(&amp;(objectclass=user)(sAMAccountName=%s))&quot;</code></td>
</tr>
<tr>
<td><code>LDAP_USER</code></td>
<td>如果服务器不允许匿名搜索，则用于LDAP绑定的用户。.Default: unset</td>
</tr>
<tr>
<td><code>LDAP_PASSWD</code></td>
<td>Password for <code>LDAP_USER</code>Default: unset</td>
</tr>
<tr>
<td><code>AD_GROUP_PREFIX</code></td>
<td>以该前缀开头的AD组将用作用户的TACACS +组成员身份。 AD_GROUP_PREFIX的值将从组名称中删除。示例：将AD_GROUP_PREFIX设置为tacacs（这实际上是默认值），TacacsNOC的AD组成员身份会将用户分配给NOC TACACS +组。请注意，TACACS +组名称区分大小写。</td>
</tr>
<tr>
<td><code>REQUIRE_AD_GROUP_PREFIX</code></td>
<td>如果设置，则用户需要属于AD_GROUP_PREFIX组之一。.Default: unset</td>
</tr>
<tr>
<td><code>USE_TLS</code></td>
<td>如果设置，则服务器需要支持<code>start_tls</code>.Default: unset</td>
</tr>
<tr>
<td><code>FLAG_CHPW</code></td>
<td>允许通过此后端更改密码.Default: unset</td>
</tr>
<tr>
<td><code>FLAG_PWPOLICY</code></td>
<td>尝试实施简单的密码策略。.Default: unset</td>
</tr>
<tr>
<td><code>FLAG_CACHE_CONNECTION</code></td>
<td>保持与LDAP服务器的连接打开。.Default: unset</td>
</tr>
<tr>
<td><code>FLAG_FALLTHROUGH</code></td>
<td>如果在LDAP中搜索用户失败，请尝试下一个MAVIS模块（如果有）。Default: unset</td>
</tr>
<tr>
<td><code>FLAG_USE_MEMBEROF</code></td>
<td>使用memberOf属性确定组成员身份。将LDAP_SERVER_TYPE设置为Microsoft暗示了这一点。如果您在启用memberof overlay的情况下运行OpenLDAP，则可以使用。Default: unset</td>
</tr>
</tbody>
</table>
<h3 id="LDAP-Custom-Schema-Backend："><a href="#LDAP-Custom-Schema-Backend：" class="headerlink" title="LDAP Custom Schema Backend："></a>LDAP Custom Schema Backend：</h3><p>对于将LDAP_SERVER_TYPE设置为tacacs_schema的程序，程序期望LDAP服务器支持实验性ldap.schema，包括在OpenLDAP和Fedora-DS中。模式文件位于mavis / perl目录中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">dn: uid=marc,ou=people,dc=example,dc=com</span><br><span class="line">uid: marc</span><br><span class="line">cn: Marc Huber</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">objectClass: tacacsAccount</span><br><span class="line">shadowMax: 10000</span><br><span class="line">uidNumber: 1000</span><br><span class="line">gecos: Marc Huber</span><br><span class="line">givenName: Marc</span><br><span class="line">sn: Huber</span><br><span class="line">gidNumber: 500</span><br><span class="line">shadowLastChange: 14012</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">homeDirectory: /Users/marc</span><br><span class="line">mail: marc@example.com</span><br><span class="line">userPassword:: abcdefghijklmnopqrstuvwxyz=</span><br><span class="line">tacacsClient: 192.168.0.0/24</span><br><span class="line">tacacsClient: management</span><br><span class="line">tacacsMember: readonly@172.16.5.0/24</span><br><span class="line">tacacsMember: readwrite@nasgroup</span><br><span class="line">tacacsProfile: &#123; valid until = 2010-01-30 chap = clear ahzoi5Ue &#125;</span><br></pre></td></tr></table></figure>
<h4 id="Active-Directory-Backend"><a href="#Active-Directory-Backend" class="headerlink" title="Active Directory Backend:"></a>Active Directory Backend:</h4><p>如果LDAP_SERVER_TYPE设置为microsoft，则脚本将后端到AD服务器。样本配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">id = spawnd &#123;</span><br><span class="line">    listen = &#123;</span><br><span class="line">        port = 49</span><br><span class="line">    &#125;</span><br><span class="line">    spawn = &#123;</span><br><span class="line">        instances min = 1</span><br><span class="line">        instances max = 10</span><br><span class="line">    &#125;</span><br><span class="line">    background = yes</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">    access log = /var/log/tacacs/%Y/%m/%d/access.log</span><br><span class="line">    accounting log = /var/log/tacacs/%Y/%m/%d/acct.log</span><br><span class="line"></span><br><span class="line">    mavis module = external &#123;</span><br><span class="line">        # Optionally:</span><br><span class="line">        # script out = &#123;</span><br><span class="line">        #     # Require group membership:</span><br><span class="line">        #     if (undef($TACMEMBER) &amp;&amp; $RESULT == ACK) set $RESULT = NAK</span><br><span class="line">        #</span><br><span class="line">        #     # Don't cache passwords:</span><br><span class="line">        #     if ($RESULT == ACK) set $PASSWORD_ONESHOT = 1</span><br><span class="line">        # &#125;</span><br><span class="line"></span><br><span class="line">        setenv LDAP_SERVER_TYPE = "microsoft"</span><br><span class="line">        # setenv LDAP_HOSTS = "ldaps://ads01:636 ldaps://ads02:636"</span><br><span class="line">        setenv LDAP_HOSTS = "ads01:3268 ads02:3268"</span><br><span class="line">        setenv LDAP_SCOPE = sub</span><br><span class="line">        setenv LDAP_BASE = "dc=example,dc=com"</span><br><span class="line">        setenv LDAP_FILTER = "(&amp;(objectclass=user)(sAMAccountName=%s))";</span><br><span class="line">        setenv LDAP_USER = tacacs@example.com</span><br><span class="line">        setenv LDAP_PASSWD = Secret123</span><br><span class="line">        setenv AD_GROUP_PREFIX = tacacs</span><br><span class="line">        # setenv REQUIRE_AD_GROUP_PREFIX = 1</span><br><span class="line">        setenv USE_TLS = 0</span><br><span class="line">        exec = /usr/local/lib/mavis/mavis_tacplus_ldap.pl</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    login backend = mavis</span><br><span class="line">    pap backend = mavis</span><br><span class="line"></span><br><span class="line">    host = world &#123;</span><br><span class="line">        address = ::/0</span><br><span class="line">        welcome banner = "Welcome\n"</span><br><span class="line">        key = cisco</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    host = helpdesklab &#123;</span><br><span class="line">        address = 192.168.34.16/28</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # A user will be in the "admin" group if he's member of the</span><br><span class="line">    # corresponding "tacacsadmin" ADS group.</span><br><span class="line"></span><br><span class="line">    group = admin &#123;</span><br><span class="line">        default service = permit</span><br><span class="line">        service = shell &#123;</span><br><span class="line">            default command = permit</span><br><span class="line">            default attribute = permit</span><br><span class="line">            set priv-lvl = 15</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # A user will be in the "helpdesk" group if he's member of the</span><br><span class="line">    # corresponding "tacacshelpdesk" ADS group:</span><br><span class="line"></span><br><span class="line">    group = helpdesk &#123;</span><br><span class="line">        default service = permit</span><br><span class="line">        service = shell &#123;</span><br><span class="line">            default command = permit</span><br><span class="line">            default attribute = permit</span><br><span class="line">            set priv-lvl = 1</span><br><span class="line">        &#125;</span><br><span class="line">        enable = deny</span><br><span class="line">        member = admin@helpdesklab</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="通用LDAP后端"><a href="#通用LDAP后端" class="headerlink" title="通用LDAP后端:"></a>通用LDAP后端:</h3><p>如果将LDAP_SERVER_TYPE设置为generic，则脚本不需要对LDAP服务器进行任何修改，而只对配置文件中定义的用户进行认证(使用login = mavis、pap = mavis或password = mavis声明)。此后端不进行任何授权。</p>
<h2 id="PAM后端："><a href="#PAM后端：" class="headerlink" title="PAM后端："></a>PAM后端：</h2><p>使用可插拔认证模块（ <em>Pluggable Authentication Modules</em>:）的示例配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">id = spawnd &#123; listen = &#123; port = 49 &#125; &#125;</span><br><span class="line"></span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">  mavis module = groups &#123;</span><br><span class="line">    resolve gids = yes</span><br><span class="line">    groups filter = /^(guest|staff)$/</span><br><span class="line">    script out = &#123;</span><br><span class="line">      # copy the already filtered UNIX group access list to TACMEMBER</span><br><span class="line">      eval $GIDS =~ /^(.*)$/</span><br><span class="line">      set $TACMEMBER = $1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  mavis module = external &#123;</span><br><span class="line">    exec = /usr/local/sbin/pammavis pammavis -s sshd</span><br><span class="line">  &#125;</span><br><span class="line">  user backend = mavis</span><br><span class="line">  login backend = mavis</span><br><span class="line">  host = global &#123; address = 0.0.0.0/0 key = cisco &#125;</span><br><span class="line"></span><br><span class="line">  group = staff &#123;</span><br><span class="line">    service = shell &#123;</span><br><span class="line">      default command = permit</span><br><span class="line">      set priv-lvl = 15</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  group = guest &#123;</span><br><span class="line">    service = shell &#123;</span><br><span class="line">      default command = deny</span><br><span class="line">      set priv-lvl = 15</span><br><span class="line">      cmd = show &#123; permit .* &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="系统密码后端："><a href="#系统密码后端：" class="headerlink" title="系统密码后端："></a>系统密码后端：</h2><p>mavis_tacplus_passwd.pl根据您的本地密码数据库进行认证。遗憾的是，要使用这个功能，脚本可能必须以root身份运行，因为它需要访问加密的密码。主和辅助UNIX组成员关系将映射到TACACS+组。</p>
<p>mavis_tacplus_opie.pl基于mavis_tacplus_passwd.pl，但使用OPIE一次性密码进认证。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">id = spawnd &#123;</span><br><span class="line">  listen = &#123; port = 49 &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">  mavis module = external &#123;</span><br><span class="line">    exec = /usr/local/lib/mavis/mavis_tacplus_opie.pl</span><br><span class="line">  &#125;</span><br><span class="line">  login backend = mavis chalresp</span><br><span class="line">  host = global &#123; address = 0.0.0.0/0 key = cisco &#125;</span><br><span class="line">  group = staff &#123;</span><br><span class="line">    service = shell &#123;</span><br><span class="line">      default command = permit</span><br><span class="line">      set priv-lvl = 15</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  user = user1 &#123; password = mavis member = staff &#125;</span><br><span class="line">  user = user2 &#123; password = clear pass2 member = staff &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Shadow-Backend"><a href="#Shadow-Backend" class="headerlink" title="Shadow Backend:"></a>Shadow Backend:</h3><p>可以使用mavis_tacplus_shadow.pl将用户密码排除在tac_plus configuration文件之外，从而允许用户通过密码更改对话框更改密码。密码存储在一个辅助的/etc/shadow类ASCII文件中，每行一个用户:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username:encryptedPassword:lastChange:minAge:maxAge:reserved</span><br></pre></td></tr></table></figure>
<p>lastChange是上一次更改密码自1970-01-01以来的天数，minAge和maxAge确定密码是否可以/不需要更改。将lastChange设置为0强制在第一次登录时更改密码。</p>
<p>Example shadow file:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">marc:$1$q5/vUEsR$jVwHmEw8zAmgkjMShLBg/.:15218:0:99999:</span><br><span class="line">newuser:$1$pQtQsMuj$GKpIr5r2GNaZNfDfnCBtw.:0:0:99999:</span><br><span class="line">test:$1$pQtQsMuj$GKpIr5r2GNaZNfDfnCBtw.:15218:1:30:</span><br></pre></td></tr></table></figure>
<p>示例守护程序配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  id = tac_plus &#123;</span><br><span class="line">    ...</span><br><span class="line">    mavis module = external &#123;</span><br><span class="line">      setenv SHADOWFILE = /path/to/shadow</span><br><span class="line">      # setenv FLAG_PWPOLICY=y</span><br><span class="line">      # setenv ci=/usr/bin/ci</span><br><span class="line">      exec = /usr/local/lib/mavis/mavis_tacplus_shadow.pl</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    login backend = mavis chpass</span><br><span class="line">    ...</span><br><span class="line">    user = marc &#123;</span><br><span class="line">      login = mavis</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  ...</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="RADIUS-Backend"><a href="#RADIUS-Backend" class="headerlink" title="RADIUS Backend:"></a>RADIUS Backend:</h2><p>mavis_tacplus_radius.pl针对RADIUS服务器进行认证。除非设置了RADIUS_GROUP_ATTR环境变量，否则不会进行任何授权。例如，如果配置文件中有静态用户帐户定义，那么这可能很有用，但是应该用RADIUS验证身份验证密码。在用户配置文件中使用login = mavis或password = mavis语句来执行此操作。</p>
<h3 id="示例配置："><a href="#示例配置：" class="headerlink" title="示例配置："></a>示例配置：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mavis module = external &#123;</span><br><span class="line">        exec = /usr/local/lib/mavis_tacplus_radius.pl</span><br><span class="line">        setenv RADIUS_HOST = 1.2.3.4:1812</span><br><span class="line">        setenv RADIUS_SECRET = "mysecret"</span><br><span class="line">        setenv RADIUS_GROUP_ATTR = Some-Radius-Attribute</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>如果安装了Authen::Radius Perl模块，则使用RADIUS_GROUP_ATTR指定的Radius属性的值来创建一个TAC_PROFILE定义，该定义使用属性值作为组成员。例如，Administrator的属性值<code>{ member = Administrator }</code>将导致配置文件启用授权并在配置文件中省略对静态用户的需求。</p>
<p>请记住，这仅在以下情况下有效:</p>
<ul>
<li>使用单连接(single-connection)</li>
<li>mavis缓存超时设置为足够高的值，可以覆盖用户（预期）的最大登录时间。</li>
</ul>
<h2 id="实验性后端："><a href="#实验性后端：" class="headerlink" title="实验性后端："></a>实验性后端：</h2><p>mavis_tacplus_sms.pl是一个示例（skeleton）脚本，用于通过SMS后端发送一次性密码。</p>
<h2 id="错误处理："><a href="#错误处理：" class="headerlink" title="错误处理："></a>错误处理：</h2><p>如果后端脚本由于外部问题（例如LDAP服务器不可用）而失败，则您的路由器可能会也可能不会退回到本地身份验证（如果已配置）。可能的情况是，后备功能不起作用。如果您仍然希望在这种情况下能够通过TACACS +进行认证，则可以使用非MAVIS用户进行身份验证，该用户仅在出现后端错误时才有效：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">   #</span><span class="bash"> <span class="built_in">set</span> the time interval you want the user to be valid <span class="keyword">if</span> the backend fails:</span></span><br><span class="line">   authentication fallback period = 60 # that's actually the default value</span><br><span class="line">   ...</span><br><span class="line"><span class="meta">   #</span><span class="bash"> add a <span class="built_in">local</span> user <span class="keyword">for</span> emergencies:</span></span><br><span class="line">   user = cisco &#123;</span><br><span class="line">       ...</span><br><span class="line">       fallback-only</span><br><span class="line">       ...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>为了表明后备模式(fallback mode )实际上处于活动状态，可以向用户显示不同的登录提示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">host = ... &#123;</span><br><span class="line">       ...</span><br><span class="line">       welcome banner = "Welcome\n"</span><br><span class="line">       welcome banner fallback = "Welcome\nEmergency accounts are currently enabled.\n"</span><br><span class="line">       ...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>fallback可以基于每个主机全局启用/禁用。默认启用。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">authentication fallback = permit</span><br><span class="line">   host = ... &#123;</span><br><span class="line">       ...</span><br><span class="line">       authentication fallback = deny</span><br><span class="line">       ...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h1 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging"></a>Debugging</h1><h3 id="Debugging-Configuration-Files-调试配置文件"><a href="#Debugging-Configuration-Files-调试配置文件" class="headerlink" title="Debugging Configuration Files(调试配置文件):"></a>Debugging Configuration Files(调试配置文件):</h3><p>创建配置文件时，使用tac_plus的-P标志检查它们的语法很方便。例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tac_plus -P config-file</span><br></pre></td></tr></table></figure>
<p>将语法检查配置文件并在终端上打印任何错误消息。</p>
<h2 id="Trace-Options（跟踪选项）："><a href="#Trace-Options（跟踪选项）：" class="headerlink" title="Trace Options（跟踪选项）："></a>Trace Options（跟踪选项）：</h2><p>跟踪（或调试）选项可以在全局，主机，用户和组上下文中指定。当前的调试级别是所有这些的组合（读：OR）。通用语法为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debug = option ...</span><br></pre></td></tr></table></figure>
<p>例如，以一种可预测的方式获得命令授权工作可能是棘手的——NAS发送给守护进程的确切属性可能取决于IOS版本，通常可能不符合您的期望。如果正则表达式不能工作，添加<code>debug = REGEX</code> 在适当的情况下，守护程序可能会将一些有用的信息记录到syslog中。</p>
<p>可以指定多个跟踪选项。例：<code>debug = REGEX CMD</code> </p>
<p>调试和跟踪值表中汇总了可用的调试选项。</p>
<p><strong>Table 3. Debug and Trace Values</strong></p>
<table>
<thead>
<tr>
<th>Bit</th>
<th>Value</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>PARSE</td>
<td>Configuration file parsing</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>AUTHOR</td>
<td>Authorization related</td>
</tr>
<tr>
<td>2</td>
<td>4</td>
<td>AUTHEN</td>
<td>Authentication related</td>
</tr>
<tr>
<td>3</td>
<td>8</td>
<td>ACCT</td>
<td>Accounting related</td>
</tr>
<tr>
<td>4</td>
<td>16</td>
<td>CONFIG</td>
<td>Configuration related</td>
</tr>
<tr>
<td>5</td>
<td>32</td>
<td>PACKET</td>
<td>Packet dump</td>
</tr>
<tr>
<td>6</td>
<td>64</td>
<td>HEX</td>
<td>Packet hex-dump</td>
</tr>
<tr>
<td>7</td>
<td>128</td>
<td>LOCK</td>
<td>File locking</td>
</tr>
<tr>
<td>8</td>
<td>256</td>
<td>REGEX</td>
<td>Regular expressions</td>
</tr>
<tr>
<td>9</td>
<td>512</td>
<td>ACL</td>
<td>Access Control Lists</td>
</tr>
<tr>
<td>10</td>
<td>1024</td>
<td>RADIUS</td>
<td>unused</td>
</tr>
<tr>
<td>11</td>
<td>2048</td>
<td>CMD</td>
<td>Command lookups</td>
</tr>
<tr>
<td>12</td>
<td>4096</td>
<td>BUFFER</td>
<td>Buffer handling</td>
</tr>
<tr>
<td>13</td>
<td>8192</td>
<td>PROC</td>
<td>Procedural traces</td>
</tr>
<tr>
<td>14</td>
<td>16384</td>
<td>NET</td>
<td>Network related</td>
</tr>
<tr>
<td>15</td>
<td>32768</td>
<td>PATH</td>
<td>File system path related</td>
</tr>
<tr>
<td>16</td>
<td>65536</td>
<td>CONTROL</td>
<td>Control connection related</td>
</tr>
<tr>
<td>17</td>
<td>131072</td>
<td>INDEX</td>
<td>Directory index related</td>
</tr>
<tr>
<td>18</td>
<td>262144</td>
<td>AV</td>
<td>Attribute-Value pair handling</td>
</tr>
<tr>
<td>19</td>
<td>524288</td>
<td>MAVIS</td>
<td>MAVIS related</td>
</tr>
<tr>
<td>20</td>
<td>1048576</td>
<td>LWRES</td>
<td>DNS related</td>
</tr>
<tr>
<td>31</td>
<td>2147483648</td>
<td>NONE</td>
<td>Disable debugging</td>
</tr>
</tbody>
</table>
<p>其中一些调试选项未使用，不会触发任何输出。</p>
<p><img src="/2020/09/10/Tacacs-服务搭建与配置详解/Debug.gif" alt="img"></p>
<center> Railroad diagram: Debug</center>

<h1 id="FAQ-Frequently-Asked-Questions"><a href="#FAQ-Frequently-Asked-Questions" class="headerlink" title="FAQ(Frequently Asked Questions)"></a>FAQ(Frequently Asked Questions)</h1><h4 id="是否有任何图形用户界面？"><a href="#是否有任何图形用户界面？" class="headerlink" title="是否有任何图形用户界面？"></a>是否有任何图形用户界面？</h4><p>没有，除非您最喜欢的文本编辑器符合条件。配置语法过于复杂和灵活，无法使用GUI覆盖。如果您正在寻找一种管理用户数据库的方法，那么可以看看Webmin，ActiveDirectory等。将它们用作认证/授权后端很简单。</p>
<h4 id="如何使用MySQL后端？"><a href="#如何使用MySQL后端？" class="headerlink" title="如何使用MySQL后端？"></a>如何使用MySQL后端？</h4><p>除非您愿意自己编写SQL后端，否则您不会这样做。这其实并不难，但显然很大程度上取决于数据库结构，没有足够通用的方法可以将您从这一步中解放出来。只要看一看这个发行版附带的LDAP Perl脚本就可以了。如果您对Perl和SQL数据库非常熟悉，那么编写后端将是小菜一碟。</p>
<h4 id="我正在使用单连接功能。如何强制路由器关闭与TACACS-服务器的TCP连接？"><a href="#我正在使用单连接功能。如何强制路由器关闭与TACACS-服务器的TCP连接？" class="headerlink" title="我正在使用单连接功能。如何强制路由器关闭与TACACS +服务器的TCP连接？"></a>我正在使用单连接功能。如何强制路由器关闭与TACACS +服务器的TCP连接？</h4><p>在IOS上，show tcp brief将显示TCP连接。搜索终止于您服务器的服务器，然后使用clear tcp tcb …将其杀死。示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Router#</span><span class="bash">sho tcp brief | incl 10.0.0.1.49  </span></span><br><span class="line">633BB794  10.0.0.2.17326              10.0.0.1.49                 ESTAB</span><br><span class="line">6287E4C4  10.0.0.2.24880              10.0.0.1.49                 ESTAB</span><br><span class="line"><span class="meta">Router#</span><span class="bash">clear tcp tcb 633BB794            </span></span><br><span class="line">[confirm]</span><br><span class="line"> [OK]</span><br><span class="line"><span class="meta">Router#</span><span class="bash">clear tcp tcb 6287E4C4</span></span><br><span class="line">[confirm]</span><br><span class="line"> [OK]</span><br><span class="line"><span class="meta">Router#</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
<h3 id="守护程序是否需要的DNS？"><a href="#守护程序是否需要的DNS？" class="headerlink" title="守护程序是否需要的DNS？"></a>守护程序是否需要的DNS？</h3><p>不，DNS不是必需的。但是，您可以在NAC ACL列表中使用DNS反向映射，前提是该软件使用lwres支持进行编译并且相应的lwresd正在运行。</p>
<h3 id="当我已经登录并通过认证时，为什么由于请求中没有用户名而导致PPP授权失败？"><a href="#当我已经登录并通过认证时，为什么由于请求中没有用户名而导致PPP授权失败？" class="headerlink" title="当我已经登录并通过认证时，为什么由于请求中没有用户名而导致PPP授权失败？"></a>当我已经登录并通过认证时，为什么由于请求中没有用户名而导致PPP授权失败？</h3><p>使用<code>aaa authentication ppp default group tacacs+</code>, ppp认证将覆盖早期的登录认证。如果ppp认证失败，用户名将变为空白。将配置更改为 <code>aaa authentication ppp default if-needed group tacacs+</code>修复了这个问题。</p>
<h3 id="有什么方法可以避免在配置文件中使用ARAP和CHAP密钥的明文版本？"><a href="#有什么方法可以避免在配置文件中使用ARAP和CHAP密钥的明文版本？" class="headerlink" title="有什么方法可以避免在配置文件中使用ARAP和CHAP密钥的明文版本？"></a>有什么方法可以避免在配置文件中使用ARAP和CHAP密钥的明文版本？</h3><p>CHAP和ARAP要求服务器知道明文密码(或者等价的，服务器可以从中生成明文密码)。请注意，这是CHAP和ARAP定义的一部分，而不是某个深夜喝了太多咖啡的思科工程师的想法。</p>
<p>如果我们在数据库中加密了CHAP和ARAP密码，那么我们需要在周围保留一个密钥，以便在需要CHAP或ARAP时服务器可以解密它们。因此，这只是一个轻微的混淆，并没有比原来的方案更安全。</p>
<p>在扩展的TACACS中，CHAP和ARAP 密码与密码文件分离，因为密码文件可能是系统密码文件，因此全世界都可读。但是对于TACACS+的本机数据库，则没有这样的要求，所以我们认为最好的解决方案是读取保护文件。注意，这与Kerberos服务器有相同的问题。如果您在Kerberos服务器上的安全性受到威胁，那么您的数据库是完全开放的。Kerberos确实对数据库进行了加密，但是如果希望服务器自动重新启动，那么无论如何都必须在文件中“kstash”密钥，这样就又回到了相同的安全问题。</p>
<p>因此，在安全服务器上存储明文密码确实是CHAP和ARAP协议的绝对要求，而不是由TACACS+强加的。</p>
<p>对于新的TACACS+协议修订的方案选择，NAS将询问信息发送给TACACS+守护进程，守护进程使用明文密码生成响应并返回响应。</p>
<p>TACACS+协议包含了ARAP和CHAP的特定协议知识(此版本的守护进程实现不再支持SENDPASS机制)。</p>
<p>注意，以上内容不适用于PAP。您可以对入站PAP密码DES-或md5进行加密，因为您只需要验证主体提供的密码是否正确。</p>
<h3 id="典型的登录登录顺序如何完成？"><a href="#典型的登录登录顺序如何完成？" class="headerlink" title="典型的登录登录顺序如何完成？"></a>典型的登录登录顺序如何完成？</h3><ol>
<li>NAS发送START包给daemon。</li>
<li>Daemon发送GETUSER包含登录提示给NAS。</li>
<li>NAS提示用户输入用户名</li>
<li>NAS发送数据包给daemon</li>
<li>Daemon发送GETPASS包含密码提示给NAS</li>
<li>NAS提示用户输入密码</li>
<li>NAS发送数据包给daemon</li>
<li>Daemon发送accept, reject或error给NAS。</li>
</ol>
<h3 id="“default-service-permit”实际上是做什么的？"><a href="#“default-service-permit”实际上是做什么的？" class="headerlink" title="“default service = permit”实际上是做什么的？"></a>“<strong><code>default service = permit</code></strong>”实际上是做什么的？</h3><p>当进入一个请求来授权exec启动，或ppp(使用协议lcp、ip、ipx)，或slip，或arap或一个特定命令时，守护进程为用户(或用户所属的组)寻找匹配的声明。</p>
<ul>
<li>对于exec启动，它将查找service = shell。</li>
<li>对于PPP，它将查找service = ppp和protocol = lcp，ip，ipx之一。</li>
<li>对于SLIP，必须有一个service = slip，对于ARAP，必须有一个service = arap子句。</li>
<li>对于commands，必须有匹配的cmd = cmdname或默认的cmd =permit定义。</li>
<li>如果未找到，则授权将失败，除非您说<code>default service = permit</code>.。</li>
</ul>
<h3 id="如何使PAP工作？"><a href="#如何使PAP工作？" class="headerlink" title="如何使PAP工作？"></a>如何使PAP工作？</h3><p>请避免使用PAP，它是太不安全的。如果必须使用它，则可以为每个用户指定PAP密码以及ARAP和CHAP密码。</p>
<p>对于outbound PAP，您被迫向远程主机发送密码以识别自己的身份，现在有一个单独的opap指令，例如:<code>opap = clear OOOO</code> 使用此设置outbound PAP密码。它必须是明文密码。</p>
<blockquote>
<p>密码：</p>
<p>使用与任何inbound 密码相同的outbound PAP密码是非常糟糕的做法。因此，一个“全局”密码，定义为password = clear…语句，不适用于outbound PAP，只适用于inbound PAP，双向CHAP和ARAP。</p>
</blockquote>
<h3 id="如何仅通过IP地址拒绝从通用服务器进行的远程登录，即命令是10-0-1-6而不是telnet-10-0-1-6？"><a href="#如何仅通过IP地址拒绝从通用服务器进行的远程登录，即命令是10-0-1-6而不是telnet-10-0-1-6？" class="headerlink" title="如何仅通过IP地址拒绝从通用服务器进行的远程登录，即命令是10.0.1.6而不是telnet 10.0.1.6？"></a>如何仅通过IP地址拒绝从通用服务器进行的远程登录，即命令是10.0.1.6而不是telnet 10.0.1.6？</h3><p>限制telnet访问的最佳方法是通过access class命令应用出站访问列表(或者等效地，通过“acl”avpair)。NAS配置命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access-class n out</span><br></pre></td></tr></table></figure>
<p>例如，应用预定义的标准IP访问列表（其中n是从1到99的数字）来管理来自NAS的telnet访问。</p>
<p>例如。以下配置命令允许“仅”从NAS上的line 1到网络192.85.55.0上的主机的出站Telnet访问：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">access-list 12 permit 192.85.55.0 0.0.0.255</span><br><span class="line">line 1</span><br><span class="line">  access-class 12 out</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：您必须在NAS上定义访问列表。只有这样，您才能使用acl avpair将其应用于用户拨入的线路。</p>
</blockquote>
<p>或者，您可以尝试在相关线路上配置transport preferred none。这将迫使用户总是键入telnet 10.0.1.6，以便通过telnet从NAS中导出。然后可以对该命令应用命令授权来限制它。</p>
<h3 id="我在NAS本地数据库中配置了自动命令，我正在使用aaa-authentication-local-override-自动命令无效，但用户名-密码有效。为什么？"><a href="#我在NAS本地数据库中配置了自动命令，我正在使用aaa-authentication-local-override-自动命令无效，但用户名-密码有效。为什么？" class="headerlink" title="我在NAS本地数据库中配置了自动命令，我正在使用aaa authentication local-override 自动命令无效，但用户名/密码有效。为什么？"></a>我在NAS本地数据库中配置了自动命令，我正在使用<code>aaa authentication local-override</code> 自动命令无效，但用户名/密码有效。为什么？</h3><p>local-override仅适用于本地数据库的认证部分，因此，如果要为此用户使用自动命令，还需要执行以下操作：<code>aaa authorization exec local if-authenticated</code> </p>
<p>如果存在一个本地数据库条目，它将使用本地数据库条目，否则将允许通过认证用户，否则将失败。</p>
<p>我们没有像认证那样的aaa authorization local-override。与认证不同，用于授权的本地方法在某种程度上等效于 local-override。</p>
<h3 id="只能在全局范围内启用TACACS-吗？"><a href="#只能在全局范围内启用TACACS-吗？" class="headerlink" title="只能在全局范围内启用TACACS +吗？"></a>只能在全局范围内启用TACACS +吗？</h3><p>您可以全局打开TACACS +，但随后可以将各个线路的行为更改为所需的任何方式，例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">aaa authentication login default tacacs+ none</span><br><span class="line">aaa authentication login oldstyle line</span><br><span class="line">aaa authentication login none none</span><br><span class="line">line 1 16</span><br><span class="line">  login authentication default</span><br><span class="line">line vty 0 4</span><br><span class="line">  login authentication oldstyle</span><br><span class="line">line 0</span><br><span class="line">  login authentication none</span><br></pre></td></tr></table></figure>
<p>请注意，不幸的是，您还不能（尚未）对选定的行和接口应用不同的授权。</p>
<h3 id="我有运行PPP的租用线路，并且还配置了AAA授权，因此租用线路上的授权失败。我该怎么办？"><a href="#我有运行PPP的租用线路，并且还配置了AAA授权，因此租用线路上的授权失败。我该怎么办？" class="headerlink" title="我有运行PPP的租用线路，并且还配置了AAA授权，因此租用线路上的授权失败。我该怎么办？"></a>我有运行PPP的租用线路，并且还配置了AAA授权，因此租用线路上的授权失败。我该怎么办？</h3><p>由于您还不能按行配置授权，因此必须在运行PPP的租用线路上打开认证，并配置TACACS +服务器，以便它可以正确授权这些线路（lines）。</p>
<p>要求更高的替代方法是修改TACACS +服务器源代码，以允许从端口“ SerialXXX”进入的任何授权都能够成功。</p>
<p>第三种可能性是不要在这些线路上使用PPP，例如请改用HDLC。 HDLC不需要认证或授权。</p>
<h3 id="TACACS-用户名和密码可以包含多少个字符？"><a href="#TACACS-用户名和密码可以包含多少个字符？" class="headerlink" title="TACACS +用户名和密码可以包含多少个字符？"></a>TACACS +用户名和密码可以包含多少个字符？</h3><p>简短的答案是用户名为31个字节，如果为明文，则最多为254个字节的密码（如果密码为DES加密，则为8个字节）。</p>
<p>最长答案是，Cisco NAS会分配1024个字节的缓冲区，因此这是您可以输入的最大数量，以响应NAS提示。</p>
<p>但是协议规范允许认证数据包中的用户名或密码长度字段只有一个字节，因此只能将这些字符的前255个发送到守护程序。</p>
<p>现在，如果它是DES加密密码，那么按照crypt的常见unix实现，只有前8个字节是有效的</p>
<h3 id="如何限制用户可以拥有的会话数？"><a href="#如何限制用户可以拥有的会话数？" class="headerlink" title="如何限制用户可以拥有的会话数？"></a>如何限制用户可以拥有的会话数？</h3><p>使用此版本的守护程序，您将无法使用。</p>
<h3 id="如何通过TACACS-在接口上配置超时？"><a href="#如何通过TACACS-在接口上配置超时？" class="headerlink" title="如何通过TACACS +在接口上配置超时？"></a>如何通过TACACS +在接口上配置超时？</h3><p>在授权过程中，TACACS +可能会设置某些每个用户/每个接口的超时时间。从11.0开始，您可以设置arap会话超时和exec超时。从11.1开始，您还可以设置exec空闲超时。</p>
<p>当接口空闲一段时间后，空闲超时会终止连接(这相当于Cisco IOS配置指令的“会话超时”)。其他超时是绝对的。当然，由TACACS+设置的任何超时只适用于当前连接。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">user = lol &#123;</span><br><span class="line">    login = clear foobar</span><br><span class="line">    service = shell &#123;</span><br><span class="line">        set idletime = 5 # disconnect lol if there is no traffic for 5 minutes</span><br><span class="line">        set timeout = 60 # disconnect lol unconditionally after one hour</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您还需要在NAS上为上述超时配置exec授权，例如 aaa授权执行程序默认组tacacs +</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa authorization exec default group tacacs+</span><br></pre></td></tr></table></figure>
<p>请注意，这些超时仅适用于异步线路，当前不适用于ISDN。</p>
<p>还请注意，您不能将授权if-authenticated选项与这些参数一起使用，因为如果用户已成功进行认证，则该选项将跳过授权。</p>
<h1 id="Canned-Configurations"><a href="#Canned-Configurations" class="headerlink" title="Canned Configurations"></a>Canned Configurations</h1><p>以下是一些入门的配置：</p>
<h3 id="Login-Authentication，登陆认证："><a href="#Login-Authentication，登陆认证：" class="headerlink" title="Login Authentication，登陆认证："></a>Login Authentication，登陆认证：</h3><p>仅用于登录认证的基础配置。这允许用户fred使用密码abcdef登录。如果TACACS +服务器死亡，则将启用密钥用作登录密码。</p>
<p><strong>Daemon：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">id = spawnd &#123;</span><br><span class="line">    listen = &#123; port = 49 &#125;</span><br><span class="line">&#125;</span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">    host = any &#123; key = "some key" address = 0.0.0.0/0 &#125;</span><br><span class="line"></span><br><span class="line">    # repeat as necessary for each user</span><br><span class="line">    user = fred &#123; login = clear abcdef &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>NAS:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">aaa new-model</span><br><span class="line">enable secret foobar</span><br><span class="line">! use TACACS+. If server dies, use the enable secret password</span><br><span class="line">aaa authentication login default group tacacs+ enable</span><br><span class="line">tacacs-server host ...</span><br><span class="line">tacacs-server key some key</span><br></pre></td></tr></table></figure>
<h2 id="Command-Authorization-命令授权："><a href="#Command-Authorization-命令授权：" class="headerlink" title="Command Authorization,命令授权："></a>Command Authorization,命令授权：</h2><p>这将允许用户fred使用密码abcdef登录，并运行特权（级别15）命令<code>write terminal</code> and <code>configure</code>。所有其他特权命令将被拒绝。</p>
<p>NAS配置行中的“ none”关键字表示，如果TACACS +服务器死亡，则将允许任何命令。</p>
<p><strong>Daemon:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">id = spawnd &#123;</span><br><span class="line">    listen = &#123; port = 49 &#125;</span><br><span class="line">&#125;</span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">    host = any &#123; key = "some key" address = 0.0.0.0/0 &#125;</span><br><span class="line"></span><br><span class="line">    # repeat as necessary for each user</span><br><span class="line">    user = fred &#123;</span><br><span class="line">        login = clear abcdef</span><br><span class="line">        service = shell &#123;</span><br><span class="line">            cmd = write  &#123; permit terminal &#125;</span><br><span class="line">            cmd = configure &#123; permit .* &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>NAS:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aaa new-model</span><br><span class="line">! all level 15 (privileged commands). If server dies, allow everything</span><br><span class="line">aaa authorization commands 15 default group tacacs+ none</span><br><span class="line">tacacs-server host 10.1.1.1</span><br><span class="line">tacacs-server key some key</span><br></pre></td></tr></table></figure>
<h3 id="Network-Access-Authorization，网络访问授权"><a href="#Network-Access-Authorization，网络访问授权" class="headerlink" title="Network Access Authorization，网络访问授权"></a>Network Access Authorization，网络访问授权</h3><p>此配置允许fred使用密码abcdef登录到line 1（或使用chap身份验证登录并运行ppp。chap密码为lab。</p>
<p><strong>Daemon:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">id = spawnd &#123;</span><br><span class="line">    listen = &#123; port = 49 &#125;</span><br><span class="line">&#125;</span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">    host = any &#123; key = "some key" address = 0.0.0.0/0 &#125;</span><br><span class="line"></span><br><span class="line">    # repeat as necessary for each user</span><br><span class="line">    user = fred &#123;</span><br><span class="line">        login = clear abcdef</span><br><span class="line">        chap = clear lab</span><br><span class="line">        service = ppp &#123; protocol = ip &#123; set addr=1.0.0.2 &#125; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>NAS:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">aaa new-model</span><br><span class="line">! authenticate exec logins (if not autoselecting)</span><br><span class="line">aaa authentication login default group tacacs+</span><br><span class="line">! authorize network services via TACACS+</span><br><span class="line">aaa authorization network default group tacacs+</span><br><span class="line">! use TACACS+ for authenticating ppp users</span><br><span class="line">aaa authentication ppp default group tacacs+ </span><br><span class="line">tacacs-server host 10.1.1.1</span><br><span class="line">tacacs-server key some key</span><br><span class="line">interface Async1</span><br><span class="line">ip address 1.0.0.1 255.0.0.0</span><br><span class="line">async default ip address 172.21.14.55</span><br><span class="line">encapsulation ppp</span><br><span class="line">async dynamic address</span><br><span class="line">async mode interactive</span><br><span class="line">! use chap to authenticate ppp users</span><br><span class="line">ppp authentication chap</span><br><span class="line">line 1</span><br><span class="line">! need "modem inout" here and flow control if using a modem</span><br></pre></td></tr></table></figure>
<h2 id="ARAP"><a href="#ARAP" class="headerlink" title="ARAP:"></a>ARAP:</h2><p><strong>Daemon:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">id = spawnd &#123;</span><br><span class="line">    listen = &#123; port = 49 &#125;</span><br><span class="line">&#125;</span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">    host = any &#123; key = "some key" address = 0.0.0.0/0 &#125;</span><br><span class="line"></span><br><span class="line">    user = lol &#123;</span><br><span class="line">        arap = clear arapSecret</span><br><span class="line">        service = arap</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>NAS:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">aaa new-model</span><br><span class="line">aaa authentication arap default group tacacs+</span><br><span class="line">aaa authorization network default group tacacs+</span><br><span class="line">aaa accounting network default start-stop group tacacs+</span><br><span class="line">!</span><br><span class="line">appletalk routing</span><br><span class="line">arap network ...</span><br><span class="line">!</span><br><span class="line">interface Ethernet0</span><br><span class="line">  appletalk cable-range ...</span><br><span class="line">  appletalk zone ...</span><br><span class="line">!</span><br><span class="line">tacacs-server host ...</span><br><span class="line">tacacs-server key ...</span><br><span class="line">!</span><br><span class="line">line 1</span><br><span class="line">  location a modem</span><br><span class="line">  modem answer-timeout 0</span><br><span class="line">  modem InOut</span><br><span class="line">  autoselect arap</span><br><span class="line">  autoselect during-login</span><br><span class="line">  arap enable</span><br><span class="line">  speed ...</span><br><span class="line">  flowcontrol hardware</span><br></pre></td></tr></table></figure>
<h2 id="Callback"><a href="#Callback" class="headerlink" title="Callback:"></a>Callback:</h2><p><strong>Daemon:</strong></p>
<p>用户名foobar的远程TACACS +服务器配置文件条目的示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">id = spawnd &#123;</span><br><span class="line">    listen = &#123; port = 49 &#125;</span><br><span class="line">&#125;</span><br><span class="line">id = tac_plus &#123;</span><br><span class="line">    host = any &#123; key = "some key" address = 0.0.0.0/0 &#125;</span><br><span class="line"></span><br><span class="line">    user = foobar &#123;</span><br><span class="line">        arap = clear AAAA</span><br><span class="line">        login = clear LLLL</span><br><span class="line">        chap = clear CCCC</span><br><span class="line">        pap = clear PPPP</span><br><span class="line">        opap = clear OOOO</span><br><span class="line">        service = ppp &#123;</span><br><span class="line">            default protocol = permit</span><br><span class="line">            protocol = lcp &#123;</span><br><span class="line">                set callback-dialstring=123456</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        service = arap &#123;</span><br><span class="line">            protocol = atalk &#123;</span><br><span class="line">                set callback-dialstring=2345678</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        service = shell &#123;</span><br><span class="line">            set callback-dialstring=3456789</span><br><span class="line">            set callback-line=7</span><br><span class="line">            set nocallback-verify=1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>NAS:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">aaa new-model</span><br><span class="line">tacacs-server host XX.XX.XX.XX</span><br><span class="line">tacacs-server key fookey</span><br><span class="line">aaa accounting exec wait-start tacacs+</span><br><span class="line">aaa accounting network wait-start tacacs+</span><br><span class="line"></span><br><span class="line">! Example of AAA configuration for Exec:</span><br><span class="line">aaa authentication login execcheck tacacs+</span><br><span class="line">aaa authorization network tacacs+</span><br><span class="line">service exec-callback</span><br><span class="line"></span><br><span class="line">line 4</span><br><span class="line">  login authentication execcheck</span><br><span class="line"></span><br><span class="line">! Example of AAA configuration for ARAP:</span><br><span class="line">aaa authentication arap arapcheck tacacs+</span><br><span class="line">aaa authorization network tacacs+</span><br><span class="line">arap callback</span><br><span class="line"></span><br><span class="line">line 4</span><br><span class="line">  arap authentication arapcheck</span><br><span class="line"></span><br><span class="line">! Example of AAA-specific configuration for PPP callback:</span><br><span class="line">aaa new-model</span><br><span class="line">aaa authentication ppp pppcheck tacacs+</span><br><span class="line">aaa authorization network tacacs+</span><br><span class="line"></span><br><span class="line">int async 6</span><br><span class="line">  ppp authentication chap pppcheck</span><br><span class="line">  ppp callback accept</span><br></pre></td></tr></table></figure>
<hr>
<blockquote>
<p>其他文章：</p>
<ul>
<li><a href="https://cshihong.github.io/2020/08/30/Tacscs-%E5%8D%8F%E8%AE%AE%E5%8E%9F%E7%90%86/">Tacacs+协议原理</a></li>
<li><a href="https://cshihong.github.io/2020/09/10/Tacacs-%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E4%B8%8E%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/">Tacacs+服务搭建与配置详解</a></li>
<li><a href="https://cshihong.github.io/2020/09/28/Tacacs-%E5%90%84%E5%8E%82%E5%95%86%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%85%8D%E7%BD%AE/">Tacacs+各厂商交换机配置</a></li>
<li><a href="https://cshihong.github.io/2020/10/06/Tacacs-%E5%8D%8F%E8%AE%AE%E4%BA%A4%E4%BA%92%E6%8A%A5%E6%96%87%E6%8A%93%E5%8C%85%E7%A4%BA%E4%BE%8B/">Tacacs+协议交互报文抓包示例</a></li>
<li><a href="https://cshihong.github.io/2020/12/27/Tacacs-%E5%8F%8C%E9%80%9A%E9%81%93%E8%AE%A4%E8%AF%81%E9%85%8D%E7%BD%AE%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%80%BB%E7%BB%93/">Tacacs+双通道认证配置测试与总结</a></li>
<li><a href="https://cshihong.github.io/2020/12/27/Tacacs-%E9%85%8D%E7%BD%AEsingle-connection%E5%8D%95%E8%BF%9E%E6%8E%A5%E6%A8%A1%E5%BC%8F%E8%AF%81%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%80%BB%E7%BB%93/">Tacacs+配置single-connection单连接模式证测试与总结</a></li>
</ul>
</blockquote>
<hr>
<blockquote>
<p>参考资料：</p>
<p><a href="http://www.pro-bono-publico.de/projects/tac_plus.html#AEN9" target="_blank" rel="noopener">http://www.pro-bono-publico.de/projects/tac_plus.html#AEN9</a></p>
<p><a href="https://github.com/facebookarchive/tac_plus" target="_blank" rel="noopener">https://github.com/facebookarchive/tac_plus</a></p>
<p><a href="https://networklessons.com/uncategorized/how-to-install-tacacs-on-linux-centos" target="_blank" rel="noopener">https://networklessons.com/uncategorized/how-to-install-tacacs-on-linux-centos</a></p>
<p><a href="https://www.tecmint.com/installation-and-configuration-of-tacacs-using-cisco-on-debian/" target="_blank" rel="noopener">https://www.tecmint.com/installation-and-configuration-of-tacacs-using-cisco-on-debian/</a></p>
</blockquote>

      
    </div>

    
      


    

    
    
    

    

    
      
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/微信.png" alt="曹世宏 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/支付宝.jpg" alt="曹世宏 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        



  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>曹世宏</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/" title="Tacacs+服务搭建与配置详解">https://cshihong.github.io/2020/09/10/Tacacs-服务搭建与配置详解/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
<br>
  <li class="post-copyright-link">
    <strong>字节跳动社招内推：<a href="https://job.toutiao.com/s/Jy89E4s">https://job.toutiao.com/s/Jy89E4s</a></strong><br>
    <strong>字节跳动校招内推码：<a href="https://job.toutiao.com/s/Jy8BSv6">YYG5KEY</a></strong><br>
    <strong>字节跳动校招投递链接:<a href="https://job.toutiao.com/s/Jy8BSv6">https://job.toutiao.com/s/Jy8BSv6</a></strong><br>
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Tacscs/" rel="tag"># Tacscs+</a>
          
            <a href="/tags/安全/" rel="tag"># 安全</a>
          
            <a href="/tags/AAA/" rel="tag"># AAA</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
               <div>
                 
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>

               </div>
            
            
               <div id="needsharebutton-postbottom">
                 <span class="btn">
                    <i class="fa fa-share-alt" aria-hidden="true"></i>
                 </span>
               </div>
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/08/30/Tacscs-协议原理/" rel="next" title="Tacscs+协议原理">
                <i class="fa fa-chevron-left"></i> Tacscs+协议原理
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/09/28/Tacacs-各厂商交换机配置/" rel="prev" title="Tacacs+各厂商交换机配置">
                Tacacs+各厂商交换机配置 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMDc1NS83MzA3"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/touxiang.jpg" alt="曹世宏">
            
              <p class="site-author-name" itemprop="name">曹世宏</p>
              <p class="site-description motion-element" itemprop="description">你的责任就是你的方向，你的经历就是你的资本，你的性格就是你的命运。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">264</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">25</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">135</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/cshihong/cshihong.github.io" title="GitHub &rarr; https://github.com/cshihong/cshihong.github.io" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:cshihong96@gmail.com" title="E-Mail &rarr; mailto:cshihong96@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://user.qzone.qq.com/731507579?ptlang=2052&source=friendlist" title="qq &rarr; https://user.qzone.qq.com/731507579?ptlang=2052&source=friendlist" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i>qq</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://blog.csdn.net/qq_38265137" title="CSDN &rarr; http://blog.csdn.net/qq_38265137" rel="noopener" target="_blank"><i class="fa fa-fw fa-meh-o"></i>CSDN</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.csdn.net/qq_38265137" title="http://blog.csdn.net/qq_38265137" rel="noopener" target="_blank">我的CSDN</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://support.huawei.com/learning/NavigationAction!createNavi?navId=MW000001_term1000025144&lang=zh" title="http://support.huawei.com/learning/NavigationAction!createNavi?navId=MW000001_term1000025144&lang=zh" rel="noopener" target="_blank">华为培训认证</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://bbs.hh010.com/" title="http://bbs.hh010.com/" rel="noopener" target="_blank">鸿鹄论坛</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://m.blog.csdn.net/home/index" title="http://m.blog.csdn.net/home/index" rel="noopener" target="_blank">CSDN博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.cnblogs.com/" title="https://www.cnblogs.com/" rel="noopener" target="_blank">博客园</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.w3school.com.cn/index.html" title="http://www.w3school.com.cn/index.html" rel="noopener" target="_blank">w3cshool</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.51cto.com" title="http://www.51cto.com" rel="noopener" target="_blank">51cto</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#下载和安装："><span class="nav-number">2.</span> <span class="nav-text">下载和安装：</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#源码安装与配置示例："><span class="nav-number">2.1.</span> <span class="nav-text">源码安装与配置示例：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装步骤："><span class="nav-number">2.2.</span> <span class="nav-text">安装步骤：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#定义和术语"><span class="nav-number">3.</span> <span class="nav-text">定义和术语</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#TACACS，XTACACS-and-TACACS-："><span class="nav-number">3.1.</span> <span class="nav-text">TACACS，XTACACS and TACACS+：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#操作方式（Operation）"><span class="nav-number">4.</span> <span class="nav-text">操作方式（Operation）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#命令行语法（Command-line-syntax）："><span class="nav-number">4.1.</span> <span class="nav-text">命令行语法（Command line syntax）：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#信号（Signals）："><span class="nav-number">4.2.</span> <span class="nav-text">信号（Signals）：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事件机制选择-Evenet-mechainsm-selection"><span class="nav-number">4.3.</span> <span class="nav-text">事件机制选择(Evenet mechainsm selection):</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#示例配置（Sample-Configuration）："><span class="nav-number">4.4.</span> <span class="nav-text">示例配置（Sample Configuration）：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#域的示例配置-Sample-Configuration-with-Realms"><span class="nav-number">4.5.</span> <span class="nav-text">域的示例配置( Sample Configuration with Realms):</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置语法-Configuration-Syntax"><span class="nav-number">5.</span> <span class="nav-text">配置语法(Configuration Syntax)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#全局配置选项（Global-options）："><span class="nav-number">5.1.</span> <span class="nav-text">全局配置选项（Global options）：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Limits-and-timeouts"><span class="nav-number">5.1.1.</span> <span class="nav-text">Limits and timeouts:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DNS："><span class="nav-number">5.1.2.</span> <span class="nav-text">DNS：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Process-specific-options-特定的进程选项-："><span class="nav-number">5.1.2.1.</span> <span class="nav-text">Process-specific options(特定的进程选项)：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Railroad-Diagrams（铁路图）："><span class="nav-number">5.1.3.</span> <span class="nav-text">Railroad Diagrams（铁路图）：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本规则"><span class="nav-number">5.2.</span> <span class="nav-text">基本规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Realms："><span class="nav-number">5.3.</span> <span class="nav-text">Realms：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Realm-options-域选项-："><span class="nav-number">5.4.</span> <span class="nav-text">Realm options(域选项)：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Logging（日志）："><span class="nav-number">5.4.1.</span> <span class="nav-text">Logging（日志）：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Accounting："><span class="nav-number">5.4.1.1.</span> <span class="nav-text">Accounting：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spoofing-Syslog-Packets-欺骗Syslog数据包"><span class="nav-number">5.4.1.2.</span> <span class="nav-text">Spoofing Syslog Packets(欺骗Syslog数据包):</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Limits-and-timeouts-1"><span class="nav-number">5.4.2.</span> <span class="nav-text">Limits and timeouts:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DNS"><span class="nav-number">5.4.2.1.</span> <span class="nav-text">DNS:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Authentication"><span class="nav-number">5.4.2.2.</span> <span class="nav-text">Authentication:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Miscellaneous-杂项"><span class="nav-number">5.4.2.3.</span> <span class="nav-text">Miscellaneous(杂项):</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#User-backend-options-用户后端选项-："><span class="nav-number">5.4.2.3.1.</span> <span class="nav-text">User backend options(用户后端选项)：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Railroad-Diagrams（铁路图）：-1"><span class="nav-number">5.4.2.4.</span> <span class="nav-text">Railroad Diagrams（铁路图）：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hosts-主机-："><span class="nav-number">5.5.</span> <span class="nav-text">Hosts(主机)：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Timeouts"><span class="nav-number">5.5.0.1.</span> <span class="nav-text">Timeouts:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Authentication-1"><span class="nav-number">5.5.0.2.</span> <span class="nav-text">Authentication:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Banners-and-Messages："><span class="nav-number">5.5.0.3.</span> <span class="nav-text">Banners and Messages：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Inheritacnce-and-Hosts"><span class="nav-number">5.5.0.4.</span> <span class="nav-text">Inheritacnce and Hosts:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Railroad-Diagrams"><span class="nav-number">5.5.0.5.</span> <span class="nav-text">Railroad Diagrams:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例："><span class="nav-number">5.5.0.6.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Time-Ranges-时间范围"><span class="nav-number">5.5.1.</span> <span class="nav-text">Time Ranges(时间范围):</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Railroad-Diagrams-1"><span class="nav-number">5.5.1.1.</span> <span class="nav-text">Railroad Diagrams:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-Control-Lists-访问控制列表-："><span class="nav-number">5.5.2.</span> <span class="nav-text">Access Control Lists(访问控制列表)：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Railroad-Diagrams-2"><span class="nav-number">5.5.2.1.</span> <span class="nav-text">Railroad Diagrams:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rewriting-User-Names-改写用户名"><span class="nav-number">5.5.3.</span> <span class="nav-text">Rewriting User Names(改写用户名):</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scripts："><span class="nav-number">5.5.4.</span> <span class="nav-text">Scripts：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Syntax"><span class="nav-number">5.5.4.1.</span> <span class="nav-text">Syntax:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Users-and-Groups-用户和组-："><span class="nav-number">5.5.5.</span> <span class="nav-text">Users and Groups(用户和组)：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#User-only-options"><span class="nav-number">5.5.5.1.</span> <span class="nav-text">User-only options:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Group-only-options："><span class="nav-number">5.5.5.2.</span> <span class="nav-text">Group-only options：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#USer-and-Group-options"><span class="nav-number">5.5.5.3.</span> <span class="nav-text">USer and Group options:</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Limits"><span class="nav-number">5.5.5.3.1.</span> <span class="nav-text">Limits:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Messages"><span class="nav-number">5.5.5.3.2.</span> <span class="nav-text">Messages:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Enable-passwords："><span class="nav-number">5.5.5.3.3.</span> <span class="nav-text">Enable passwords：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MAVIS-options"><span class="nav-number">5.5.5.3.4.</span> <span class="nav-text">MAVIS options:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Group-membership"><span class="nav-number">5.5.5.3.5.</span> <span class="nav-text">Group membership:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Railroad-Diagrams-3"><span class="nav-number">5.5.5.3.6.</span> <span class="nav-text">Railroad Diagrams:</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Service-Restrictions-服务限制"><span class="nav-number">5.5.5.4.</span> <span class="nav-text">Service Restrictions(服务限制):</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Service-Definitions-服务定义-："><span class="nav-number">5.5.5.5.</span> <span class="nav-text">Service Definitions(服务定义)：</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#SHELL-EXEC-Service"><span class="nav-number">5.5.5.5.0.1.</span> <span class="nav-text">SHELL (EXEC) Service</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Non-Shell-Service"><span class="nav-number">5.5.5.5.0.2.</span> <span class="nav-text">Non-Shell Service:</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Host-group-specific-services-主机组特定服务"><span class="nav-number">5.5.5.6.</span> <span class="nav-text">Host-group specific services(主机组特定服务):</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CLI-Contexts"><span class="nav-number">5.5.5.7.</span> <span class="nav-text">CLI Contexts:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用户和组配置示例"><span class="nav-number">5.5.5.8.</span> <span class="nav-text">用户和组配置示例:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Railroad-Diagrams-4"><span class="nav-number">5.5.5.9.</span> <span class="nav-text">Railroad Diagrams:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#通过MAVIS配置非本地用户"><span class="nav-number">5.5.5.10.</span> <span class="nav-text">通过MAVIS配置非本地用户:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置本地用户进行MAVIS身份验证"><span class="nav-number">5.5.5.11.</span> <span class="nav-text">配置本地用户进行MAVIS身份验证</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#递归和组："><span class="nav-number">5.5.5.12.</span> <span class="nav-text">递归和组：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置用户认证："><span class="nav-number">5.5.5.13.</span> <span class="nav-text">配置用户认证：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置到期时间："><span class="nav-number">5.5.5.14.</span> <span class="nav-text">配置到期时间：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在NAS上配置认证："><span class="nav-number">5.5.5.15.</span> <span class="nav-text">在NAS上配置认证：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置授权（Authorization）"><span class="nav-number">5.5.5.16.</span> <span class="nav-text">配置授权（Authorization）:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#授权命令："><span class="nav-number">5.5.5.17.</span> <span class="nav-text">授权命令：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#命令扩展"><span class="nav-number">5.5.5.18.</span> <span class="nav-text">命令扩展:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Authorizing-EXEC-SHELL-Startup"><span class="nav-number">5.5.5.19.</span> <span class="nav-text">Authorizing EXEC (SHELL) Startup:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Authorizing-EXEC-SLIP-PPP-and-ARAP-services："><span class="nav-number">5.5.5.20.</span> <span class="nav-text">Authorizing EXEC, SLIP, PPP and ARAP services：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#授权过程"><span class="nav-number">5.5.5.21.</span> <span class="nav-text">授权过程:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#授权取决于认证："><span class="nav-number">5.5.5.22.</span> <span class="nav-text">授权取决于认证：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置service授权："><span class="nav-number">5.5.5.23.</span> <span class="nav-text">配置service授权：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#授权算法："><span class="nav-number">5.5.5.23.1.</span> <span class="nav-text">授权算法：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#递归授权："><span class="nav-number">5.5.5.23.2.</span> <span class="nav-text">递归授权：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#授权配置示例："><span class="nav-number">5.5.5.24.</span> <span class="nav-text">授权配置示例：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在NAS上配置授权"><span class="nav-number">5.5.5.25.</span> <span class="nav-text">在NAS上配置授权:</span></a></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#MAVIS-Backends-MAVIS后端"><span class="nav-number">6.</span> <span class="nav-text">MAVIS Backends(MAVIS后端)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#LDAP-Backends"><span class="nav-number">6.1.</span> <span class="nav-text">LDAP Backends:</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LDAP-Custom-Schema-Backend："><span class="nav-number">6.1.1.</span> <span class="nav-text">LDAP Custom Schema Backend：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Active-Directory-Backend"><span class="nav-number">6.1.1.1.</span> <span class="nav-text">Active Directory Backend:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通用LDAP后端"><span class="nav-number">6.1.2.</span> <span class="nav-text">通用LDAP后端:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PAM后端："><span class="nav-number">6.2.</span> <span class="nav-text">PAM后端：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统密码后端："><span class="nav-number">6.3.</span> <span class="nav-text">系统密码后端：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Shadow-Backend"><span class="nav-number">6.3.1.</span> <span class="nav-text">Shadow Backend:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RADIUS-Backend"><span class="nav-number">6.4.</span> <span class="nav-text">RADIUS Backend:</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#示例配置："><span class="nav-number">6.4.1.</span> <span class="nav-text">示例配置：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实验性后端："><span class="nav-number">6.5.</span> <span class="nav-text">实验性后端：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#错误处理："><span class="nav-number">6.6.</span> <span class="nav-text">错误处理：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Debugging"><span class="nav-number">7.</span> <span class="nav-text">Debugging</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Debugging-Configuration-Files-调试配置文件"><span class="nav-number">7.0.1.</span> <span class="nav-text">Debugging Configuration Files(调试配置文件):</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Trace-Options（跟踪选项）："><span class="nav-number">7.1.</span> <span class="nav-text">Trace Options（跟踪选项）：</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#FAQ-Frequently-Asked-Questions"><span class="nav-number">8.</span> <span class="nav-text">FAQ(Frequently Asked Questions)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#是否有任何图形用户界面？"><span class="nav-number">8.0.0.1.</span> <span class="nav-text">是否有任何图形用户界面？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#如何使用MySQL后端？"><span class="nav-number">8.0.0.2.</span> <span class="nav-text">如何使用MySQL后端？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#我正在使用单连接功能。如何强制路由器关闭与TACACS-服务器的TCP连接？"><span class="nav-number">8.0.0.3.</span> <span class="nav-text">我正在使用单连接功能。如何强制路由器关闭与TACACS +服务器的TCP连接？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#守护程序是否需要的DNS？"><span class="nav-number">8.0.1.</span> <span class="nav-text">守护程序是否需要的DNS？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#当我已经登录并通过认证时，为什么由于请求中没有用户名而导致PPP授权失败？"><span class="nav-number">8.0.2.</span> <span class="nav-text">当我已经登录并通过认证时，为什么由于请求中没有用户名而导致PPP授权失败？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#有什么方法可以避免在配置文件中使用ARAP和CHAP密钥的明文版本？"><span class="nav-number">8.0.3.</span> <span class="nav-text">有什么方法可以避免在配置文件中使用ARAP和CHAP密钥的明文版本？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#典型的登录登录顺序如何完成？"><span class="nav-number">8.0.4.</span> <span class="nav-text">典型的登录登录顺序如何完成？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#“default-service-permit”实际上是做什么的？"><span class="nav-number">8.0.5.</span> <span class="nav-text">“default service = permit”实际上是做什么的？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何使PAP工作？"><span class="nav-number">8.0.6.</span> <span class="nav-text">如何使PAP工作？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何仅通过IP地址拒绝从通用服务器进行的远程登录，即命令是10-0-1-6而不是telnet-10-0-1-6？"><span class="nav-number">8.0.7.</span> <span class="nav-text">如何仅通过IP地址拒绝从通用服务器进行的远程登录，即命令是10.0.1.6而不是telnet 10.0.1.6？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#我在NAS本地数据库中配置了自动命令，我正在使用aaa-authentication-local-override-自动命令无效，但用户名-密码有效。为什么？"><span class="nav-number">8.0.8.</span> <span class="nav-text">我在NAS本地数据库中配置了自动命令，我正在使用aaa authentication local-override 自动命令无效，但用户名/密码有效。为什么？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#只能在全局范围内启用TACACS-吗？"><span class="nav-number">8.0.9.</span> <span class="nav-text">只能在全局范围内启用TACACS +吗？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#我有运行PPP的租用线路，并且还配置了AAA授权，因此租用线路上的授权失败。我该怎么办？"><span class="nav-number">8.0.10.</span> <span class="nav-text">我有运行PPP的租用线路，并且还配置了AAA授权，因此租用线路上的授权失败。我该怎么办？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TACACS-用户名和密码可以包含多少个字符？"><span class="nav-number">8.0.11.</span> <span class="nav-text">TACACS +用户名和密码可以包含多少个字符？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何限制用户可以拥有的会话数？"><span class="nav-number">8.0.12.</span> <span class="nav-text">如何限制用户可以拥有的会话数？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何通过TACACS-在接口上配置超时？"><span class="nav-number">8.0.13.</span> <span class="nav-text">如何通过TACACS +在接口上配置超时？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Canned-Configurations"><span class="nav-number">9.</span> <span class="nav-text">Canned Configurations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Login-Authentication，登陆认证："><span class="nav-number">9.0.1.</span> <span class="nav-text">Login Authentication，登陆认证：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Command-Authorization-命令授权："><span class="nav-number">9.1.</span> <span class="nav-text">Command Authorization,命令授权：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Network-Access-Authorization，网络访问授权"><span class="nav-number">9.1.1.</span> <span class="nav-text">Network Access Authorization，网络访问授权</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ARAP"><span class="nav-number">9.2.</span> <span class="nav-text">ARAP:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Callback"><span class="nav-number">9.3.</span> <span class="nav-text">Callback:</span></a></li></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">曹世宏</span>

  

  
</div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">全站共 1.1m 字</span>
</div>











        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>






  <script>
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=66140664";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




        
      </div>
    </footer>

    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
      
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  
    <script src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script src="//cdn.jsdelivr.net/velocity/1.2.1/velocity.min.js"></script>
  

  
  
    <script src="//cdn.jsdelivr.net/velocity/1.2.1/velocity.ui.min.js"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.6.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  
  <script src="/js/src/scrollspy.js?v=6.6.0"></script>
<script src="/js/src/post-details.js?v=6.6.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  
    <script>
      window.livereOptions = {
        refer: '2020/09/10/Tacacs-服务搭建与配置详解/'
      };
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  











  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1.0.0/needsharebutton.min.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook,Mailto";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
          flOptions.iconStyle = "box";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook,";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>

  

  

  
  <script src="/js/src/js.cookie.js?v=6.6.0"></script>
  <script src="/js/src/scroll-cookie.js?v=6.6.0"></script>


  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('复制成功')
          else $(this).text('复制失败')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('复制')
        }, 300)
      }).append(e)
    })
  </script>


  
  

  
  

  


</body>
</html>
